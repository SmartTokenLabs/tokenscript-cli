import{r as t,h as i,g as s}from"./p-f0f1815c.js";import{V as e}from"./p-1a921d6b.js";import"./p-4a1bebfd.js";const n=":host{padding:0 20px}.attribute-table{text-align:left;border:#000 solid 1px}.attribute-table td,.attribute-table th{padding:8px}.view-container{height:550px;max-width:400px;margin:20px auto;position:relative}.view-loader{position:absolute;left:0;top:0;width:100%;height:100%;align-items:center;justify-content:center;background-color:rgba(131,131,131,0.67)}.tokenscript-frame{width:100%;height:500px;border:1px solid black;border-radius:4px;box-sizing:border-box}.action-bar{height:35px}.action-btn{width:100%;height:100%}";const a=class{constructor(i){t(this,i);this.app=undefined;this.tabId=undefined;this.tokenScript=undefined;this.cards=[];this.currentCardIndex=0;this.currentCard=undefined;this.currentTokensFlat=[]}async loadTs(){if(!this.viewBinding){this.viewBinding=new e(this.host)}this.viewBinding.setTokenScript(this.tokenScript);this.tokenScript.setViewBinding(this.viewBinding);this.host.querySelector(".cards-container").style.display="block";this.populateCards();await this.populateTokens();this.loadView()}componentDidLoad(){if(this.tokenScript)this.loadTs()}setTokenContext(t){const i=t.split("-");this.tokenScript.setCurrentTokenContext(i[0],i.length>1?parseInt(i[1]):null);console.log("Token context set")}setCard(t){this.currentCardIndex=parseInt(t);this.loadView()}populateCards(){this.cards=this.tokenScript.getCards()}async populateTokens(){this.currentTokens=await this.tokenScript.getTokenMetadata();this.currentTokensFlat=Object.keys(this.currentTokens).reduce(((t,i)=>{if(this.currentTokens[i].nftDetails){const s=this.currentTokens[i].nftDetails.map(((t,s)=>Object.assign(Object.assign({},t),{contextId:i+"-"+s})));t.push(...s)}else{const s=Object.assign(Object.assign({},this.currentTokens[i]),{contextId:i});t.push(s)}return t}),[]);if(this.currentTokensFlat.length>0){await this.setTokenContext(this.currentTokensFlat[0].contextId)}}loadView(){if(this.cards.length===0)return;this.host.querySelector(".view-container").style.display="block";const t=this.cards[this.currentCardIndex];this.tokenScript.showTokenCard(t)}render(){return i("div",null,i("div",{class:"cards-container",style:{display:"none"}},i("h5",null,"Select Action"),i("select",{class:"card-select",onChange:t=>this.setCard(t.target.value)},this.cards?this.cards.map(((t,s)=>i("option",{value:s,selected:s===this.currentCardIndex},t.label))):""),i("h5",null,"Select Token Context"),i("select",{class:"token-select",onChange:t=>this.setTokenContext(t.target.value)},this.currentTokensFlat?this.currentTokensFlat.map(((t,s)=>i("option",{value:t.contextId},t.name+" ("+("tokenId"in t?t.collectionDetails.id+" #"+t.tokenId:t.name)+")"))):"")),i("div",{class:"view-container",style:{display:"none"}},i("div",{class:"view-loader",style:{display:"none"}},i("loading-spinner",null)),i("iframe",{class:"tokenscript-frame",sandbox:"allow-scripts allow-modals allow-forms"}),i("div",{class:"action-bar",style:{display:"none"}},i("button",{class:"action-btn"}))),i("div",null,i("security-status",{tokenScript:this.tokenScript}),i("table",{class:"attribute-table"})))}get host(){return s(this)}static get watchers(){return{tokenScript:["loadTs"]}}};a.style=n;export{a as debug_viewer_tab};
//# sourceMappingURL=p-da695a99.entry.js.map