import{c as t,a as e,g as i,b as r,d as n,r as s}from"./p-e52a38f8.js";function o(t){try{return JSON.stringify(t)}catch(t){return'"[Circular]"'}}var a=c;function c(t,e,i){var r=i&&i.stringify||o;var n=1;if(typeof t==="object"&&t!==null){var s=e.length+n;if(s===1)return t;var a=new Array(s);a[0]=r(t);for(var c=1;c<s;c++){a[c]=r(e[c])}return a.join(" ")}if(typeof t!=="string"){return t}var h=e.length;if(h===0)return t;var u="";var f=1-n;var l=-1;var d=t&&t.length||0;for(var p=0;p<d;){if(t.charCodeAt(p)===37&&p+1<d){l=l>-1?l:0;switch(t.charCodeAt(p+1)){case 100:case 102:if(f>=h)break;if(e[f]==null)break;if(l<p)u+=t.slice(l,p);u+=Number(e[f]);l=p+2;p++;break;case 105:if(f>=h)break;if(e[f]==null)break;if(l<p)u+=t.slice(l,p);u+=Math.floor(Number(e[f]));l=p+2;p++;break;case 79:case 111:case 106:if(f>=h)break;if(e[f]===undefined)break;if(l<p)u+=t.slice(l,p);var w=typeof e[f];if(w==="string"){u+="'"+e[f]+"'";l=p+2;p++;break}if(w==="function"){u+=e[f].name||"<anonymous>";l=p+2;p++;break}u+=r(e[f]);l=p+2;p++;break;case 115:if(f>=h)break;if(l<p)u+=t.slice(l,p);u+=String(e[f]);l=p+2;p++;break;case 37:if(l<p)u+=t.slice(l,p);u+="%";l=p+2;p++;f--;break}++f}++p}if(l===-1)return t;else if(l<d){u+=t.slice(l)}return u}var h=d;const u=M().console||{};const f={mapHttpRequest:O,mapHttpResponse:O,wrapRequestSerializer:S,wrapResponseSerializer:S,wrapErrorSerializer:S,req:O,res:O,err:g};function l(t,e){if(Array.isArray(t)){const e=t.filter((function(t){return t!=="!stdSerializers.err"}));return e}else if(t===true){return Object.keys(e)}return false}function d(t){t=t||{};t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!=="function"){throw Error("pino: transmit option must have a send function")}const i=t.browser.write||u;if(t.browser.write)t.browser.asObject=true;const r=t.serializers||{};const n=l(t.browser.serialize,r);let s=t.browser.serialize;if(Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1)s=false;const o=["error","fatal","warn","info","debug","trace"];if(typeof i==="function"){i.error=i.fatal=i.warn=i.info=i.debug=i.trace=i}if(t.enabled===false)t.level="silent";const a=t.level||"info";const c=Object.create(i);if(!c.log)c.log=I;Object.defineProperty(c,"levelVal",{get:f});Object.defineProperty(c,"level",{get:w,set:y});const h={transmit:e,serialize:n,asObject:t.browser.asObject,levels:o,timestamp:E(t)};c.levels=d.levels;c.level=a;c.setMaxListeners=c.getMaxListeners=c.emit=c.addListener=c.on=c.prependListener=c.once=c.prependOnceListener=c.removeListener=c.removeAllListeners=c.listeners=c.listenerCount=c.eventNames=c.write=c.flush=I;c.serializers=r;c._serialize=n;c._stdErrSerialize=s;c.child=m;if(e)c._logEvent=_();function f(){return this.level==="silent"?Infinity:this.levels.values[this.level]}function w(){return this._level}function y(t){if(t!=="silent"&&!this.levels.values[t]){throw Error("unknown level "+t)}this._level=t;p(h,c,"error","log");p(h,c,"fatal","error");p(h,c,"warn","error");p(h,c,"info","log");p(h,c,"debug","log");p(h,c,"trace","log")}function m(i,s){if(!i){throw new Error("missing bindings for child Pino")}s=s||{};if(n&&i.serializers){s.serializers=i.serializers}const o=s.serializers;if(n&&o){var a=Object.assign({},r,o);var c=t.browser.serialize===true?Object.keys(a):n;delete i.serializers;v([i],c,a,this._stdErrSerialize)}function h(t){this._childLevel=(t._childLevel|0)+1;this.error=b(t,i,"error");this.fatal=b(t,i,"fatal");this.warn=b(t,i,"warn");this.info=b(t,i,"info");this.debug=b(t,i,"debug");this.trace=b(t,i,"trace");if(a){this.serializers=a;this._serialize=c}if(e){this._logEvent=_([].concat(t._logEvent.bindings,i))}}h.prototype=this;return new h(this)}return c}d.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};d.stdSerializers=f;d.stdTimeFunctions=Object.assign({},{nullTime:j,epochTime:A,unixTime:N,isoTime:P});function p(t,e,i,r){const n=Object.getPrototypeOf(e);e[i]=e.levelVal>e.levels.values[i]?I:n[i]?n[i]:u[i]||u[r]||I;w(t,e,i)}function w(t,e,i){if(!t.transmit&&e[i]===I)return;e[i]=function(r){return function n(){const s=t.timestamp();const o=new Array(arguments.length);const a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===u?u:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];if(t.serialize&&!t.asObject){v(o,this._serialize,this.serializers,this._stdErrSerialize)}if(t.asObject)r.call(a,y(this,i,o,s));else r.apply(a,o);if(t.transmit){const r=t.transmit.level||e.level;const n=d.levels.values[r];const a=d.levels.values[i];if(a<n)return;m(this,{ts:s,methodLevel:i,methodValue:a,transmitLevel:r,transmitValue:d.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},o)}}}(e[i])}function y(t,e,i,r){if(t._serialize)v(i,t._serialize,t.serializers,t._stdErrSerialize);const n=i.slice();let s=n[0];const o={};if(r){o.time=r}o.level=d.levels.values[e];let c=(t._childLevel|0)+1;if(c<1)c=1;if(s!==null&&typeof s==="object"){while(c--&&typeof n[0]==="object"){Object.assign(o,n.shift())}s=n.length?a(n.shift(),n):undefined}else if(typeof s==="string")s=a(n.shift(),n);if(s!==undefined)o.msg=s;return o}function v(t,e,i,r){for(const n in t){if(r&&t[n]instanceof Error){t[n]=d.stdSerializers.err(t[n])}else if(typeof t[n]==="object"&&!Array.isArray(t[n])){for(const r in t[n]){if(e&&e.indexOf(r)>-1&&r in i){t[n][r]=i[r](t[n][r])}}}}}function b(t,e,i){return function(){const r=new Array(1+arguments.length);r[0]=e;for(var n=1;n<r.length;n++){r[n]=arguments[n-1]}return t[i].apply(this,r)}}function m(t,e,i){const r=e.send;const n=e.ts;const s=e.methodLevel;const o=e.methodValue;const a=e.val;const c=t._logEvent.bindings;v(i,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===undefined?true:t._stdErrSerialize);t._logEvent.ts=n;t._logEvent.messages=i.filter((function(t){return c.indexOf(t)===-1}));t._logEvent.level.label=s;t._logEvent.level.value=o;r(s,t._logEvent,a);t._logEvent=_(c)}function _(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function g(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const i in t){if(e[i]===undefined){e[i]=t[i]}}return e}function E(t){if(typeof t.timestamp==="function"){return t.timestamp}if(t.timestamp===false){return j}return A}function O(){return{}}function S(t){return t}function I(){}function j(){return false}function A(){return Date.now()}function N(){return Math.round(Date.now()/1e3)}function P(){return new Date(Date.now()).toISOString()}function M(){function t(t){return typeof t!=="undefined"&&t}try{if(typeof globalThis!=="undefined")return globalThis;Object.defineProperty(Object.prototype,"globalThis",{get:function(){delete Object.prototype.globalThis;return this.globalThis=this},configurable:true});return globalThis}catch(e){return t(self)||t(window)||t(this)||{}}}var x=typeof Reflect==="object"?Reflect:null;var T=x&&typeof x.apply==="function"?x.apply:function t(e,i,r){return Function.prototype.apply.call(e,i,r)};var U;if(x&&typeof x.ownKeys==="function"){U=x.ownKeys}else if(Object.getOwnPropertySymbols){U=function t(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}}else{U=function t(e){return Object.getOwnPropertyNames(e)}}function R(t){if(console&&console.warn)console.warn(t)}var C=Number.isNaN||function t(e){return e!==e};function $(){$.init.call(this)}var D=$;var k=X;$.EventEmitter=$;$.prototype._events=undefined;$.prototype._eventsCount=0;$.prototype._maxListeners=undefined;var L=10;function V(t){if(typeof t!=="function"){throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}}Object.defineProperty($,"defaultMaxListeners",{enumerable:true,get:function(){return L},set:function(t){if(typeof t!=="number"||t<0||C(t)){throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".")}L=t}});$.init=function(){if(this._events===undefined||this._events===Object.getPrototypeOf(this)._events){this._events=Object.create(null);this._eventsCount=0}this._maxListeners=this._maxListeners||undefined};$.prototype.setMaxListeners=function t(e){if(typeof e!=="number"||e<0||C(e)){throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".")}this._maxListeners=e;return this};function q(t){if(t._maxListeners===undefined)return $.defaultMaxListeners;return t._maxListeners}$.prototype.getMaxListeners=function t(){return q(this)};$.prototype.emit=function t(e){var i=[];for(var r=1;r<arguments.length;r++)i.push(arguments[r]);var n=e==="error";var s=this._events;if(s!==undefined)n=n&&s.error===undefined;else if(!n)return false;if(n){var o;if(i.length>0)o=i[0];if(o instanceof Error){throw o}var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));a.context=o;throw a}var c=s[e];if(c===undefined)return false;if(typeof c==="function"){T(c,this,i)}else{var h=c.length;var u=z(c,h);for(var r=0;r<h;++r)T(u[r],this,i)}return true};function F(t,e,i,r){var n;var s;var o;V(i);s=t._events;if(s===undefined){s=t._events=Object.create(null);t._eventsCount=0}else{if(s.newListener!==undefined){t.emit("newListener",e,i.listener?i.listener:i);s=t._events}o=s[e]}if(o===undefined){o=s[e]=i;++t._eventsCount}else{if(typeof o==="function"){o=s[e]=r?[i,o]:[o,i]}else if(r){o.unshift(i)}else{o.push(i)}n=q(t);if(n>0&&o.length>n&&!o.warned){o.warned=true;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners "+"added. Use emitter.setMaxListeners() to "+"increase limit");a.name="MaxListenersExceededWarning";a.emitter=t;a.type=e;a.count=o.length;R(a)}}return t}$.prototype.addListener=function t(e,i){return F(this,e,i,false)};$.prototype.on=$.prototype.addListener;$.prototype.prependListener=function t(e,i){return F(this,e,i,true)};function G(){if(!this.fired){this.target.removeListener(this.type,this.wrapFn);this.fired=true;if(arguments.length===0)return this.listener.call(this.target);return this.listener.apply(this.target,arguments)}}function B(t,e,i){var r={fired:false,wrapFn:undefined,target:t,type:e,listener:i};var n=G.bind(r);n.listener=i;r.wrapFn=n;return n}$.prototype.once=function t(e,i){V(i);this.on(e,B(this,e,i));return this};$.prototype.prependOnceListener=function t(e,i){V(i);this.prependListener(e,B(this,e,i));return this};$.prototype.removeListener=function t(e,i){var r,n,s,o,a;V(i);n=this._events;if(n===undefined)return this;r=n[e];if(r===undefined)return this;if(r===i||r.listener===i){if(--this._eventsCount===0)this._events=Object.create(null);else{delete n[e];if(n.removeListener)this.emit("removeListener",e,r.listener||i)}}else if(typeof r!=="function"){s=-1;for(o=r.length-1;o>=0;o--){if(r[o]===i||r[o].listener===i){a=r[o].listener;s=o;break}}if(s<0)return this;if(s===0)r.shift();else{W(r,s)}if(r.length===1)n[e]=r[0];if(n.removeListener!==undefined)this.emit("removeListener",e,a||i)}return this};$.prototype.off=$.prototype.removeListener;$.prototype.removeAllListeners=function t(e){var i,r,n;r=this._events;if(r===undefined)return this;if(r.removeListener===undefined){if(arguments.length===0){this._events=Object.create(null);this._eventsCount=0}else if(r[e]!==undefined){if(--this._eventsCount===0)this._events=Object.create(null);else delete r[e]}return this}if(arguments.length===0){var s=Object.keys(r);var o;for(n=0;n<s.length;++n){o=s[n];if(o==="removeListener")continue;this.removeAllListeners(o)}this.removeAllListeners("removeListener");this._events=Object.create(null);this._eventsCount=0;return this}i=r[e];if(typeof i==="function"){this.removeListener(e,i)}else if(i!==undefined){for(n=i.length-1;n>=0;n--){this.removeListener(e,i[n])}}return this};function H(t,e,i){var r=t._events;if(r===undefined)return[];var n=r[e];if(n===undefined)return[];if(typeof n==="function")return i?[n.listener||n]:[n];return i?J(n):z(n,n.length)}$.prototype.listeners=function t(e){return H(this,e,true)};$.prototype.rawListeners=function t(e){return H(this,e,false)};$.listenerCount=function(t,e){if(typeof t.listenerCount==="function"){return t.listenerCount(e)}else{return K.call(t,e)}};$.prototype.listenerCount=K;function K(t){var e=this._events;if(e!==undefined){var i=e[t];if(typeof i==="function"){return 1}else if(i!==undefined){return i.length}}return 0}$.prototype.eventNames=function t(){return this._eventsCount>0?U(this._events):[]};function z(t,e){var i=new Array(e);for(var r=0;r<e;++r)i[r]=t[r];return i}function W(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function J(t){var e=new Array(t.length);for(var i=0;i<e.length;++i){e[i]=t[i].listener||t[i]}return e}function X(t,e){return new Promise((function(i,r){function n(i){t.removeListener(e,s);r(i)}function s(){if(typeof t.removeListener==="function"){t.removeListener("error",n)}i([].slice.call(arguments))}Z(t,e,s,{once:true});if(e!=="error"){Y(t,n,{once:true})}}))}function Y(t,e,i){if(typeof t.on==="function"){Z(t,"error",e,i)}}function Z(t,e,i,r){if(typeof t.on==="function"){if(r.once){t.once(e,i)}else{t.on(e,i)}}else if(typeof t.addEventListener==="function"){t.addEventListener(e,(function n(s){if(r.once){t.removeEventListener(e,n)}i(s)}))}else{throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}}D.once=k;
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Q=function(t,e){Q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return Q(t,e)};function tt(t,e){Q(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var et=function(){et=Object.assign||function t(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s))e[s]=i[s]}return e};return et.apply(this,arguments)};function it(t,e){var i={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0)i[r]=t[r];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var n=0,r=Object.getOwnPropertySymbols(t);n<r.length;n++){if(e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n]))i[r[n]]=t[r[n]]}return i}function rt(t,e,i,r){var n=arguments.length,s=n<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r,o;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)if(o=t[a])s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s;return n>3&&s&&Object.defineProperty(e,i,s),s}function nt(t,e){return function(i,r){e(i,r,t)}}function st(t,e){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(t,e)}function ot(t,e,i,r){function n(t){return t instanceof i?t:new i((function(e){e(t)}))}return new(i||(i=Promise))((function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r["throw"](t))}catch(t){s(t)}}function c(t){t.done?i(t.value):n(t.value).then(o,a)}c((r=r.apply(t,e||[])).next())}))}function at(t,e){var i={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,n,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(t){return function(e){return c([t,e])}}function c(o){if(r)throw new TypeError("Generator is already executing.");while(i)try{if(r=1,n&&(s=o[0]&2?n["return"]:o[0]?n["throw"]||((s=n["return"])&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;if(n=0,s)o=[o[0]&2,s.value];switch(o[0]){case 0:case 1:s=o;break;case 4:i.label++;return{value:o[1],done:false};case 5:i.label++;n=o[1];o=[0];continue;case 7:o=i.ops.pop();i.trys.pop();continue;default:if(!(s=i.trys,s=s.length>0&&s[s.length-1])&&(o[0]===6||o[0]===2)){i=0;continue}if(o[0]===3&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(o[0]===6&&i.label<s[1]){i.label=s[1];s=o;break}if(s&&i.label<s[2]){i.label=s[2];i.ops.push(o);break}if(s[2])i.ops.pop();i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t];n=0}finally{r=s=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}}function ct(t,e,i,r){if(r===undefined)r=i;t[r]=e[i]}function ht(t,e){for(var i in t)if(i!=="default"&&!e.hasOwnProperty(i))e[i]=t[i]}function ut(t){var e=typeof Symbol==="function"&&Symbol.iterator,i=e&&t[e],r=0;if(i)return i.call(t);if(t&&typeof t.length==="number")return{next:function(){if(t&&r>=t.length)t=void 0;return{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ft(t,e){var i=typeof Symbol==="function"&&t[Symbol.iterator];if(!i)return t;var r=i.call(t),n,s=[],o;try{while((e===void 0||e-- >0)&&!(n=r.next()).done)s.push(n.value)}catch(t){o={error:t}}finally{try{if(n&&!n.done&&(i=r["return"]))i.call(r)}finally{if(o)throw o.error}}return s}function lt(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ft(arguments[e]));return t}function dt(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var r=Array(t),n=0,e=0;e<i;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,n++)r[n]=s[o];return r}function pt(t){return this instanceof pt?(this.v=t,this):new pt(t)}function wt(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=i.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(t){if(r[t])n[t]=function(e){return new Promise((function(i,r){s.push([t,e,i,r])>1||a(t,e)}))}}function a(t,e){try{c(r[t](e))}catch(t){f(s[0][3],t)}}function c(t){t.value instanceof pt?Promise.resolve(t.value.v).then(h,u):f(s[0][2],t)}function h(t){a("next",t)}function u(t){a("throw",t)}function f(t,e){if(t(e),s.shift(),s.length)a(s[0][0],s[0][1])}}function yt(t){var e,i;return e={},r("next"),r("throw",(function(t){throw t})),r("return"),e[Symbol.iterator]=function(){return this},e;function r(r,n){e[r]=t[r]?function(e){return(i=!i)?{value:pt(t[r](e)),done:r==="return"}:n?n(e):e}:n}}function vt(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],i;return e?e.call(t):(t=typeof ut==="function"?ut(t):t[Symbol.iterator](),i={},r("next"),r("throw"),r("return"),i[Symbol.asyncIterator]=function(){return this},i);function r(e){i[e]=t[e]&&function(i){return new Promise((function(r,s){i=t[e](i),n(r,s,i.done,i.value)}))}}function n(t,e,i,r){Promise.resolve(r).then((function(e){t({value:e,done:i})}),e)}}function bt(t,e){if(Object.defineProperty){Object.defineProperty(t,"raw",{value:e})}else{t.raw=e}return t}function mt(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var i in t)if(Object.hasOwnProperty.call(t,i))e[i]=t[i];e.default=t;return e}function _t(t){return t&&t.__esModule?t:{default:t}}function gt(t,e){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return e.get(t)}function Et(t,e,i){if(!e.has(t)){throw new TypeError("attempted to set private field on non-instance")}e.set(t,i);return i}const Ot=Object.freeze({__proto__:null,__extends:tt,get __assign(){return et},__rest:it,__decorate:rt,__param:nt,__metadata:st,__awaiter:ot,__generator:at,__createBinding:ct,__exportStar:ht,__values:ut,__read:ft,__spread:lt,__spreadArrays:dt,__await:pt,__asyncGenerator:wt,__asyncDelegator:yt,__asyncValues:vt,__makeTemplateObject:bt,__importStar:mt,__importDefault:_t,__classPrivateFieldGet:gt,__classPrivateFieldSet:Et});var St=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});function i(t){if(typeof t!=="string"){throw new Error(`Cannot safe json parse value of type ${typeof t}`)}try{return JSON.parse(t)}catch(e){return t}}e.safeJsonParse=i;function r(t){return typeof t==="string"?t:JSON.stringify(t,((t,e)=>typeof e==="undefined"?null:e))}e.safeJsonStringify=r}));var It=t((function(t){(function(){let i;function r(){}i=r;i.prototype.getItem=function(t){if(this.hasOwnProperty(t)){return String(this[t])}return null};i.prototype.setItem=function(t,e){this[t]=String(e)};i.prototype.removeItem=function(t){delete this[t]};i.prototype.clear=function(){const t=this;Object.keys(t).forEach((function(e){t[e]=undefined;delete t[e]}))};i.prototype.key=function(t){t=t||0;return Object.keys(this)[t]};i.prototype.__defineGetter__("length",(function(){return Object.keys(this).length}));if(typeof e!=="undefined"&&e.localStorage){t.exports=e.localStorage}else if(typeof window!=="undefined"&&window.localStorage){t.exports=window.localStorage}else{t.exports=new r}})()}));var jt=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.IKeyValueStorage=void 0;class i{}e.IKeyValueStorage=i}));var At=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.parseEntry=void 0;function i(t){var e;return[t[0],St.safeJsonParse((e=t[1])!==null&&e!==void 0?e:"")]}e.parseEntry=i}));const Nt=i(Ot);var Pt=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});Nt.__exportStar(jt,e);Nt.__exportStar(At,e)}));var Mt=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.KeyValueStorage=void 0;const i=Nt.__importDefault(It);class r{constructor(){this.localStorage=i.default}getKeys(){return Nt.__awaiter(this,void 0,void 0,(function*(){return Object.keys(this.localStorage)}))}getEntries(){return Nt.__awaiter(this,void 0,void 0,(function*(){return Object.entries(this.localStorage).map(Pt.parseEntry)}))}getItem(t){return Nt.__awaiter(this,void 0,void 0,(function*(){const e=this.localStorage.getItem(t);if(e===null){return undefined}return St.safeJsonParse(e)}))}setItem(t,e){return Nt.__awaiter(this,void 0,void 0,(function*(){this.localStorage.setItem(t,St.safeJsonStringify(e))}))}removeItem(t){return Nt.__awaiter(this,void 0,void 0,(function*(){this.localStorage.removeItem(t)}))}}e.KeyValueStorage=r;e.default=r}));const xt=r(Mt);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Tt=function(t,e){Tt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return Tt(t,e)};function Ut(t,e){Tt(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var Rt=function(){Rt=Object.assign||function t(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s))e[s]=i[s]}return e};return Rt.apply(this,arguments)};function Ct(t,e){var i={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0)i[r]=t[r];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var n=0,r=Object.getOwnPropertySymbols(t);n<r.length;n++){if(e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n]))i[r[n]]=t[r[n]]}return i}function $t(t,e,i,r){var n=arguments.length,s=n<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r,o;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)if(o=t[a])s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s;return n>3&&s&&Object.defineProperty(e,i,s),s}function Dt(t,e){return function(i,r){e(i,r,t)}}function kt(t,e){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(t,e)}function Lt(t,e,i,r){function n(t){return t instanceof i?t:new i((function(e){e(t)}))}return new(i||(i=Promise))((function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r["throw"](t))}catch(t){s(t)}}function c(t){t.done?i(t.value):n(t.value).then(o,a)}c((r=r.apply(t,e||[])).next())}))}function Vt(t,e){var i={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,n,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(t){return function(e){return c([t,e])}}function c(o){if(r)throw new TypeError("Generator is already executing.");while(i)try{if(r=1,n&&(s=o[0]&2?n["return"]:o[0]?n["throw"]||((s=n["return"])&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;if(n=0,s)o=[o[0]&2,s.value];switch(o[0]){case 0:case 1:s=o;break;case 4:i.label++;return{value:o[1],done:false};case 5:i.label++;n=o[1];o=[0];continue;case 7:o=i.ops.pop();i.trys.pop();continue;default:if(!(s=i.trys,s=s.length>0&&s[s.length-1])&&(o[0]===6||o[0]===2)){i=0;continue}if(o[0]===3&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(o[0]===6&&i.label<s[1]){i.label=s[1];s=o;break}if(s&&i.label<s[2]){i.label=s[2];i.ops.push(o);break}if(s[2])i.ops.pop();i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t];n=0}finally{r=s=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}}function qt(t,e,i,r){if(r===undefined)r=i;t[r]=e[i]}function Ft(t,e){for(var i in t)if(i!=="default"&&!e.hasOwnProperty(i))e[i]=t[i]}function Gt(t){var e=typeof Symbol==="function"&&Symbol.iterator,i=e&&t[e],r=0;if(i)return i.call(t);if(t&&typeof t.length==="number")return{next:function(){if(t&&r>=t.length)t=void 0;return{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Bt(t,e){var i=typeof Symbol==="function"&&t[Symbol.iterator];if(!i)return t;var r=i.call(t),n,s=[],o;try{while((e===void 0||e-- >0)&&!(n=r.next()).done)s.push(n.value)}catch(t){o={error:t}}finally{try{if(n&&!n.done&&(i=r["return"]))i.call(r)}finally{if(o)throw o.error}}return s}function Ht(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Bt(arguments[e]));return t}function Kt(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var r=Array(t),n=0,e=0;e<i;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,n++)r[n]=s[o];return r}function zt(t){return this instanceof zt?(this.v=t,this):new zt(t)}function Wt(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=i.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(t){if(r[t])n[t]=function(e){return new Promise((function(i,r){s.push([t,e,i,r])>1||a(t,e)}))}}function a(t,e){try{c(r[t](e))}catch(t){f(s[0][3],t)}}function c(t){t.value instanceof zt?Promise.resolve(t.value.v).then(h,u):f(s[0][2],t)}function h(t){a("next",t)}function u(t){a("throw",t)}function f(t,e){if(t(e),s.shift(),s.length)a(s[0][0],s[0][1])}}function Jt(t){var e,i;return e={},r("next"),r("throw",(function(t){throw t})),r("return"),e[Symbol.iterator]=function(){return this},e;function r(r,n){e[r]=t[r]?function(e){return(i=!i)?{value:zt(t[r](e)),done:r==="return"}:n?n(e):e}:n}}function Xt(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],i;return e?e.call(t):(t=typeof Gt==="function"?Gt(t):t[Symbol.iterator](),i={},r("next"),r("throw"),r("return"),i[Symbol.asyncIterator]=function(){return this},i);function r(e){i[e]=t[e]&&function(i){return new Promise((function(r,s){i=t[e](i),n(r,s,i.done,i.value)}))}}function n(t,e,i,r){Promise.resolve(r).then((function(e){t({value:e,done:i})}),e)}}function Yt(t,e){if(Object.defineProperty){Object.defineProperty(t,"raw",{value:e})}else{t.raw=e}return t}function Zt(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var i in t)if(Object.hasOwnProperty.call(t,i))e[i]=t[i];e.default=t;return e}function Qt(t){return t&&t.__esModule?t:{default:t}}function te(t,e){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return e.get(t)}function ee(t,e,i){if(!e.has(t)){throw new TypeError("attempted to set private field on non-instance")}e.set(t,i);return i}const ie=Object.freeze({__proto__:null,__extends:Ut,get __assign(){return Rt},__rest:Ct,__decorate:$t,__param:Dt,__metadata:kt,__awaiter:Lt,__generator:Vt,__createBinding:qt,__exportStar:Ft,__values:Gt,__read:Bt,__spread:Ht,__spreadArrays:Kt,__await:zt,__asyncGenerator:Wt,__asyncDelegator:Jt,__asyncValues:Xt,__makeTemplateObject:Yt,__importStar:Zt,__importDefault:Qt,__classPrivateFieldGet:te,__classPrivateFieldSet:ee});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var re=function(t,e){re=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return re(t,e)};function ne(t,e){re(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var se=function(){se=Object.assign||function t(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s))e[s]=i[s]}return e};return se.apply(this,arguments)};function oe(t,e){var i={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0)i[r]=t[r];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var n=0,r=Object.getOwnPropertySymbols(t);n<r.length;n++){if(e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n]))i[r[n]]=t[r[n]]}return i}function ae(t,e,i,r){var n=arguments.length,s=n<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r,o;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)if(o=t[a])s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s;return n>3&&s&&Object.defineProperty(e,i,s),s}function ce(t,e){return function(i,r){e(i,r,t)}}function he(t,e){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(t,e)}function ue(t,e,i,r){function n(t){return t instanceof i?t:new i((function(e){e(t)}))}return new(i||(i=Promise))((function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r["throw"](t))}catch(t){s(t)}}function c(t){t.done?i(t.value):n(t.value).then(o,a)}c((r=r.apply(t,e||[])).next())}))}function fe(t,e){var i={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,n,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(t){return function(e){return c([t,e])}}function c(o){if(r)throw new TypeError("Generator is already executing.");while(i)try{if(r=1,n&&(s=o[0]&2?n["return"]:o[0]?n["throw"]||((s=n["return"])&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;if(n=0,s)o=[o[0]&2,s.value];switch(o[0]){case 0:case 1:s=o;break;case 4:i.label++;return{value:o[1],done:false};case 5:i.label++;n=o[1];o=[0];continue;case 7:o=i.ops.pop();i.trys.pop();continue;default:if(!(s=i.trys,s=s.length>0&&s[s.length-1])&&(o[0]===6||o[0]===2)){i=0;continue}if(o[0]===3&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(o[0]===6&&i.label<s[1]){i.label=s[1];s=o;break}if(s&&i.label<s[2]){i.label=s[2];i.ops.push(o);break}if(s[2])i.ops.pop();i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t];n=0}finally{r=s=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}}function le(t,e,i,r){if(r===undefined)r=i;t[r]=e[i]}function de(t,e){for(var i in t)if(i!=="default"&&!e.hasOwnProperty(i))e[i]=t[i]}function pe(t){var e=typeof Symbol==="function"&&Symbol.iterator,i=e&&t[e],r=0;if(i)return i.call(t);if(t&&typeof t.length==="number")return{next:function(){if(t&&r>=t.length)t=void 0;return{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function we(t,e){var i=typeof Symbol==="function"&&t[Symbol.iterator];if(!i)return t;var r=i.call(t),n,s=[],o;try{while((e===void 0||e-- >0)&&!(n=r.next()).done)s.push(n.value)}catch(t){o={error:t}}finally{try{if(n&&!n.done&&(i=r["return"]))i.call(r)}finally{if(o)throw o.error}}return s}function ye(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(we(arguments[e]));return t}function ve(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var r=Array(t),n=0,e=0;e<i;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,n++)r[n]=s[o];return r}function be(t){return this instanceof be?(this.v=t,this):new be(t)}function me(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=i.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(t){if(r[t])n[t]=function(e){return new Promise((function(i,r){s.push([t,e,i,r])>1||a(t,e)}))}}function a(t,e){try{c(r[t](e))}catch(t){f(s[0][3],t)}}function c(t){t.value instanceof be?Promise.resolve(t.value.v).then(h,u):f(s[0][2],t)}function h(t){a("next",t)}function u(t){a("throw",t)}function f(t,e){if(t(e),s.shift(),s.length)a(s[0][0],s[0][1])}}function _e(t){var e,i;return e={},r("next"),r("throw",(function(t){throw t})),r("return"),e[Symbol.iterator]=function(){return this},e;function r(r,n){e[r]=t[r]?function(e){return(i=!i)?{value:be(t[r](e)),done:r==="return"}:n?n(e):e}:n}}function ge(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],i;return e?e.call(t):(t=typeof pe==="function"?pe(t):t[Symbol.iterator](),i={},r("next"),r("throw"),r("return"),i[Symbol.asyncIterator]=function(){return this},i);function r(e){i[e]=t[e]&&function(i){return new Promise((function(r,s){i=t[e](i),n(r,s,i.done,i.value)}))}}function n(t,e,i,r){Promise.resolve(r).then((function(e){t({value:e,done:i})}),e)}}function Ee(t,e){if(Object.defineProperty){Object.defineProperty(t,"raw",{value:e})}else{t.raw=e}return t}function Oe(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var i in t)if(Object.hasOwnProperty.call(t,i))e[i]=t[i];e.default=t;return e}function Se(t){return t&&t.__esModule?t:{default:t}}function Ie(t,e){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return e.get(t)}function je(t,e,i){if(!e.has(t)){throw new TypeError("attempted to set private field on non-instance")}e.set(t,i);return i}const Ae=Object.freeze({__proto__:null,__extends:ne,get __assign(){return se},__rest:oe,__decorate:ae,__param:ce,__metadata:he,__awaiter:ue,__generator:fe,__createBinding:le,__exportStar:de,__values:pe,__read:we,__spread:ye,__spreadArrays:ve,__await:be,__asyncGenerator:me,__asyncDelegator:_e,__asyncValues:ge,__makeTemplateObject:Ee,__importStar:Oe,__importDefault:Se,__classPrivateFieldGet:Ie,__classPrivateFieldSet:je});var Ne=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.delay=void 0;function i(t){return new Promise((e=>{setTimeout((()=>{e(true)}),t)}))}e.delay=i}));var Pe=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.ONE_THOUSAND=e.ONE_HUNDRED=void 0;e.ONE_HUNDRED=100;e.ONE_THOUSAND=1e3}));var Me=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.ONE_YEAR=e.FOUR_WEEKS=e.THREE_WEEKS=e.TWO_WEEKS=e.ONE_WEEK=e.THIRTY_DAYS=e.SEVEN_DAYS=e.FIVE_DAYS=e.THREE_DAYS=e.ONE_DAY=e.TWENTY_FOUR_HOURS=e.TWELVE_HOURS=e.SIX_HOURS=e.THREE_HOURS=e.ONE_HOUR=e.SIXTY_MINUTES=e.THIRTY_MINUTES=e.TEN_MINUTES=e.FIVE_MINUTES=e.ONE_MINUTE=e.SIXTY_SECONDS=e.THIRTY_SECONDS=e.TEN_SECONDS=e.FIVE_SECONDS=e.ONE_SECOND=void 0;e.ONE_SECOND=1;e.FIVE_SECONDS=5;e.TEN_SECONDS=10;e.THIRTY_SECONDS=30;e.SIXTY_SECONDS=60;e.ONE_MINUTE=e.SIXTY_SECONDS;e.FIVE_MINUTES=e.ONE_MINUTE*5;e.TEN_MINUTES=e.ONE_MINUTE*10;e.THIRTY_MINUTES=e.ONE_MINUTE*30;e.SIXTY_MINUTES=e.ONE_MINUTE*60;e.ONE_HOUR=e.SIXTY_MINUTES;e.THREE_HOURS=e.ONE_HOUR*3;e.SIX_HOURS=e.ONE_HOUR*6;e.TWELVE_HOURS=e.ONE_HOUR*12;e.TWENTY_FOUR_HOURS=e.ONE_HOUR*24;e.ONE_DAY=e.TWENTY_FOUR_HOURS;e.THREE_DAYS=e.ONE_DAY*3;e.FIVE_DAYS=e.ONE_DAY*5;e.SEVEN_DAYS=e.ONE_DAY*7;e.THIRTY_DAYS=e.ONE_DAY*30;e.ONE_WEEK=e.SEVEN_DAYS;e.TWO_WEEKS=e.ONE_WEEK*2;e.THREE_WEEKS=e.ONE_WEEK*3;e.FOUR_WEEKS=e.ONE_WEEK*4;e.ONE_YEAR=e.ONE_DAY*365}));const xe=i(Ae);var Te=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});xe.__exportStar(Pe,e);xe.__exportStar(Me,e)}));var Ue=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.fromMiliseconds=e.toMiliseconds=void 0;function i(t){return t*Te.ONE_THOUSAND}e.toMiliseconds=i;function r(t){return Math.floor(t/Te.ONE_THOUSAND)}e.fromMiliseconds=r}));var Re=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});xe.__exportStar(Ne,e);xe.__exportStar(Ue,e)}));var Ce=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.Watch=void 0;class i{constructor(){this.timestamps=new Map}start(t){if(this.timestamps.has(t)){throw new Error(`Watch already started for label: ${t}`)}this.timestamps.set(t,{started:Date.now()})}stop(t){const e=this.get(t);if(typeof e.elapsed!=="undefined"){throw new Error(`Watch already stopped for label: ${t}`)}const i=Date.now()-e.started;this.timestamps.set(t,{started:e.started,elapsed:i})}get(t){const e=this.timestamps.get(t);if(typeof e==="undefined"){throw new Error(`No timestamp found for label: ${t}`)}return e}elapsed(t){const e=this.get(t);const i=e.elapsed||Date.now()-e.started;return i}}e.Watch=i;e.default=i}));var $e=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.IWatch=void 0;class i{}e.IWatch=i}));var De=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});xe.__exportStar($e,e)}));var ke=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});xe.__exportStar(Re,e);xe.__exportStar(Ce,e);xe.__exportStar(De,e);xe.__exportStar(Te,e)}));class Le{}const Ve=Object.freeze({__proto__:null,IEvents:Le});const qe=i(Ve);var Fe=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.IHeartBeat=void 0;class i extends qe.IEvents{constructor(t){super()}}e.IHeartBeat=i}));const Ge=i(ie);var Be=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});Ge.__exportStar(Fe,e)}));var He=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.HEARTBEAT_EVENTS=e.HEARTBEAT_INTERVAL=void 0;e.HEARTBEAT_INTERVAL=ke.FIVE_SECONDS;e.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"}}));var Ke=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});Ge.__exportStar(He,e)}));var ze=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.HeartBeat=void 0;class i extends Be.IHeartBeat{constructor(t){super(t);this.events=new D.EventEmitter;this.interval=Ke.HEARTBEAT_INTERVAL;this.interval=(t===null||t===void 0?void 0:t.interval)||Ke.HEARTBEAT_INTERVAL}static init(t){return Ge.__awaiter(this,void 0,void 0,(function*(){const e=new i(t);yield e.init();return e}))}init(){return Ge.__awaiter(this,void 0,void 0,(function*(){yield this.initialize()}))}stop(){clearInterval(this.intervalRef)}on(t,e){this.events.on(t,e)}once(t,e){this.events.once(t,e)}off(t,e){this.events.off(t,e)}removeListener(t,e){this.events.removeListener(t,e)}initialize(){return Ge.__awaiter(this,void 0,void 0,(function*(){this.intervalRef=setInterval((()=>this.pulse()),ke.toMiliseconds(this.interval))}))}pulse(){this.events.emit(Ke.HEARTBEAT_EVENTS.pulse)}}e.HeartBeat=i}));var We=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});Ge.__exportStar(ze,e);Ge.__exportStar(Be,e);Ge.__exportStar(Ke,e)}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Je=function(t,e){Je=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return Je(t,e)};function Xe(t,e){Je(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var Ye=function(){Ye=Object.assign||function t(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s))e[s]=i[s]}return e};return Ye.apply(this,arguments)};function Ze(t,e){var i={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0)i[r]=t[r];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var n=0,r=Object.getOwnPropertySymbols(t);n<r.length;n++){if(e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n]))i[r[n]]=t[r[n]]}return i}function Qe(t,e,i,r){var n=arguments.length,s=n<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r,o;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)if(o=t[a])s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s;return n>3&&s&&Object.defineProperty(e,i,s),s}function ti(t,e){return function(i,r){e(i,r,t)}}function ei(t,e){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(t,e)}function ii(t,e,i,r){function n(t){return t instanceof i?t:new i((function(e){e(t)}))}return new(i||(i=Promise))((function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r["throw"](t))}catch(t){s(t)}}function c(t){t.done?i(t.value):n(t.value).then(o,a)}c((r=r.apply(t,e||[])).next())}))}function ri(t,e){var i={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,n,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(t){return function(e){return c([t,e])}}function c(o){if(r)throw new TypeError("Generator is already executing.");while(i)try{if(r=1,n&&(s=o[0]&2?n["return"]:o[0]?n["throw"]||((s=n["return"])&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;if(n=0,s)o=[o[0]&2,s.value];switch(o[0]){case 0:case 1:s=o;break;case 4:i.label++;return{value:o[1],done:false};case 5:i.label++;n=o[1];o=[0];continue;case 7:o=i.ops.pop();i.trys.pop();continue;default:if(!(s=i.trys,s=s.length>0&&s[s.length-1])&&(o[0]===6||o[0]===2)){i=0;continue}if(o[0]===3&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(o[0]===6&&i.label<s[1]){i.label=s[1];s=o;break}if(s&&i.label<s[2]){i.label=s[2];i.ops.push(o);break}if(s[2])i.ops.pop();i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t];n=0}finally{r=s=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}}function ni(t,e,i,r){if(r===undefined)r=i;t[r]=e[i]}function si(t,e){for(var i in t)if(i!=="default"&&!e.hasOwnProperty(i))e[i]=t[i]}function oi(t){var e=typeof Symbol==="function"&&Symbol.iterator,i=e&&t[e],r=0;if(i)return i.call(t);if(t&&typeof t.length==="number")return{next:function(){if(t&&r>=t.length)t=void 0;return{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ai(t,e){var i=typeof Symbol==="function"&&t[Symbol.iterator];if(!i)return t;var r=i.call(t),n,s=[],o;try{while((e===void 0||e-- >0)&&!(n=r.next()).done)s.push(n.value)}catch(t){o={error:t}}finally{try{if(n&&!n.done&&(i=r["return"]))i.call(r)}finally{if(o)throw o.error}}return s}function ci(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ai(arguments[e]));return t}function hi(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var r=Array(t),n=0,e=0;e<i;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,n++)r[n]=s[o];return r}function ui(t){return this instanceof ui?(this.v=t,this):new ui(t)}function fi(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=i.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(t){if(r[t])n[t]=function(e){return new Promise((function(i,r){s.push([t,e,i,r])>1||a(t,e)}))}}function a(t,e){try{c(r[t](e))}catch(t){f(s[0][3],t)}}function c(t){t.value instanceof ui?Promise.resolve(t.value.v).then(h,u):f(s[0][2],t)}function h(t){a("next",t)}function u(t){a("throw",t)}function f(t,e){if(t(e),s.shift(),s.length)a(s[0][0],s[0][1])}}function li(t){var e,i;return e={},r("next"),r("throw",(function(t){throw t})),r("return"),e[Symbol.iterator]=function(){return this},e;function r(r,n){e[r]=t[r]?function(e){return(i=!i)?{value:ui(t[r](e)),done:r==="return"}:n?n(e):e}:n}}function di(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],i;return e?e.call(t):(t=typeof oi==="function"?oi(t):t[Symbol.iterator](),i={},r("next"),r("throw"),r("return"),i[Symbol.asyncIterator]=function(){return this},i);function r(e){i[e]=t[e]&&function(i){return new Promise((function(r,s){i=t[e](i),n(r,s,i.done,i.value)}))}}function n(t,e,i,r){Promise.resolve(r).then((function(e){t({value:e,done:i})}),e)}}function pi(t,e){if(Object.defineProperty){Object.defineProperty(t,"raw",{value:e})}else{t.raw=e}return t}function wi(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var i in t)if(Object.hasOwnProperty.call(t,i))e[i]=t[i];e.default=t;return e}function yi(t){return t&&t.__esModule?t:{default:t}}function vi(t,e){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return e.get(t)}function bi(t,e,i){if(!e.has(t)){throw new TypeError("attempted to set private field on non-instance")}e.set(t,i);return i}const mi=Object.freeze({__proto__:null,__extends:Xe,get __assign(){return Ye},__rest:Ze,__decorate:Qe,__param:ti,__metadata:ei,__awaiter:ii,__generator:ri,__createBinding:ni,__exportStar:si,__values:oi,__read:ai,__spread:ci,__spreadArrays:hi,__await:ui,__asyncGenerator:fi,__asyncDelegator:li,__asyncValues:di,__makeTemplateObject:pi,__importStar:wi,__importDefault:yi,__classPrivateFieldGet:vi,__classPrivateFieldSet:bi});var _i=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.PINO_CUSTOM_CONTEXT_KEY=e.PINO_LOGGER_DEFAULTS=void 0;e.PINO_LOGGER_DEFAULTS={level:"info"};e.PINO_CUSTOM_CONTEXT_KEY="custom_context"}));var gi=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.generateChildLogger=e.formatChildLoggerContext=e.getLoggerContext=e.setBrowserLoggerContext=e.getBrowserLoggerContext=e.getDefaultLoggerOptions=void 0;function i(t){return Object.assign(Object.assign({},t),{level:(t===null||t===void 0?void 0:t.level)||_i.PINO_LOGGER_DEFAULTS.level})}e.getDefaultLoggerOptions=i;function r(t,e=_i.PINO_CUSTOM_CONTEXT_KEY){return t[e]||""}e.getBrowserLoggerContext=r;function n(t,e,i=_i.PINO_CUSTOM_CONTEXT_KEY){t[i]=e;return t}e.setBrowserLoggerContext=n;function s(t,e=_i.PINO_CUSTOM_CONTEXT_KEY){let i="";if(typeof t.bindings==="undefined"){i=r(t,e)}else{i=t.bindings().context||""}return i}e.getLoggerContext=s;function o(t,e,i=_i.PINO_CUSTOM_CONTEXT_KEY){const r=s(t,i);const n=r.trim()?`${r}/${e}`:e;return n}e.formatChildLoggerContext=o;function a(t,e,i=_i.PINO_CUSTOM_CONTEXT_KEY){const r=o(t,e,i);const s=t.child({context:r});return n(s,r,i)}e.generateChildLogger=a}));const Ei=i(mi);var Oi=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.pino=void 0;const i=Ei.__importDefault(h);Object.defineProperty(e,"pino",{enumerable:true,get:function(){return i.default}});Ei.__exportStar(_i,e);Ei.__exportStar(gi,e)}));class Si extends Le{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}class Ii extends Le{constructor(t,e){super(),this.core=t,this.logger=e,this.records=new Map}}class ji{constructor(t,e){this.logger=t,this.core=e}}class Ai extends Le{constructor(t,e){super(),this.relayer=t,this.logger=e}}class Ni extends Le{constructor(t){super()}}class Pi{constructor(t,e,i,r){this.core=t,this.logger=e,this.name=i}}class Mi extends Le{constructor(t,e){super(),this.relayer=t,this.logger=e}}class xi extends Le{constructor(t,e){super(),this.core=t,this.logger=e}}class Ti{constructor(t){this.opts=t,this.protocol="wc",this.version=2}}class Ui{constructor(t){this.client=t}}function Ri(t){if(typeof t!=="string"){throw new Error(`Cannot safe json parse value of type ${typeof t}`)}try{return JSON.parse(t)}catch(e){return t}}function Ci(t){return typeof t==="string"?t:JSON.stringify(t)}var $i=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.BrowserRandomSource=void 0;const i=65536;class r{constructor(){this.isAvailable=false;this.isInstantiated=false;const t=typeof self!=="undefined"?self.crypto||self.msCrypto:null;if(t&&t.getRandomValues!==undefined){this._crypto=t;this.isAvailable=true;this.isInstantiated=true}}randomBytes(t){if(!this.isAvailable||!this._crypto){throw new Error("Browser random byte generator is not available.")}const e=new Uint8Array(t);for(let t=0;t<e.length;t+=i){this._crypto.getRandomValues(e.subarray(t,t+Math.min(e.length-t,i)))}return e}}e.BrowserRandomSource=r}));var Di=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});function i(t){for(var e=0;e<t.length;e++){t[e]=0}return t}e.wipe=i}));var ki=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.NodeRandomSource=void 0;class i{constructor(){this.isAvailable=false;this.isInstantiated=false;if(typeof n!=="undefined"){const t=s;if(t&&t.randomBytes){this._crypto=t;this.isAvailable=true;this.isInstantiated=true}}}randomBytes(t){if(!this.isAvailable||!this._crypto){throw new Error("Node.js random byte generator is not available.")}let e=this._crypto.randomBytes(t);if(e.length!==t){throw new Error("NodeRandomSource: got fewer bytes than requested")}const i=new Uint8Array(t);for(let t=0;t<i.length;t++){i[t]=e[t]}(0,Di.wipe)(e);return i}}e.NodeRandomSource=i}));var Li=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.SystemRandomSource=void 0;class i{constructor(){this.isAvailable=false;this.name="";this._source=new $i.BrowserRandomSource;if(this._source.isAvailable){this.isAvailable=true;this.name="Browser";return}this._source=new ki.NodeRandomSource;if(this._source.isAvailable){this.isAvailable=true;this.name="Node";return}}randomBytes(t){if(!this.isAvailable){throw new Error("System random byte generator is not available.")}return this._source.randomBytes(t)}}e.SystemRandomSource=i}));var Vi=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});function i(t,e){var i=t>>>16&65535,r=t&65535;var n=e>>>16&65535,s=e&65535;return r*s+(i*s+r*n<<16>>>0)|0}e.mul=Math.imul||i;function r(t,e){return t+e|0}e.add=r;function n(t,e){return t-e|0}e.sub=n;function s(t,e){return t<<e|t>>>32-e}e.rotl=s;function o(t,e){return t<<32-e|t>>>e}e.rotr=o;function a(t){return typeof t==="number"&&isFinite(t)&&Math.floor(t)===t}e.isInteger=Number.isInteger||a;e.MAX_SAFE_INTEGER=9007199254740991;e.isSafeInteger=function(t){return e.isInteger(t)&&(t>=-e.MAX_SAFE_INTEGER&&t<=e.MAX_SAFE_INTEGER)}}));var qi=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});function i(t,e){if(e===void 0){e=0}return(t[e+0]<<8|t[e+1])<<16>>16}e.readInt16BE=i;function r(t,e){if(e===void 0){e=0}return(t[e+0]<<8|t[e+1])>>>0}e.readUint16BE=r;function n(t,e){if(e===void 0){e=0}return(t[e+1]<<8|t[e])<<16>>16}e.readInt16LE=n;function s(t,e){if(e===void 0){e=0}return(t[e+1]<<8|t[e])>>>0}e.readUint16LE=s;function o(t,e,i){if(e===void 0){e=new Uint8Array(2)}if(i===void 0){i=0}e[i+0]=t>>>8;e[i+1]=t>>>0;return e}e.writeUint16BE=o;e.writeInt16BE=o;function a(t,e,i){if(e===void 0){e=new Uint8Array(2)}if(i===void 0){i=0}e[i+0]=t>>>0;e[i+1]=t>>>8;return e}e.writeUint16LE=a;e.writeInt16LE=a;function c(t,e){if(e===void 0){e=0}return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}e.readInt32BE=c;function h(t,e){if(e===void 0){e=0}return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}e.readUint32BE=h;function u(t,e){if(e===void 0){e=0}return t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}e.readInt32LE=u;function f(t,e){if(e===void 0){e=0}return(t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e])>>>0}e.readUint32LE=f;function l(t,e,i){if(e===void 0){e=new Uint8Array(4)}if(i===void 0){i=0}e[i+0]=t>>>24;e[i+1]=t>>>16;e[i+2]=t>>>8;e[i+3]=t>>>0;return e}e.writeUint32BE=l;e.writeInt32BE=l;function d(t,e,i){if(e===void 0){e=new Uint8Array(4)}if(i===void 0){i=0}e[i+0]=t>>>0;e[i+1]=t>>>8;e[i+2]=t>>>16;e[i+3]=t>>>24;return e}e.writeUint32LE=d;e.writeInt32LE=d;function p(t,e){if(e===void 0){e=0}var i=c(t,e);var r=c(t,e+4);return i*4294967296+r-(r>>31)*4294967296}e.readInt64BE=p;function w(t,e){if(e===void 0){e=0}var i=h(t,e);var r=h(t,e+4);return i*4294967296+r}e.readUint64BE=w;function y(t,e){if(e===void 0){e=0}var i=u(t,e);var r=u(t,e+4);return r*4294967296+i-(i>>31)*4294967296}e.readInt64LE=y;function v(t,e){if(e===void 0){e=0}var i=f(t,e);var r=f(t,e+4);return r*4294967296+i}e.readUint64LE=v;function b(t,e,i){if(e===void 0){e=new Uint8Array(8)}if(i===void 0){i=0}l(t/4294967296>>>0,e,i);l(t>>>0,e,i+4);return e}e.writeUint64BE=b;e.writeInt64BE=b;function m(t,e,i){if(e===void 0){e=new Uint8Array(8)}if(i===void 0){i=0}d(t>>>0,e,i);d(t/4294967296>>>0,e,i+4);return e}e.writeUint64LE=m;e.writeInt64LE=m;function _(t,e,i){if(i===void 0){i=0}if(t%8!==0){throw new Error("readUintBE supports only bitLengths divisible by 8")}if(t/8>e.length-i){throw new Error("readUintBE: array is too short for the given bitLength")}var r=0;var n=1;for(var s=t/8+i-1;s>=i;s--){r+=e[s]*n;n*=256}return r}e.readUintBE=_;function g(t,e,i){if(i===void 0){i=0}if(t%8!==0){throw new Error("readUintLE supports only bitLengths divisible by 8")}if(t/8>e.length-i){throw new Error("readUintLE: array is too short for the given bitLength")}var r=0;var n=1;for(var s=i;s<i+t/8;s++){r+=e[s]*n;n*=256}return r}e.readUintLE=g;function E(t,e,i,r){if(i===void 0){i=new Uint8Array(t/8)}if(r===void 0){r=0}if(t%8!==0){throw new Error("writeUintBE supports only bitLengths divisible by 8")}if(!Vi.isSafeInteger(e)){throw new Error("writeUintBE value must be an integer")}var n=1;for(var s=t/8+r-1;s>=r;s--){i[s]=e/n&255;n*=256}return i}e.writeUintBE=E;function O(t,e,i,r){if(i===void 0){i=new Uint8Array(t/8)}if(r===void 0){r=0}if(t%8!==0){throw new Error("writeUintLE supports only bitLengths divisible by 8")}if(!Vi.isSafeInteger(e)){throw new Error("writeUintLE value must be an integer")}var n=1;for(var s=r;s<r+t/8;s++){i[s]=e/n&255;n*=256}return i}e.writeUintLE=O;function S(t,e){if(e===void 0){e=0}var i=new DataView(t.buffer,t.byteOffset,t.byteLength);return i.getFloat32(e)}e.readFloat32BE=S;function I(t,e){if(e===void 0){e=0}var i=new DataView(t.buffer,t.byteOffset,t.byteLength);return i.getFloat32(e,true)}e.readFloat32LE=I;function j(t,e){if(e===void 0){e=0}var i=new DataView(t.buffer,t.byteOffset,t.byteLength);return i.getFloat64(e)}e.readFloat64BE=j;function A(t,e){if(e===void 0){e=0}var i=new DataView(t.buffer,t.byteOffset,t.byteLength);return i.getFloat64(e,true)}e.readFloat64LE=A;function N(t,e,i){if(e===void 0){e=new Uint8Array(4)}if(i===void 0){i=0}var r=new DataView(e.buffer,e.byteOffset,e.byteLength);r.setFloat32(i,t);return e}e.writeFloat32BE=N;function P(t,e,i){if(e===void 0){e=new Uint8Array(4)}if(i===void 0){i=0}var r=new DataView(e.buffer,e.byteOffset,e.byteLength);r.setFloat32(i,t,true);return e}e.writeFloat32LE=P;function M(t,e,i){if(e===void 0){e=new Uint8Array(8)}if(i===void 0){i=0}var r=new DataView(e.buffer,e.byteOffset,e.byteLength);r.setFloat64(i,t);return e}e.writeFloat64BE=M;function x(t,e,i){if(e===void 0){e=new Uint8Array(8)}if(i===void 0){i=0}var r=new DataView(e.buffer,e.byteOffset,e.byteLength);r.setFloat64(i,t,true);return e}e.writeFloat64LE=x}));var Fi=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.randomStringForEntropy=e.randomString=e.randomUint32=e.randomBytes=e.defaultRandomSource=void 0;e.defaultRandomSource=new Li.SystemRandomSource;function i(t,i=e.defaultRandomSource){return i.randomBytes(t)}e.randomBytes=i;function r(t=e.defaultRandomSource){const r=i(4,t);const n=(0,qi.readUint32LE)(r);(0,Di.wipe)(r);return n}e.randomUint32=r;const n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function s(t,r=n,s=e.defaultRandomSource){if(r.length<2){throw new Error("randomString charset is too short")}if(r.length>256){throw new Error("randomString charset is too long")}let o="";const a=r.length;const c=256-256%a;while(t>0){const e=i(Math.ceil(t*256/c),s);for(let i=0;i<e.length&&t>0;i++){const n=e[i];if(n<c){o+=r.charAt(n%a);t--}}(0,Di.wipe)(e)}return o}e.randomString=s;function o(t,i=n,r=e.defaultRandomSource){const o=Math.ceil(t/(Math.log(i.length)/Math.LN2));return s(o,i,r)}e.randomStringForEntropy=o}));var Gi=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.DIGEST_LENGTH=64;e.BLOCK_SIZE=128;var i=function(){function t(){this.digestLength=e.DIGEST_LENGTH;this.blockSize=e.BLOCK_SIZE;this._stateHi=new Int32Array(8);this._stateLo=new Int32Array(8);this._tempHi=new Int32Array(16);this._tempLo=new Int32Array(16);this._buffer=new Uint8Array(256);this._bufferLength=0;this._bytesHashed=0;this._finished=false;this.reset()}t.prototype._initState=function(){this._stateHi[0]=1779033703;this._stateHi[1]=3144134277;this._stateHi[2]=1013904242;this._stateHi[3]=2773480762;this._stateHi[4]=1359893119;this._stateHi[5]=2600822924;this._stateHi[6]=528734635;this._stateHi[7]=1541459225;this._stateLo[0]=4089235720;this._stateLo[1]=2227873595;this._stateLo[2]=4271175723;this._stateLo[3]=1595750129;this._stateLo[4]=2917565137;this._stateLo[5]=725511199;this._stateLo[6]=4215389547;this._stateLo[7]=327033209};t.prototype.reset=function(){this._initState();this._bufferLength=0;this._bytesHashed=0;this._finished=false;return this};t.prototype.clean=function(){Di.wipe(this._buffer);Di.wipe(this._tempHi);Di.wipe(this._tempLo);this.reset()};t.prototype.update=function(t,i){if(i===void 0){i=t.length}if(this._finished){throw new Error("SHA512: can't update because hash was finished.")}var r=0;this._bytesHashed+=i;if(this._bufferLength>0){while(this._bufferLength<e.BLOCK_SIZE&&i>0){this._buffer[this._bufferLength++]=t[r++];i--}if(this._bufferLength===this.blockSize){n(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize);this._bufferLength=0}}if(i>=this.blockSize){r=n(this._tempHi,this._tempLo,this._stateHi,this._stateLo,t,r,i);i%=this.blockSize}while(i>0){this._buffer[this._bufferLength++]=t[r++];i--}return this};t.prototype.finish=function(t){if(!this._finished){var e=this._bytesHashed;var i=this._bufferLength;var r=e/536870912|0;var s=e<<3;var o=e%128<112?128:256;this._buffer[i]=128;for(var a=i+1;a<o-8;a++){this._buffer[a]=0}qi.writeUint32BE(r,this._buffer,o-8);qi.writeUint32BE(s,this._buffer,o-4);n(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,o);this._finished=true}for(var a=0;a<this.digestLength/8;a++){qi.writeUint32BE(this._stateHi[a],t,a*8);qi.writeUint32BE(this._stateLo[a],t,a*8+4)}return this};t.prototype.digest=function(){var t=new Uint8Array(this.digestLength);this.finish(t);return t};t.prototype.saveState=function(){if(this._finished){throw new Error("SHA256: cannot save finished state")}return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):undefined,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}};t.prototype.restoreState=function(t){this._stateHi.set(t.stateHi);this._stateLo.set(t.stateLo);this._bufferLength=t.bufferLength;if(t.buffer){this._buffer.set(t.buffer)}this._bytesHashed=t.bytesHashed;this._finished=false;return this};t.prototype.cleanSavedState=function(t){Di.wipe(t.stateHi);Di.wipe(t.stateLo);if(t.buffer){Di.wipe(t.buffer)}t.bufferLength=0;t.bytesHashed=0};return t}();e.SHA512=i;var r=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function n(t,e,i,n,s,o,a){var c=i[0],h=i[1],u=i[2],f=i[3],l=i[4],d=i[5],p=i[6],w=i[7],y=n[0],v=n[1],b=n[2],m=n[3],_=n[4],g=n[5],E=n[6],O=n[7];var S,I;var j,A;var N,P,M,x;while(a>=128){for(var T=0;T<16;T++){var U=8*T+o;t[T]=qi.readUint32BE(s,U);e[T]=qi.readUint32BE(s,U+4)}for(var T=0;T<80;T++){var R=c;var C=h;var $=u;var D=f;var k=l;var L=d;var V=p;var q=w;var F=y;var G=v;var B=b;var H=m;var K=_;var z=g;var W=E;var J=O;S=w;I=O;N=I&65535;P=I>>>16;M=S&65535;x=S>>>16;S=(l>>>14|_<<32-14)^(l>>>18|_<<32-18)^(_>>>41-32|l<<32-(41-32));I=(_>>>14|l<<32-14)^(_>>>18|l<<32-18)^(l>>>41-32|_<<32-(41-32));N+=I&65535;P+=I>>>16;M+=S&65535;x+=S>>>16;S=l&d^~l&p;I=_&g^~_&E;N+=I&65535;P+=I>>>16;M+=S&65535;x+=S>>>16;S=r[T*2];I=r[T*2+1];N+=I&65535;P+=I>>>16;M+=S&65535;x+=S>>>16;S=t[T%16];I=e[T%16];N+=I&65535;P+=I>>>16;M+=S&65535;x+=S>>>16;P+=N>>>16;M+=P>>>16;x+=M>>>16;j=M&65535|x<<16;A=N&65535|P<<16;S=j;I=A;N=I&65535;P=I>>>16;M=S&65535;x=S>>>16;S=(c>>>28|y<<32-28)^(y>>>34-32|c<<32-(34-32))^(y>>>39-32|c<<32-(39-32));I=(y>>>28|c<<32-28)^(c>>>34-32|y<<32-(34-32))^(c>>>39-32|y<<32-(39-32));N+=I&65535;P+=I>>>16;M+=S&65535;x+=S>>>16;S=c&h^c&u^h&u;I=y&v^y&b^v&b;N+=I&65535;P+=I>>>16;M+=S&65535;x+=S>>>16;P+=N>>>16;M+=P>>>16;x+=M>>>16;q=M&65535|x<<16;J=N&65535|P<<16;S=D;I=H;N=I&65535;P=I>>>16;M=S&65535;x=S>>>16;S=j;I=A;N+=I&65535;P+=I>>>16;M+=S&65535;x+=S>>>16;P+=N>>>16;M+=P>>>16;x+=M>>>16;D=M&65535|x<<16;H=N&65535|P<<16;h=R;u=C;f=$;l=D;d=k;p=L;w=V;c=q;v=F;b=G;m=B;_=H;g=K;E=z;O=W;y=J;if(T%16===15){for(var U=0;U<16;U++){S=t[U];I=e[U];N=I&65535;P=I>>>16;M=S&65535;x=S>>>16;S=t[(U+9)%16];I=e[(U+9)%16];N+=I&65535;P+=I>>>16;M+=S&65535;x+=S>>>16;j=t[(U+1)%16];A=e[(U+1)%16];S=(j>>>1|A<<32-1)^(j>>>8|A<<32-8)^j>>>7;I=(A>>>1|j<<32-1)^(A>>>8|j<<32-8)^(A>>>7|j<<32-7);N+=I&65535;P+=I>>>16;M+=S&65535;x+=S>>>16;j=t[(U+14)%16];A=e[(U+14)%16];S=(j>>>19|A<<32-19)^(A>>>61-32|j<<32-(61-32))^j>>>6;I=(A>>>19|j<<32-19)^(j>>>61-32|A<<32-(61-32))^(A>>>6|j<<32-6);N+=I&65535;P+=I>>>16;M+=S&65535;x+=S>>>16;P+=N>>>16;M+=P>>>16;x+=M>>>16;t[U]=M&65535|x<<16;e[U]=N&65535|P<<16}}}S=c;I=y;N=I&65535;P=I>>>16;M=S&65535;x=S>>>16;S=i[0];I=n[0];N+=I&65535;P+=I>>>16;M+=S&65535;x+=S>>>16;P+=N>>>16;M+=P>>>16;x+=M>>>16;i[0]=c=M&65535|x<<16;n[0]=y=N&65535|P<<16;S=h;I=v;N=I&65535;P=I>>>16;M=S&65535;x=S>>>16;S=i[1];I=n[1];N+=I&65535;P+=I>>>16;M+=S&65535;x+=S>>>16;P+=N>>>16;M+=P>>>16;x+=M>>>16;i[1]=h=M&65535|x<<16;n[1]=v=N&65535|P<<16;S=u;I=b;N=I&65535;P=I>>>16;M=S&65535;x=S>>>16;S=i[2];I=n[2];N+=I&65535;P+=I>>>16;M+=S&65535;x+=S>>>16;P+=N>>>16;M+=P>>>16;x+=M>>>16;i[2]=u=M&65535|x<<16;n[2]=b=N&65535|P<<16;S=f;I=m;N=I&65535;P=I>>>16;M=S&65535;x=S>>>16;S=i[3];I=n[3];N+=I&65535;P+=I>>>16;M+=S&65535;x+=S>>>16;P+=N>>>16;M+=P>>>16;x+=M>>>16;i[3]=f=M&65535|x<<16;n[3]=m=N&65535|P<<16;S=l;I=_;N=I&65535;P=I>>>16;M=S&65535;x=S>>>16;S=i[4];I=n[4];N+=I&65535;P+=I>>>16;M+=S&65535;x+=S>>>16;P+=N>>>16;M+=P>>>16;x+=M>>>16;i[4]=l=M&65535|x<<16;n[4]=_=N&65535|P<<16;S=d;I=g;N=I&65535;P=I>>>16;M=S&65535;x=S>>>16;S=i[5];I=n[5];N+=I&65535;P+=I>>>16;M+=S&65535;x+=S>>>16;P+=N>>>16;M+=P>>>16;x+=M>>>16;i[5]=d=M&65535|x<<16;n[5]=g=N&65535|P<<16;S=p;I=E;N=I&65535;P=I>>>16;M=S&65535;x=S>>>16;S=i[6];I=n[6];N+=I&65535;P+=I>>>16;M+=S&65535;x+=S>>>16;P+=N>>>16;M+=P>>>16;x+=M>>>16;i[6]=p=M&65535|x<<16;n[6]=E=N&65535|P<<16;S=w;I=O;N=I&65535;P=I>>>16;M=S&65535;x=S>>>16;S=i[7];I=n[7];N+=I&65535;P+=I>>>16;M+=S&65535;x+=S>>>16;P+=N>>>16;M+=P>>>16;x+=M>>>16;i[7]=w=M&65535|x<<16;n[7]=O=N&65535|P<<16;o+=128;a-=128}return o}function s(t){var e=new i;e.update(t);var r=e.digest();e.clean();return r}e.hash=s}));var Bi=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.convertSecretKeyToX25519=e.convertPublicKeyToX25519=e.verify=e.sign=e.extractPublicKeyFromSecretKey=e.generateKeyPair=e.generateKeyPairFromSeed=e.SEED_LENGTH=e.SECRET_KEY_LENGTH=e.PUBLIC_KEY_LENGTH=e.SIGNATURE_LENGTH=void 0;e.SIGNATURE_LENGTH=64;e.PUBLIC_KEY_LENGTH=32;e.SECRET_KEY_LENGTH=64;e.SEED_LENGTH=32;function i(t){const e=new Float64Array(16);if(t){for(let i=0;i<t.length;i++){e[i]=t[i]}}return e}const r=new Uint8Array(32);r[0]=9;const n=i();const s=i([1]);const o=i([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]);const a=i([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]);const c=i([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]);const h=i([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]);const u=i([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function f(t,e){for(let i=0;i<16;i++){t[i]=e[i]|0}}function l(t){let e=1;for(let i=0;i<16;i++){let r=t[i]+e+65535;e=Math.floor(r/65536);t[i]=r-e*65536}t[0]+=e-1+37*(e-1)}function d(t,e,i){const r=~(i-1);for(let i=0;i<16;i++){const n=r&(t[i]^e[i]);t[i]^=n;e[i]^=n}}function p(t,e){const r=i();const n=i();for(let t=0;t<16;t++){n[t]=e[t]}l(n);l(n);l(n);for(let t=0;t<2;t++){r[0]=n[0]-65517;for(let t=1;t<15;t++){r[t]=n[t]-65535-(r[t-1]>>16&1);r[t-1]&=65535}r[15]=n[15]-32767-(r[14]>>16&1);const t=r[15]>>16&1;r[14]&=65535;d(n,r,1-t)}for(let e=0;e<16;e++){t[2*e]=n[e]&255;t[2*e+1]=n[e]>>8}}function w(t,e){let i=0;for(let r=0;r<32;r++){i|=t[r]^e[r]}return(1&i-1>>>8)-1}function y(t,e){const i=new Uint8Array(32);const r=new Uint8Array(32);p(i,t);p(r,e);return w(i,r)}function v(t){const e=new Uint8Array(32);p(e,t);return e[0]&1}function b(t,e){for(let i=0;i<16;i++){t[i]=e[2*i]+(e[2*i+1]<<8)}t[15]&=32767}function m(t,e,i){for(let r=0;r<16;r++){t[r]=e[r]+i[r]}}function _(t,e,i){for(let r=0;r<16;r++){t[r]=e[r]-i[r]}}function g(t,e,i){let r,n,s=0,o=0,a=0,c=0,h=0,u=0,f=0,l=0,d=0,p=0,w=0,y=0,v=0,b=0,m=0,_=0,g=0,E=0,O=0,S=0,I=0,j=0,A=0,N=0,P=0,M=0,x=0,T=0,U=0,R=0,C=0,$=i[0],D=i[1],k=i[2],L=i[3],V=i[4],q=i[5],F=i[6],G=i[7],B=i[8],H=i[9],K=i[10],z=i[11],W=i[12],J=i[13],X=i[14],Y=i[15];r=e[0];s+=r*$;o+=r*D;a+=r*k;c+=r*L;h+=r*V;u+=r*q;f+=r*F;l+=r*G;d+=r*B;p+=r*H;w+=r*K;y+=r*z;v+=r*W;b+=r*J;m+=r*X;_+=r*Y;r=e[1];o+=r*$;a+=r*D;c+=r*k;h+=r*L;u+=r*V;f+=r*q;l+=r*F;d+=r*G;p+=r*B;w+=r*H;y+=r*K;v+=r*z;b+=r*W;m+=r*J;_+=r*X;g+=r*Y;r=e[2];a+=r*$;c+=r*D;h+=r*k;u+=r*L;f+=r*V;l+=r*q;d+=r*F;p+=r*G;w+=r*B;y+=r*H;v+=r*K;b+=r*z;m+=r*W;_+=r*J;g+=r*X;E+=r*Y;r=e[3];c+=r*$;h+=r*D;u+=r*k;f+=r*L;l+=r*V;d+=r*q;p+=r*F;w+=r*G;y+=r*B;v+=r*H;b+=r*K;m+=r*z;_+=r*W;g+=r*J;E+=r*X;O+=r*Y;r=e[4];h+=r*$;u+=r*D;f+=r*k;l+=r*L;d+=r*V;p+=r*q;w+=r*F;y+=r*G;v+=r*B;b+=r*H;m+=r*K;_+=r*z;g+=r*W;E+=r*J;O+=r*X;S+=r*Y;r=e[5];u+=r*$;f+=r*D;l+=r*k;d+=r*L;p+=r*V;w+=r*q;y+=r*F;v+=r*G;b+=r*B;m+=r*H;_+=r*K;g+=r*z;E+=r*W;O+=r*J;S+=r*X;I+=r*Y;r=e[6];f+=r*$;l+=r*D;d+=r*k;p+=r*L;w+=r*V;y+=r*q;v+=r*F;b+=r*G;m+=r*B;_+=r*H;g+=r*K;E+=r*z;O+=r*W;S+=r*J;I+=r*X;j+=r*Y;r=e[7];l+=r*$;d+=r*D;p+=r*k;w+=r*L;y+=r*V;v+=r*q;b+=r*F;m+=r*G;_+=r*B;g+=r*H;E+=r*K;O+=r*z;S+=r*W;I+=r*J;j+=r*X;A+=r*Y;r=e[8];d+=r*$;p+=r*D;w+=r*k;y+=r*L;v+=r*V;b+=r*q;m+=r*F;_+=r*G;g+=r*B;E+=r*H;O+=r*K;S+=r*z;I+=r*W;j+=r*J;A+=r*X;N+=r*Y;r=e[9];p+=r*$;w+=r*D;y+=r*k;v+=r*L;b+=r*V;m+=r*q;_+=r*F;g+=r*G;E+=r*B;O+=r*H;S+=r*K;I+=r*z;j+=r*W;A+=r*J;N+=r*X;P+=r*Y;r=e[10];w+=r*$;y+=r*D;v+=r*k;b+=r*L;m+=r*V;_+=r*q;g+=r*F;E+=r*G;O+=r*B;S+=r*H;I+=r*K;j+=r*z;A+=r*W;N+=r*J;P+=r*X;M+=r*Y;r=e[11];y+=r*$;v+=r*D;b+=r*k;m+=r*L;_+=r*V;g+=r*q;E+=r*F;O+=r*G;S+=r*B;I+=r*H;j+=r*K;A+=r*z;N+=r*W;P+=r*J;M+=r*X;x+=r*Y;r=e[12];v+=r*$;b+=r*D;m+=r*k;_+=r*L;g+=r*V;E+=r*q;O+=r*F;S+=r*G;I+=r*B;j+=r*H;A+=r*K;N+=r*z;P+=r*W;M+=r*J;x+=r*X;T+=r*Y;r=e[13];b+=r*$;m+=r*D;_+=r*k;g+=r*L;E+=r*V;O+=r*q;S+=r*F;I+=r*G;j+=r*B;A+=r*H;N+=r*K;P+=r*z;M+=r*W;x+=r*J;T+=r*X;U+=r*Y;r=e[14];m+=r*$;_+=r*D;g+=r*k;E+=r*L;O+=r*V;S+=r*q;I+=r*F;j+=r*G;A+=r*B;N+=r*H;P+=r*K;M+=r*z;x+=r*W;T+=r*J;U+=r*X;R+=r*Y;r=e[15];_+=r*$;g+=r*D;E+=r*k;O+=r*L;S+=r*V;I+=r*q;j+=r*F;A+=r*G;N+=r*B;P+=r*H;M+=r*K;x+=r*z;T+=r*W;U+=r*J;R+=r*X;C+=r*Y;s+=38*g;o+=38*E;a+=38*O;c+=38*S;h+=38*I;u+=38*j;f+=38*A;l+=38*N;d+=38*P;p+=38*M;w+=38*x;y+=38*T;v+=38*U;b+=38*R;m+=38*C;n=1;r=s+n+65535;n=Math.floor(r/65536);s=r-n*65536;r=o+n+65535;n=Math.floor(r/65536);o=r-n*65536;r=a+n+65535;n=Math.floor(r/65536);a=r-n*65536;r=c+n+65535;n=Math.floor(r/65536);c=r-n*65536;r=h+n+65535;n=Math.floor(r/65536);h=r-n*65536;r=u+n+65535;n=Math.floor(r/65536);u=r-n*65536;r=f+n+65535;n=Math.floor(r/65536);f=r-n*65536;r=l+n+65535;n=Math.floor(r/65536);l=r-n*65536;r=d+n+65535;n=Math.floor(r/65536);d=r-n*65536;r=p+n+65535;n=Math.floor(r/65536);p=r-n*65536;r=w+n+65535;n=Math.floor(r/65536);w=r-n*65536;r=y+n+65535;n=Math.floor(r/65536);y=r-n*65536;r=v+n+65535;n=Math.floor(r/65536);v=r-n*65536;r=b+n+65535;n=Math.floor(r/65536);b=r-n*65536;r=m+n+65535;n=Math.floor(r/65536);m=r-n*65536;r=_+n+65535;n=Math.floor(r/65536);_=r-n*65536;s+=n-1+37*(n-1);n=1;r=s+n+65535;n=Math.floor(r/65536);s=r-n*65536;r=o+n+65535;n=Math.floor(r/65536);o=r-n*65536;r=a+n+65535;n=Math.floor(r/65536);a=r-n*65536;r=c+n+65535;n=Math.floor(r/65536);c=r-n*65536;r=h+n+65535;n=Math.floor(r/65536);h=r-n*65536;r=u+n+65535;n=Math.floor(r/65536);u=r-n*65536;r=f+n+65535;n=Math.floor(r/65536);f=r-n*65536;r=l+n+65535;n=Math.floor(r/65536);l=r-n*65536;r=d+n+65535;n=Math.floor(r/65536);d=r-n*65536;r=p+n+65535;n=Math.floor(r/65536);p=r-n*65536;r=w+n+65535;n=Math.floor(r/65536);w=r-n*65536;r=y+n+65535;n=Math.floor(r/65536);y=r-n*65536;r=v+n+65535;n=Math.floor(r/65536);v=r-n*65536;r=b+n+65535;n=Math.floor(r/65536);b=r-n*65536;r=m+n+65535;n=Math.floor(r/65536);m=r-n*65536;r=_+n+65535;n=Math.floor(r/65536);_=r-n*65536;s+=n-1+37*(n-1);t[0]=s;t[1]=o;t[2]=a;t[3]=c;t[4]=h;t[5]=u;t[6]=f;t[7]=l;t[8]=d;t[9]=p;t[10]=w;t[11]=y;t[12]=v;t[13]=b;t[14]=m;t[15]=_}function E(t,e){g(t,e,e)}function O(t,e){const r=i();let n;for(n=0;n<16;n++){r[n]=e[n]}for(n=253;n>=0;n--){E(r,r);if(n!==2&&n!==4){g(r,r,e)}}for(n=0;n<16;n++){t[n]=r[n]}}function S(t,e){const r=i();let n;for(n=0;n<16;n++){r[n]=e[n]}for(n=250;n>=0;n--){E(r,r);if(n!==1){g(r,r,e)}}for(n=0;n<16;n++){t[n]=r[n]}}function I(t,e){const r=i(),n=i(),s=i(),o=i(),c=i(),h=i(),u=i(),f=i(),l=i();_(r,t[1],t[0]);_(l,e[1],e[0]);g(r,r,l);m(n,t[0],t[1]);m(l,e[0],e[1]);g(n,n,l);g(s,t[3],e[3]);g(s,s,a);g(o,t[2],e[2]);m(o,o,o);_(c,n,r);_(h,o,s);m(u,o,s);m(f,n,r);g(t[0],c,h);g(t[1],f,u);g(t[2],u,h);g(t[3],c,f)}function j(t,e,i){for(let r=0;r<4;r++){d(t[r],e[r],i)}}function A(t,e){const r=i(),n=i(),s=i();O(s,e[2]);g(r,e[0],s);g(n,e[1],s);p(t,n);t[31]^=v(r)<<7}function N(t,e,i){f(t[0],n);f(t[1],s);f(t[2],s);f(t[3],n);for(let r=255;r>=0;--r){const n=i[r/8|0]>>(r&7)&1;j(t,e,n);I(e,t);I(t,t);j(t,e,n)}}function P(t,e){const r=[i(),i(),i(),i()];f(r[0],c);f(r[1],h);f(r[2],s);g(r[3],c,h);N(t,r,e)}function M(t){if(t.length!==e.SEED_LENGTH){throw new Error(`ed25519: seed must be ${e.SEED_LENGTH} bytes`)}const r=(0,Gi.hash)(t);r[0]&=248;r[31]&=127;r[31]|=64;const n=new Uint8Array(32);const s=[i(),i(),i(),i()];P(s,r);A(n,s);const o=new Uint8Array(64);o.set(t);o.set(n,32);return{publicKey:n,secretKey:o}}e.generateKeyPairFromSeed=M;function x(t){const e=(0,Fi.randomBytes)(32,t);const i=M(e);(0,Di.wipe)(e);return i}e.generateKeyPair=x;function T(t){if(t.length!==e.SECRET_KEY_LENGTH){throw new Error(`ed25519: secret key must be ${e.SECRET_KEY_LENGTH} bytes`)}return new Uint8Array(t.subarray(32))}e.extractPublicKeyFromSecretKey=T;const U=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function R(t,e){let i;let r;let n;let s;for(r=63;r>=32;--r){i=0;for(n=r-32,s=r-12;n<s;++n){e[n]+=i-16*e[r]*U[n-(r-32)];i=Math.floor((e[n]+128)/256);e[n]-=i*256}e[n]+=i;e[r]=0}i=0;for(n=0;n<32;n++){e[n]+=i-(e[31]>>4)*U[n];i=e[n]>>8;e[n]&=255}for(n=0;n<32;n++){e[n]-=i*U[n]}for(r=0;r<32;r++){e[r+1]+=e[r]>>8;t[r]=e[r]&255}}function C(t){const e=new Float64Array(64);for(let i=0;i<64;i++){e[i]=t[i]}for(let e=0;e<64;e++){t[e]=0}R(t,e)}function $(t,e){const r=new Float64Array(64);const n=[i(),i(),i(),i()];const s=(0,Gi.hash)(t.subarray(0,32));s[0]&=248;s[31]&=127;s[31]|=64;const o=new Uint8Array(64);o.set(s.subarray(32),32);const a=new Gi.SHA512;a.update(o.subarray(32));a.update(e);const c=a.digest();a.clean();C(c);P(n,c);A(o,n);a.reset();a.update(o.subarray(0,32));a.update(t.subarray(32));a.update(e);const h=a.digest();C(h);for(let t=0;t<32;t++){r[t]=c[t]}for(let t=0;t<32;t++){for(let e=0;e<32;e++){r[t+e]+=h[t]*s[e]}}R(o.subarray(32),r);return o}e.sign=$;function D(t,e){const r=i(),a=i(),c=i(),h=i(),l=i(),d=i(),p=i();f(t[2],s);b(t[1],e);E(c,t[1]);g(h,c,o);_(c,c,t[2]);m(h,t[2],h);E(l,h);E(d,l);g(p,d,l);g(r,p,c);g(r,r,h);S(r,r);g(r,r,c);g(r,r,h);g(r,r,h);g(t[0],r,h);E(a,t[0]);g(a,a,h);if(y(a,c)){g(t[0],t[0],u)}E(a,t[0]);g(a,a,h);if(y(a,c)){return-1}if(v(t[0])===e[31]>>7){_(t[0],n,t[0])}g(t[3],t[0],t[1]);return 0}function k(t,r,n){const s=new Uint8Array(32);const o=[i(),i(),i(),i()];const a=[i(),i(),i(),i()];if(n.length!==e.SIGNATURE_LENGTH){throw new Error(`ed25519: signature must be ${e.SIGNATURE_LENGTH} bytes`)}if(D(a,t)){return false}const c=new Gi.SHA512;c.update(n.subarray(0,32));c.update(t);c.update(r);const h=c.digest();C(h);N(o,a,h);P(a,n.subarray(32));I(o,a);A(s,o);if(w(n,s)){return false}return true}e.verify=k;function L(t){let e=[i(),i(),i(),i()];if(D(e,t)){throw new Error("Ed25519: invalid public key")}let r=i();let n=i();let o=e[1];m(r,s,o);_(n,s,o);O(n,n);g(r,r,n);let a=new Uint8Array(32);p(a,r);return a}e.convertPublicKeyToX25519=L;function V(t){const e=(0,Gi.hash)(t.subarray(0,32));e[0]&=248;e[31]&=127;e[31]|=64;const i=new Uint8Array(e.subarray(0,32));(0,Di.wipe)(e);return i}e.convertSecretKeyToX25519=V}));const Hi="EdDSA";const Ki="JWT";const zi=".";const Wi="base64url";const Ji="utf8";const Xi="utf8";const Yi=":";const Zi="did";const Qi="key";const tr="base58btc";const er="z";const ir="K36";const rr=32;var nr=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});function i(t=0){if(globalThis.Buffer!=null&&globalThis.Buffer.alloc!=null){return globalThis.Buffer.alloc(t)}return new Uint8Array(t)}function r(t=0){if(globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null){return globalThis.Buffer.allocUnsafe(t)}return new Uint8Array(t)}e.alloc=i;e.allocUnsafe=r}));var sr=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});function i(t,e){if(!e){e=t.reduce(((t,e)=>t+e.length),0)}const i=nr.allocUnsafe(e);let r=0;for(const e of t){i.set(e,r);r+=e.length}return i}e.concat=i}));function or(t,e){if(t.length>=255){throw new TypeError("Alphabet too long")}var i=new Uint8Array(256);for(var r=0;r<i.length;r++){i[r]=255}for(var n=0;n<t.length;n++){var s=t.charAt(n);var o=s.charCodeAt(0);if(i[o]!==255){throw new TypeError(s+" is ambiguous")}i[o]=n}var a=t.length;var c=t.charAt(0);var h=Math.log(a)/Math.log(256);var u=Math.log(256)/Math.log(a);function f(e){if(e instanceof Uint8Array);else if(ArrayBuffer.isView(e)){e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}else if(Array.isArray(e)){e=Uint8Array.from(e)}if(!(e instanceof Uint8Array)){throw new TypeError("Expected Uint8Array")}if(e.length===0){return""}var i=0;var r=0;var n=0;var s=e.length;while(n!==s&&e[n]===0){n++;i++}var o=(s-n)*u+1>>>0;var h=new Uint8Array(o);while(n!==s){var f=e[n];var l=0;for(var d=o-1;(f!==0||l<r)&&d!==-1;d--,l++){f+=256*h[d]>>>0;h[d]=f%a>>>0;f=f/a>>>0}if(f!==0){throw new Error("Non-zero carry")}r=l;n++}var p=o-r;while(p!==o&&h[p]===0){p++}var w=c.repeat(i);for(;p<o;++p){w+=t.charAt(h[p])}return w}function l(t){if(typeof t!=="string"){throw new TypeError("Expected String")}if(t.length===0){return new Uint8Array}var e=0;if(t[e]===" "){return}var r=0;var n=0;while(t[e]===c){r++;e++}var s=(t.length-e)*h+1>>>0;var o=new Uint8Array(s);while(t[e]){var u=i[t.charCodeAt(e)];if(u===255){return}var f=0;for(var l=s-1;(u!==0||f<n)&&l!==-1;l--,f++){u+=a*o[l]>>>0;o[l]=u%256>>>0;u=u/256>>>0}if(u!==0){throw new Error("Non-zero carry")}n=f;e++}if(t[e]===" "){return}var d=s-n;while(d!==s&&o[d]===0){d++}var p=new Uint8Array(r+(s-d));var w=r;while(d!==s){p[w++]=o[d++]}return p}function d(t){var i=l(t);if(i){return i}throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:l,decode:d}}var ar=or;var cr=ar;var hr=cr;var ur=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});const i=new Uint8Array(0);const r=t=>t.reduce(((t,e)=>t+e.toString(16).padStart(2,"0")),"");const n=t=>{const e=t.match(/../g);return e?new Uint8Array(e.map((t=>parseInt(t,16)))):i};const s=(t,e)=>{if(t===e)return true;if(t.byteLength!==e.byteLength){return false}for(let i=0;i<t.byteLength;i++){if(t[i]!==e[i]){return false}}return true};const o=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t)){return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}throw new Error("Unknown type, must be binary type")};const a=t=>t instanceof ArrayBuffer||ArrayBuffer.isView(t);const c=t=>(new TextEncoder).encode(t);const h=t=>(new TextDecoder).decode(t);e.coerce=o;e.empty=i;e.equals=s;e.fromHex=n;e.fromString=c;e.isBinary=a;e.toHex=r;e.toString=h}));var fr=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});class i{constructor(t,e,i){this.name=t;this.prefix=e;this.baseEncode=i}encode(t){if(t instanceof Uint8Array){return`${this.prefix}${this.baseEncode(t)}`}else{throw Error("Unknown type, must be binary type")}}}class r{constructor(t,e,i){this.name=t;this.prefix=e;if(e.codePointAt(0)===undefined){throw new Error("Invalid prefix character")}this.prefixCodePoint=e.codePointAt(0);this.baseDecode=i}decode(t){if(typeof t==="string"){if(t.codePointAt(0)!==this.prefixCodePoint){throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`)}return this.baseDecode(t.slice(this.prefix.length))}else{throw Error("Can only multibase decode strings")}}or(t){return s(this,t)}}class n{constructor(t){this.decoders=t}or(t){return s(this,t)}decode(t){const e=t[0];const i=this.decoders[e];if(i){return i.decode(t)}else{throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}}const s=(t,e)=>new n({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class o{constructor(t,e,n,s){this.name=t;this.prefix=e;this.baseEncode=n;this.baseDecode=s;this.encoder=new i(t,e,n);this.decoder=new r(t,e,s)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const a=({name:t,prefix:e,encode:i,decode:r})=>new o(t,e,i,r);const c=({prefix:t,name:e,alphabet:i})=>{const{encode:r,decode:n}=hr(i,e);return a({prefix:t,name:e,encode:r,decode:t=>ur.coerce(n(t))})};const h=(t,e,i,r)=>{const n={};for(let t=0;t<e.length;++t){n[e[t]]=t}let s=t.length;while(t[s-1]==="="){--s}const o=new Uint8Array(s*i/8|0);let a=0;let c=0;let h=0;for(let e=0;e<s;++e){const s=n[t[e]];if(s===undefined){throw new SyntaxError(`Non-${r} character`)}c=c<<i|s;a+=i;if(a>=8){a-=8;o[h++]=255&c>>a}}if(a>=i||255&c<<8-a){throw new SyntaxError("Unexpected end of data")}return o};const u=(t,e,i)=>{const r=e[e.length-1]==="=";const n=(1<<i)-1;let s="";let o=0;let a=0;for(let r=0;r<t.length;++r){a=a<<8|t[r];o+=8;while(o>i){o-=i;s+=e[n&a>>o]}}if(o){s+=e[n&a<<i-o]}if(r){while(s.length*i&7){s+="="}}return s};const f=({name:t,prefix:e,bitsPerChar:i,alphabet:r})=>a({prefix:e,name:t,encode(t){return u(t,r,i)},decode(e){return h(e,r,i,t)}});e.Codec=o;e.baseX=c;e.from=a;e.or=s;e.rfc4648=f}));var lr=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});const i=fr.from({prefix:"\0",name:"identity",encode:t=>ur.toString(t),decode:t=>ur.fromString(t)});e.identity=i}));var dr=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});const i=fr.rfc4648({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});e.base2=i}));var pr=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});const i=fr.rfc4648({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});e.base8=i}));var wr=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});const i=fr.baseX({prefix:"9",name:"base10",alphabet:"0123456789"});e.base10=i}));var yr=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});const i=fr.rfc4648({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4});const r=fr.rfc4648({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});e.base16=i;e.base16upper=r}));var vr=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});const i=fr.rfc4648({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});const r=fr.rfc4648({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});const n=fr.rfc4648({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});const s=fr.rfc4648({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});const o=fr.rfc4648({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});const a=fr.rfc4648({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});const c=fr.rfc4648({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});const h=fr.rfc4648({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});const u=fr.rfc4648({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});e.base32=i;e.base32hex=o;e.base32hexpad=c;e.base32hexpadupper=h;e.base32hexupper=a;e.base32pad=n;e.base32padupper=s;e.base32upper=r;e.base32z=u}));var br=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});const i=fr.baseX({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});const r=fr.baseX({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});e.base36=i;e.base36upper=r}));var mr=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});const i=fr.baseX({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});const r=fr.baseX({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});e.base58btc=i;e.base58flickr=r}));var _r=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});const i=fr.rfc4648({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});const r=fr.rfc4648({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});const n=fr.rfc4648({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});const s=fr.rfc4648({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});e.base64=i;e.base64pad=r;e.base64url=n;e.base64urlpad=s}));var gr=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});const i=Array.from("");const r=i.reduce(((t,e,i)=>{t[i]=e;return t}),[]);const n=i.reduce(((t,e,i)=>{t[e.codePointAt(0)]=i;return t}),[]);function s(t){return t.reduce(((t,e)=>{t+=r[e];return t}),"")}function o(t){const e=[];for(const i of t){const t=n[i.codePointAt(0)];if(t===undefined){throw new Error(`Non-base256emoji character: ${i}`)}e.push(t)}return new Uint8Array(e)}const a=fr.from({prefix:"",name:"base256emoji",encode:s,decode:o});e.base256emoji=a}));var Er=Ar;var Or=128,Sr=127,Ir=~Sr,jr=Math.pow(2,31);function Ar(t,e,i){e=e||[];i=i||0;var r=i;while(t>=jr){e[i++]=t&255|Or;t/=128}while(t&Ir){e[i++]=t&255|Or;t>>>=7}e[i]=t|0;Ar.bytes=i-r+1;return e}var Nr=xr;var Pr=128,Mr=127;function xr(t,e){var i=0,e=e||0,r=0,n=e,s,o=t.length;do{if(n>=o){xr.bytes=0;throw new RangeError("Could not decode varint")}s=t[n++];i+=r<28?(s&Mr)<<r:(s&Mr)*Math.pow(2,r);r+=7}while(s>=Pr);xr.bytes=n-e;return i}var Tr=Math.pow(2,7);var Ur=Math.pow(2,14);var Rr=Math.pow(2,21);var Cr=Math.pow(2,28);var $r=Math.pow(2,35);var Dr=Math.pow(2,42);var kr=Math.pow(2,49);var Lr=Math.pow(2,56);var Vr=Math.pow(2,63);var qr=function(t){return t<Tr?1:t<Ur?2:t<Rr?3:t<Cr?4:t<$r?5:t<Dr?6:t<kr?7:t<Lr?8:t<Vr?9:10};var Fr={encode:Er,decode:Nr,encodingLength:qr};var Gr=Fr;var Br=Gr;var Hr=Br;var Kr=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});const i=(t,e=0)=>{const i=Hr.decode(t,e);return[i,Hr.decode.bytes]};const r=(t,e,i=0)=>{Hr.encode(t,e,i);return e};const n=t=>Hr.encodingLength(t);e.decode=i;e.encodeTo=r;e.encodingLength=n}));var zr=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});const i=(t,e)=>{const i=e.byteLength;const r=Kr.encodingLength(t);const n=r+Kr.encodingLength(i);const o=new Uint8Array(n+i);Kr.encodeTo(t,o,0);Kr.encodeTo(i,o,r);o.set(e,n);return new s(t,i,e,o)};const r=t=>{const e=ur.coerce(t);const[i,r]=Kr.decode(e);const[n,o]=Kr.decode(e.subarray(r));const a=e.subarray(r+o);if(a.byteLength!==n){throw new Error("Incorrect length")}return new s(i,n,a,e)};const n=(t,e)=>{if(t===e){return true}else{return t.code===e.code&&t.size===e.size&&ur.equals(t.bytes,e.bytes)}};class s{constructor(t,e,i,r){this.code=t;this.size=e;this.digest=i;this.bytes=r}}e.Digest=s;e.create=i;e.decode=r;e.equals=n}));var Wr=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});const i=({name:t,code:e,encode:i})=>new r(t,e,i);class r{constructor(t,e,i){this.name=t;this.code=e;this.encode=i}digest(t){if(t instanceof Uint8Array){const e=this.encode(t);return e instanceof Uint8Array?zr.create(this.code,e):e.then((t=>zr.create(this.code,t)))}else{throw Error("Unknown type, must be binary type")}}}e.Hasher=r;e.from=i}));var Jr=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});const i=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e));const r=Wr.from({name:"sha2-256",code:18,encode:i("SHA-256")});const n=Wr.from({name:"sha2-512",code:19,encode:i("SHA-512")});e.sha256=r;e.sha512=n}));var Xr=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});const i=0;const r="identity";const n=ur.coerce;const s=t=>zr.create(i,n(t));const o={code:i,name:r,encode:n,digest:s};e.identity=o}));var Yr=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});const i="raw";const r=85;const n=t=>ur.coerce(t);const s=t=>ur.coerce(t);e.code=r;e.decode=s;e.encode=n;e.name=i}));var Zr=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});const i=new TextEncoder;const r=new TextDecoder;const n="json";const s=512;const o=t=>i.encode(JSON.stringify(t));const a=t=>JSON.parse(r.decode(t));e.code=s;e.decode=a;e.encode=o;e.name=n}));var Qr=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});class i{constructor(t,e,i,r){this.code=e;this.version=t;this.multihash=i;this.bytes=r;this.byteOffset=r.byteOffset;this.byteLength=r.byteLength;this.asCID=this;this._baseCache=new Map;Object.defineProperties(this,{byteOffset:f,byteLength:f,code:u,version:u,multihash:u,bytes:u,_baseCache:f,asCID:f})}toV0(){switch(this.version){case 0:{return this}default:{const{code:t,multihash:e}=this;if(t!==o){throw new Error("Cannot convert a non dag-pb CID to CIDv0")}if(e.code!==a){throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0")}return i.createV0(e)}}}toV1(){switch(this.version){case 0:{const{code:t,digest:e}=this.multihash;const r=zr.create(t,e);return i.createV1(this.code,r)}case 1:{return this}default:{throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}}equals(t){return t&&this.code===t.code&&this.version===t.version&&zr.equals(this.multihash,t.multihash)}toString(t){const{bytes:e,version:i,_baseCache:r}=this;switch(i){case 0:return n(e,r,t||mr.base58btc.encoder);default:return s(e,r,t||vr.base32.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(t){d(/^0\.0/,p);return!!(t&&(t[h]||t.asCID===t))}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(t){if(t instanceof i){return t}else if(t!=null&&t.asCID===t){const{version:e,code:r,multihash:n,bytes:s}=t;return new i(e,r,n,s||c(e,r,n.bytes))}else if(t!=null&&t[h]===true){const{version:e,multihash:r,code:n}=t;const s=zr.decode(r);return i.create(e,n,s)}else{return null}}static create(t,e,r){if(typeof e!=="number"){throw new Error("String codecs are no longer supported")}switch(t){case 0:{if(e!==o){throw new Error(`Version 0 CID must use dag-pb (code: ${o}) block encoding`)}else{return new i(t,e,r,r.bytes)}}case 1:{const n=c(t,e,r.bytes);return new i(t,e,r,n)}default:{throw new Error("Invalid version")}}}static createV0(t){return i.create(0,o,t)}static createV1(t,e){return i.create(1,t,e)}static decode(t){const[e,r]=i.decodeFirst(t);if(r.length){throw new Error("Incorrect length")}return e}static decodeFirst(t){const e=i.inspectBytes(t);const r=e.size-e.multihashSize;const n=ur.coerce(t.subarray(r,r+e.multihashSize));if(n.byteLength!==e.multihashSize){throw new Error("Incorrect length")}const s=n.subarray(e.multihashSize-e.digestSize);const o=new zr.Digest(e.multihashCode,e.digestSize,s,n);const a=e.version===0?i.createV0(o):i.createV1(e.codec,o);return[a,t.subarray(e.size)]}static inspectBytes(t){let e=0;const i=()=>{const[i,r]=Kr.decode(t.subarray(e));e+=r;return i};let r=i();let n=o;if(r===18){r=0;e=0}else if(r===1){n=i()}if(r!==0&&r!==1){throw new RangeError(`Invalid CID version ${r}`)}const s=e;const a=i();const c=i();const h=e+c;const u=h-s;return{version:r,codec:n,multihashCode:a,digestSize:c,multihashSize:u,size:h}}static parse(t,e){const[n,s]=r(t,e);const o=i.decode(s);o._baseCache.set(n,t);return o}}const r=(t,e)=>{switch(t[0]){case"Q":{const i=e||mr.base58btc;return[mr.base58btc.prefix,i.decode(`${mr.base58btc.prefix}${t}`)]}case mr.base58btc.prefix:{const i=e||mr.base58btc;return[mr.base58btc.prefix,i.decode(t)]}case vr.base32.prefix:{const i=e||vr.base32;return[vr.base32.prefix,i.decode(t)]}default:{if(e==null){throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided")}return[t[0],e.decode(t)]}}};const n=(t,e,i)=>{const{prefix:r}=i;if(r!==mr.base58btc.prefix){throw Error(`Cannot string encode V0 in ${i.name} encoding`)}const n=e.get(r);if(n==null){const n=i.encode(t).slice(1);e.set(r,n);return n}else{return n}};const s=(t,e,i)=>{const{prefix:r}=i;const n=e.get(r);if(n==null){const n=i.encode(t);e.set(r,n);return n}else{return n}};const o=112;const a=18;const c=(t,e,i)=>{const r=Kr.encodingLength(t);const n=r+Kr.encodingLength(e);const s=new Uint8Array(n+i.byteLength);Kr.encodeTo(t,s,0);Kr.encodeTo(e,s,r);s.set(i,n);return s};const h=Symbol.for("@ipld/js-cid/CID");const u={writable:false,configurable:false,enumerable:true};const f={writable:false,enumerable:false,configurable:false};const l="0.0.0-dev";const d=(t,e)=>{if(t.test(l)){console.warn(e)}else{throw new Error(e)}};const p=`CID.isCID(v) is deprecated and will be removed in the next major release.\nFollowing code pattern:\n\nif (CID.isCID(value)) {\n  doSomethingWithCID(value)\n}\n\nIs replaced with:\n\nconst cid = CID.asCID(value)\nif (cid) {\n  // Make sure to use cid instead of value\n  doSomethingWithCID(cid)\n}\n`;e.CID=i}));t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.CID=Qr.CID;e.varint=Kr;e.bytes=ur;e.hasher=Wr;e.digest=zr}));var tn=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});const i={...lr,...dr,...pr,...wr,...yr,...vr,...br,...mr,..._r,...gr};const r={...Jr,...Xr};const n={raw:Yr,json:Zr};e.CID=Qr.CID;e.hasher=Wr;e.digest=zr;e.varint=Kr;e.bytes=ur;e.bases=i;e.codecs=n;e.hashes=r}));function en(t,e,i,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:i},decoder:{decode:r}}}const rn=en("utf8","u",(t=>{const e=new TextDecoder("utf8");return"u"+e.decode(t)}),(t=>{const e=new TextEncoder;return e.encode(t.substring(1))}));const nn=en("ascii","a",(t=>{let e="a";for(let i=0;i<t.length;i++){e+=String.fromCharCode(t[i])}return e}),(t=>{t=t.substring(1);const e=nr.allocUnsafe(t.length);for(let i=0;i<t.length;i++){e[i]=t.charCodeAt(i)}return e}));const sn={utf8:rn,"utf-8":rn,hex:tn.bases.base16,latin1:nn,ascii:nn,binary:nn,...tn.bases};var on=sn;var an=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});function i(t,e="utf8"){const i=on[e];if(!i){throw new Error(`Unsupported encoding "${e}"`)}if((e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null){return globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8")}return i.encoder.encode(t).substring(1)}e.toString=i}));var cn=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});function i(t,e="utf8"){const i=on[e];if(!i){throw new Error(`Unsupported encoding "${e}"`)}if((e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null){return globalThis.Buffer.from(t,"utf8")}return i.decoder.decode(`${i.prefix}${t}`)}e.fromString=i}));function hn(t){return an.toString(cn.fromString(Ci(t),Ji),Wi)}function un(t){const e=cn.fromString(ir,tr);const i=er+an.toString(sr.concat([e,t]),tr);return[Zi,Qi,i].join(Yi)}function fn(t){return an.toString(t,Wi)}function ln(t){return cn.fromString([hn(t.header),hn(t.payload)].join(zi),Xi)}function dn(t){return[hn(t.header),hn(t.payload),fn(t.signature)].join(zi)}function pn(t=Fi.randomBytes(rr)){return Bi.generateKeyPairFromSeed(t)}async function wn(t,e,i,r,n=ke.fromMiliseconds(Date.now())){const s={alg:Hi,typ:Ki};const o=un(r.publicKey);const a=n+i;const c={iss:o,sub:t,aud:e,iat:n,exp:a};const h=ln({header:s,payload:c});const u=Bi.sign(r.secretKey,h);return dn({header:s,payload:c,signature:u})}var yn=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});var i=20;function r(t,e,r){var n=1634760805;var s=857760878;var o=2036477234;var a=1797285236;var c=r[3]<<24|r[2]<<16|r[1]<<8|r[0];var h=r[7]<<24|r[6]<<16|r[5]<<8|r[4];var u=r[11]<<24|r[10]<<16|r[9]<<8|r[8];var f=r[15]<<24|r[14]<<16|r[13]<<8|r[12];var l=r[19]<<24|r[18]<<16|r[17]<<8|r[16];var d=r[23]<<24|r[22]<<16|r[21]<<8|r[20];var p=r[27]<<24|r[26]<<16|r[25]<<8|r[24];var w=r[31]<<24|r[30]<<16|r[29]<<8|r[28];var y=e[3]<<24|e[2]<<16|e[1]<<8|e[0];var v=e[7]<<24|e[6]<<16|e[5]<<8|e[4];var b=e[11]<<24|e[10]<<16|e[9]<<8|e[8];var m=e[15]<<24|e[14]<<16|e[13]<<8|e[12];var _=n;var g=s;var E=o;var O=a;var S=c;var I=h;var j=u;var A=f;var N=l;var P=d;var M=p;var x=w;var T=y;var U=v;var R=b;var C=m;for(var $=0;$<i;$+=2){_=_+S|0;T^=_;T=T>>>32-16|T<<16;N=N+T|0;S^=N;S=S>>>32-12|S<<12;g=g+I|0;U^=g;U=U>>>32-16|U<<16;P=P+U|0;I^=P;I=I>>>32-12|I<<12;E=E+j|0;R^=E;R=R>>>32-16|R<<16;M=M+R|0;j^=M;j=j>>>32-12|j<<12;O=O+A|0;C^=O;C=C>>>32-16|C<<16;x=x+C|0;A^=x;A=A>>>32-12|A<<12;E=E+j|0;R^=E;R=R>>>32-8|R<<8;M=M+R|0;j^=M;j=j>>>32-7|j<<7;O=O+A|0;C^=O;C=C>>>32-8|C<<8;x=x+C|0;A^=x;A=A>>>32-7|A<<7;g=g+I|0;U^=g;U=U>>>32-8|U<<8;P=P+U|0;I^=P;I=I>>>32-7|I<<7;_=_+S|0;T^=_;T=T>>>32-8|T<<8;N=N+T|0;S^=N;S=S>>>32-7|S<<7;_=_+I|0;C^=_;C=C>>>32-16|C<<16;M=M+C|0;I^=M;I=I>>>32-12|I<<12;g=g+j|0;T^=g;T=T>>>32-16|T<<16;x=x+T|0;j^=x;j=j>>>32-12|j<<12;E=E+A|0;U^=E;U=U>>>32-16|U<<16;N=N+U|0;A^=N;A=A>>>32-12|A<<12;O=O+S|0;R^=O;R=R>>>32-16|R<<16;P=P+R|0;S^=P;S=S>>>32-12|S<<12;E=E+A|0;U^=E;U=U>>>32-8|U<<8;N=N+U|0;A^=N;A=A>>>32-7|A<<7;O=O+S|0;R^=O;R=R>>>32-8|R<<8;P=P+R|0;S^=P;S=S>>>32-7|S<<7;g=g+j|0;T^=g;T=T>>>32-8|T<<8;x=x+T|0;j^=x;j=j>>>32-7|j<<7;_=_+I|0;C^=_;C=C>>>32-8|C<<8;M=M+C|0;I^=M;I=I>>>32-7|I<<7}qi.writeUint32LE(_+n|0,t,0);qi.writeUint32LE(g+s|0,t,4);qi.writeUint32LE(E+o|0,t,8);qi.writeUint32LE(O+a|0,t,12);qi.writeUint32LE(S+c|0,t,16);qi.writeUint32LE(I+h|0,t,20);qi.writeUint32LE(j+u|0,t,24);qi.writeUint32LE(A+f|0,t,28);qi.writeUint32LE(N+l|0,t,32);qi.writeUint32LE(P+d|0,t,36);qi.writeUint32LE(M+p|0,t,40);qi.writeUint32LE(x+w|0,t,44);qi.writeUint32LE(T+y|0,t,48);qi.writeUint32LE(U+v|0,t,52);qi.writeUint32LE(R+b|0,t,56);qi.writeUint32LE(C+m|0,t,60)}function n(t,e,i,n,s){if(s===void 0){s=0}if(t.length!==32){throw new Error("ChaCha: key size must be 32 bytes")}if(n.length<i.length){throw new Error("ChaCha: destination is shorter than source")}var a;var c;if(s===0){if(e.length!==8&&e.length!==12){throw new Error("ChaCha nonce must be 8 or 12 bytes")}a=new Uint8Array(16);c=a.length-e.length;a.set(e,c)}else{if(e.length!==16){throw new Error("ChaCha nonce with counter must be 16 bytes")}a=e;c=s}var h=new Uint8Array(64);for(var u=0;u<i.length;u+=64){r(h,a,t);for(var f=u;f<u+64&&f<i.length;f++){n[f]=i[f]^h[f-u]}o(a,0,c)}Di.wipe(h);if(s===0){Di.wipe(a)}return n}e.streamXOR=n;function s(t,e,i,r){if(r===void 0){r=0}Di.wipe(i);return n(t,e,i,i,r)}e.stream=s;function o(t,e,i){var r=1;while(i--){r=r+(t[e]&255)|0;t[e]=r&255;r>>>=8;e++}if(r>0){throw new Error("ChaCha: counter overflow")}}}));var vn=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});function i(t,e,i){return~(t-1)&e|t-1&i}e.select=i;function r(t,e){return(t|0)-(e|0)-1>>>31&1}e.lessOrEqual=r;function n(t,e){if(t.length!==e.length){return 0}var i=0;for(var r=0;r<t.length;r++){i|=t[r]^e[r]}return 1&i-1>>>8}e.compare=n;function s(t,e){if(t.length===0||e.length===0){return false}return n(t,e)!==0}e.equal=s}));var bn=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.DIGEST_LENGTH=16;var i=function(){function t(t){this.digestLength=e.DIGEST_LENGTH;this._buffer=new Uint8Array(16);this._r=new Uint16Array(10);this._h=new Uint16Array(10);this._pad=new Uint16Array(8);this._leftover=0;this._fin=0;this._finished=false;var i=t[0]|t[1]<<8;this._r[0]=i&8191;var r=t[2]|t[3]<<8;this._r[1]=(i>>>13|r<<3)&8191;var n=t[4]|t[5]<<8;this._r[2]=(r>>>10|n<<6)&7939;var s=t[6]|t[7]<<8;this._r[3]=(n>>>7|s<<9)&8191;var o=t[8]|t[9]<<8;this._r[4]=(s>>>4|o<<12)&255;this._r[5]=o>>>1&8190;var a=t[10]|t[11]<<8;this._r[6]=(o>>>14|a<<2)&8191;var c=t[12]|t[13]<<8;this._r[7]=(a>>>11|c<<5)&8065;var h=t[14]|t[15]<<8;this._r[8]=(c>>>8|h<<8)&8191;this._r[9]=h>>>5&127;this._pad[0]=t[16]|t[17]<<8;this._pad[1]=t[18]|t[19]<<8;this._pad[2]=t[20]|t[21]<<8;this._pad[3]=t[22]|t[23]<<8;this._pad[4]=t[24]|t[25]<<8;this._pad[5]=t[26]|t[27]<<8;this._pad[6]=t[28]|t[29]<<8;this._pad[7]=t[30]|t[31]<<8}t.prototype._blocks=function(t,e,i){var r=this._fin?0:1<<11;var n=this._h[0],s=this._h[1],o=this._h[2],a=this._h[3],c=this._h[4],h=this._h[5],u=this._h[6],f=this._h[7],l=this._h[8],d=this._h[9];var p=this._r[0],w=this._r[1],y=this._r[2],v=this._r[3],b=this._r[4],m=this._r[5],_=this._r[6],g=this._r[7],E=this._r[8],O=this._r[9];while(i>=16){var S=t[e+0]|t[e+1]<<8;n+=S&8191;var I=t[e+2]|t[e+3]<<8;s+=(S>>>13|I<<3)&8191;var j=t[e+4]|t[e+5]<<8;o+=(I>>>10|j<<6)&8191;var A=t[e+6]|t[e+7]<<8;a+=(j>>>7|A<<9)&8191;var N=t[e+8]|t[e+9]<<8;c+=(A>>>4|N<<12)&8191;h+=N>>>1&8191;var P=t[e+10]|t[e+11]<<8;u+=(N>>>14|P<<2)&8191;var M=t[e+12]|t[e+13]<<8;f+=(P>>>11|M<<5)&8191;var x=t[e+14]|t[e+15]<<8;l+=(M>>>8|x<<8)&8191;d+=x>>>5|r;var T=0;var U=T;U+=n*p;U+=s*(5*O);U+=o*(5*E);U+=a*(5*g);U+=c*(5*_);T=U>>>13;U&=8191;U+=h*(5*m);U+=u*(5*b);U+=f*(5*v);U+=l*(5*y);U+=d*(5*w);T+=U>>>13;U&=8191;var R=T;R+=n*w;R+=s*p;R+=o*(5*O);R+=a*(5*E);R+=c*(5*g);T=R>>>13;R&=8191;R+=h*(5*_);R+=u*(5*m);R+=f*(5*b);R+=l*(5*v);R+=d*(5*y);T+=R>>>13;R&=8191;var C=T;C+=n*y;C+=s*w;C+=o*p;C+=a*(5*O);C+=c*(5*E);T=C>>>13;C&=8191;C+=h*(5*g);C+=u*(5*_);C+=f*(5*m);C+=l*(5*b);C+=d*(5*v);T+=C>>>13;C&=8191;var $=T;$+=n*v;$+=s*y;$+=o*w;$+=a*p;$+=c*(5*O);T=$>>>13;$&=8191;$+=h*(5*E);$+=u*(5*g);$+=f*(5*_);$+=l*(5*m);$+=d*(5*b);T+=$>>>13;$&=8191;var D=T;D+=n*b;D+=s*v;D+=o*y;D+=a*w;D+=c*p;T=D>>>13;D&=8191;D+=h*(5*O);D+=u*(5*E);D+=f*(5*g);D+=l*(5*_);D+=d*(5*m);T+=D>>>13;D&=8191;var k=T;k+=n*m;k+=s*b;k+=o*v;k+=a*y;k+=c*w;T=k>>>13;k&=8191;k+=h*p;k+=u*(5*O);k+=f*(5*E);k+=l*(5*g);k+=d*(5*_);T+=k>>>13;k&=8191;var L=T;L+=n*_;L+=s*m;L+=o*b;L+=a*v;L+=c*y;T=L>>>13;L&=8191;L+=h*w;L+=u*p;L+=f*(5*O);L+=l*(5*E);L+=d*(5*g);T+=L>>>13;L&=8191;var V=T;V+=n*g;V+=s*_;V+=o*m;V+=a*b;V+=c*v;T=V>>>13;V&=8191;V+=h*y;V+=u*w;V+=f*p;V+=l*(5*O);V+=d*(5*E);T+=V>>>13;V&=8191;var q=T;q+=n*E;q+=s*g;q+=o*_;q+=a*m;q+=c*b;T=q>>>13;q&=8191;q+=h*v;q+=u*y;q+=f*w;q+=l*p;q+=d*(5*O);T+=q>>>13;q&=8191;var F=T;F+=n*O;F+=s*E;F+=o*g;F+=a*_;F+=c*m;T=F>>>13;F&=8191;F+=h*b;F+=u*v;F+=f*y;F+=l*w;F+=d*p;T+=F>>>13;F&=8191;T=(T<<2)+T|0;T=T+U|0;U=T&8191;T=T>>>13;R+=T;n=U;s=R;o=C;a=$;c=D;h=k;u=L;f=V;l=q;d=F;e+=16;i-=16}this._h[0]=n;this._h[1]=s;this._h[2]=o;this._h[3]=a;this._h[4]=c;this._h[5]=h;this._h[6]=u;this._h[7]=f;this._h[8]=l;this._h[9]=d};t.prototype.finish=function(t,e){if(e===void 0){e=0}var i=new Uint16Array(10);var r;var n;var s;var o;if(this._leftover){o=this._leftover;this._buffer[o++]=1;for(;o<16;o++){this._buffer[o]=0}this._fin=1;this._blocks(this._buffer,0,16)}r=this._h[1]>>>13;this._h[1]&=8191;for(o=2;o<10;o++){this._h[o]+=r;r=this._h[o]>>>13;this._h[o]&=8191}this._h[0]+=r*5;r=this._h[0]>>>13;this._h[0]&=8191;this._h[1]+=r;r=this._h[1]>>>13;this._h[1]&=8191;this._h[2]+=r;i[0]=this._h[0]+5;r=i[0]>>>13;i[0]&=8191;for(o=1;o<10;o++){i[o]=this._h[o]+r;r=i[o]>>>13;i[o]&=8191}i[9]-=1<<13;n=(r^1)-1;for(o=0;o<10;o++){i[o]&=n}n=~n;for(o=0;o<10;o++){this._h[o]=this._h[o]&n|i[o]}this._h[0]=(this._h[0]|this._h[1]<<13)&65535;this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535;this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535;this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535;this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535;this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535;this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535;this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535;s=this._h[0]+this._pad[0];this._h[0]=s&65535;for(o=1;o<8;o++){s=(this._h[o]+this._pad[o]|0)+(s>>>16)|0;this._h[o]=s&65535}t[e+0]=this._h[0]>>>0;t[e+1]=this._h[0]>>>8;t[e+2]=this._h[1]>>>0;t[e+3]=this._h[1]>>>8;t[e+4]=this._h[2]>>>0;t[e+5]=this._h[2]>>>8;t[e+6]=this._h[3]>>>0;t[e+7]=this._h[3]>>>8;t[e+8]=this._h[4]>>>0;t[e+9]=this._h[4]>>>8;t[e+10]=this._h[5]>>>0;t[e+11]=this._h[5]>>>8;t[e+12]=this._h[6]>>>0;t[e+13]=this._h[6]>>>8;t[e+14]=this._h[7]>>>0;t[e+15]=this._h[7]>>>8;this._finished=true;return this};t.prototype.update=function(t){var e=0;var i=t.length;var r;if(this._leftover){r=16-this._leftover;if(r>i){r=i}for(var n=0;n<r;n++){this._buffer[this._leftover+n]=t[e+n]}i-=r;e+=r;this._leftover+=r;if(this._leftover<16){return this}this._blocks(this._buffer,0,16);this._leftover=0}if(i>=16){r=i-i%16;this._blocks(t,e,r);e+=r;i-=r}if(i){for(var n=0;n<i;n++){this._buffer[this._leftover+n]=t[e+n]}this._leftover+=i}return this};t.prototype.digest=function(){if(this._finished){throw new Error("Poly1305 was finished")}var t=new Uint8Array(16);this.finish(t);return t};t.prototype.clean=function(){Di.wipe(this._buffer);Di.wipe(this._r);Di.wipe(this._h);Di.wipe(this._pad);this._leftover=0;this._fin=0;this._finished=true;return this};return t}();e.Poly1305=i;function r(t,e){var r=new i(t);r.update(e);var n=r.digest();r.clean();return n}e.oneTimeAuth=r;function n(t,i){if(t.length!==e.DIGEST_LENGTH||i.length!==e.DIGEST_LENGTH){return false}return vn.equal(t,i)}e.equal=n}));var mn=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.KEY_LENGTH=32;e.NONCE_LENGTH=12;e.TAG_LENGTH=16;var i=new Uint8Array(16);var r=function(){function t(t){this.nonceLength=e.NONCE_LENGTH;this.tagLength=e.TAG_LENGTH;if(t.length!==e.KEY_LENGTH){throw new Error("ChaCha20Poly1305 needs 32-byte key")}this._key=new Uint8Array(t)}t.prototype.seal=function(t,e,i,r){if(t.length>16){throw new Error("ChaCha20Poly1305: incorrect nonce length")}var n=new Uint8Array(16);n.set(t,n.length-t.length);var s=new Uint8Array(32);yn.stream(this._key,n,s,4);var o=e.length+this.tagLength;var a;if(r){if(r.length!==o){throw new Error("ChaCha20Poly1305: incorrect destination length")}a=r}else{a=new Uint8Array(o)}yn.streamXOR(this._key,n,e,a,4);this._authenticate(a.subarray(a.length-this.tagLength,a.length),s,a.subarray(0,a.length-this.tagLength),i);Di.wipe(n);return a};t.prototype.open=function(t,e,i,r){if(t.length>16){throw new Error("ChaCha20Poly1305: incorrect nonce length")}if(e.length<this.tagLength){return null}var n=new Uint8Array(16);n.set(t,n.length-t.length);var s=new Uint8Array(32);yn.stream(this._key,n,s,4);var o=new Uint8Array(this.tagLength);this._authenticate(o,s,e.subarray(0,e.length-this.tagLength),i);if(!vn.equal(o,e.subarray(e.length-this.tagLength,e.length))){return null}var a=e.length-this.tagLength;var c;if(r){if(r.length!==a){throw new Error("ChaCha20Poly1305: incorrect destination length")}c=r}else{c=new Uint8Array(a)}yn.streamXOR(this._key,n,e.subarray(0,e.length-this.tagLength),c,4);Di.wipe(n);return c};t.prototype.clean=function(){Di.wipe(this._key);return this};t.prototype._authenticate=function(t,e,r,n){var s=new bn.Poly1305(e);if(n){s.update(n);if(n.length%16>0){s.update(i.subarray(n.length%16))}}s.update(r);if(r.length%16>0){s.update(i.subarray(r.length%16))}var o=new Uint8Array(8);if(n){qi.writeUint64LE(n.length,o)}s.update(o);qi.writeUint64LE(r.length,o);s.update(o);var a=s.digest();for(var c=0;c<a.length;c++){t[c]=a[c]}s.clean();Di.wipe(a);Di.wipe(o)};return t}();e.ChaCha20Poly1305=r}));var _n=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});function i(t){return typeof t.saveState!=="undefined"&&typeof t.restoreState!=="undefined"&&typeof t.cleanSavedState!=="undefined"}e.isSerializableHash=i}));var gn=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});var i=function(){function t(t,e){this._finished=false;this._inner=new t;this._outer=new t;this.blockSize=this._outer.blockSize;this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);if(e.length>this.blockSize){this._inner.update(e).finish(i).clean()}else{i.set(e)}for(var r=0;r<i.length;r++){i[r]^=54}this._inner.update(i);for(var r=0;r<i.length;r++){i[r]^=54^92}this._outer.update(i);if(_n.isSerializableHash(this._inner)&&_n.isSerializableHash(this._outer)){this._innerKeyedState=this._inner.saveState();this._outerKeyedState=this._outer.saveState()}Di.wipe(i)}t.prototype.reset=function(){if(!_n.isSerializableHash(this._inner)||!_n.isSerializableHash(this._outer)){throw new Error("hmac: can't reset() because hash doesn't implement restoreState()")}this._inner.restoreState(this._innerKeyedState);this._outer.restoreState(this._outerKeyedState);this._finished=false;return this};t.prototype.clean=function(){if(_n.isSerializableHash(this._inner)){this._inner.cleanSavedState(this._innerKeyedState)}if(_n.isSerializableHash(this._outer)){this._outer.cleanSavedState(this._outerKeyedState)}this._inner.clean();this._outer.clean()};t.prototype.update=function(t){this._inner.update(t);return this};t.prototype.finish=function(t){if(this._finished){this._outer.finish(t);return this}this._inner.finish(t);this._outer.update(t.subarray(0,this.digestLength)).finish(t);this._finished=true;return this};t.prototype.digest=function(){var t=new Uint8Array(this.digestLength);this.finish(t);return t};t.prototype.saveState=function(){if(!_n.isSerializableHash(this._inner)){throw new Error("hmac: can't saveState() because hash doesn't implement it")}return this._inner.saveState()};t.prototype.restoreState=function(t){if(!_n.isSerializableHash(this._inner)||!_n.isSerializableHash(this._outer)){throw new Error("hmac: can't restoreState() because hash doesn't implement it")}this._inner.restoreState(t);this._outer.restoreState(this._outerKeyedState);this._finished=false;return this};t.prototype.cleanSavedState=function(t){if(!_n.isSerializableHash(this._inner)){throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it")}this._inner.cleanSavedState(t)};return t}();e.HMAC=i;function r(t,e,r){var n=new i(t,e);n.update(r);var s=n.digest();n.clean();return s}e.hmac=r;e.equal=vn.equal}));var En=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});var i=function(){function t(t,e,i,r){if(i===void 0){i=new Uint8Array(0)}this._counter=new Uint8Array(1);this._hash=t;this._info=r;var n=gn.hmac(this._hash,i,e);this._hmac=new gn.HMAC(t,n);this._buffer=new Uint8Array(this._hmac.digestLength);this._bufpos=this._buffer.length}t.prototype._fillBuffer=function(){this._counter[0]++;var t=this._counter[0];if(t===0){throw new Error("hkdf: cannot expand more")}this._hmac.reset();if(t>1){this._hmac.update(this._buffer)}if(this._info){this._hmac.update(this._info)}this._hmac.update(this._counter);this._hmac.finish(this._buffer);this._bufpos=0};t.prototype.expand=function(t){var e=new Uint8Array(t);for(var i=0;i<e.length;i++){if(this._bufpos===this._buffer.length){this._fillBuffer()}e[i]=this._buffer[this._bufpos++]}return e};t.prototype.clean=function(){this._hmac.clean();Di.wipe(this._buffer);Di.wipe(this._counter);this._bufpos=0};return t}();e.HKDF=i}));var On=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.DIGEST_LENGTH=32;e.BLOCK_SIZE=64;var i=function(){function t(){this.digestLength=e.DIGEST_LENGTH;this.blockSize=e.BLOCK_SIZE;this._state=new Int32Array(8);this._temp=new Int32Array(64);this._buffer=new Uint8Array(128);this._bufferLength=0;this._bytesHashed=0;this._finished=false;this.reset()}t.prototype._initState=function(){this._state[0]=1779033703;this._state[1]=3144134277;this._state[2]=1013904242;this._state[3]=2773480762;this._state[4]=1359893119;this._state[5]=2600822924;this._state[6]=528734635;this._state[7]=1541459225};t.prototype.reset=function(){this._initState();this._bufferLength=0;this._bytesHashed=0;this._finished=false;return this};t.prototype.clean=function(){Di.wipe(this._buffer);Di.wipe(this._temp);this.reset()};t.prototype.update=function(t,e){if(e===void 0){e=t.length}if(this._finished){throw new Error("SHA256: can't update because hash was finished.")}var i=0;this._bytesHashed+=e;if(this._bufferLength>0){while(this._bufferLength<this.blockSize&&e>0){this._buffer[this._bufferLength++]=t[i++];e--}if(this._bufferLength===this.blockSize){n(this._temp,this._state,this._buffer,0,this.blockSize);this._bufferLength=0}}if(e>=this.blockSize){i=n(this._temp,this._state,t,i,e);e%=this.blockSize}while(e>0){this._buffer[this._bufferLength++]=t[i++];e--}return this};t.prototype.finish=function(t){if(!this._finished){var e=this._bytesHashed;var i=this._bufferLength;var r=e/536870912|0;var s=e<<3;var o=e%64<56?64:128;this._buffer[i]=128;for(var a=i+1;a<o-8;a++){this._buffer[a]=0}qi.writeUint32BE(r,this._buffer,o-8);qi.writeUint32BE(s,this._buffer,o-4);n(this._temp,this._state,this._buffer,0,o);this._finished=true}for(var a=0;a<this.digestLength/4;a++){qi.writeUint32BE(this._state[a],t,a*4)}return this};t.prototype.digest=function(){var t=new Uint8Array(this.digestLength);this.finish(t);return t};t.prototype.saveState=function(){if(this._finished){throw new Error("SHA256: cannot save finished state")}return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):undefined,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}};t.prototype.restoreState=function(t){this._state.set(t.state);this._bufferLength=t.bufferLength;if(t.buffer){this._buffer.set(t.buffer)}this._bytesHashed=t.bytesHashed;this._finished=false;return this};t.prototype.cleanSavedState=function(t){Di.wipe(t.state);if(t.buffer){Di.wipe(t.buffer)}t.bufferLength=0;t.bytesHashed=0};return t}();e.SHA256=i;var r=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function n(t,e,i,n,s){while(s>=64){var o=e[0];var a=e[1];var c=e[2];var h=e[3];var u=e[4];var f=e[5];var l=e[6];var d=e[7];for(var p=0;p<16;p++){var w=n+p*4;t[p]=qi.readUint32BE(i,w)}for(var p=16;p<64;p++){var y=t[p-2];var v=(y>>>17|y<<32-17)^(y>>>19|y<<32-19)^y>>>10;y=t[p-15];var b=(y>>>7|y<<32-7)^(y>>>18|y<<32-18)^y>>>3;t[p]=(v+t[p-7]|0)+(b+t[p-16]|0)}for(var p=0;p<64;p++){var v=(((u>>>6|u<<32-6)^(u>>>11|u<<32-11)^(u>>>25|u<<32-25))+(u&f^~u&l)|0)+(d+(r[p]+t[p]|0)|0)|0;var b=((o>>>2|o<<32-2)^(o>>>13|o<<32-13)^(o>>>22|o<<32-22))+(o&a^o&c^a&c)|0;d=l;l=f;f=u;u=h+v|0;h=c;c=a;a=o;o=v+b|0}e[0]+=o;e[1]+=a;e[2]+=c;e[3]+=h;e[4]+=u;e[5]+=f;e[6]+=l;e[7]+=d;n+=64;s-=64}return n}function s(t){var e=new i;e.update(t);var r=e.digest();e.clean();return r}e.hash=s}));var Sn=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.sharedKey=e.generateKeyPair=e.generateKeyPairFromSeed=e.scalarMultBase=e.scalarMult=e.SHARED_KEY_LENGTH=e.SECRET_KEY_LENGTH=e.PUBLIC_KEY_LENGTH=void 0;e.PUBLIC_KEY_LENGTH=32;e.SECRET_KEY_LENGTH=32;e.SHARED_KEY_LENGTH=32;function i(t){const e=new Float64Array(16);if(t){for(let i=0;i<t.length;i++){e[i]=t[i]}}return e}const r=new Uint8Array(32);r[0]=9;const n=i([56129,1]);function s(t){let e=1;for(let i=0;i<16;i++){let r=t[i]+e+65535;e=Math.floor(r/65536);t[i]=r-e*65536}t[0]+=e-1+37*(e-1)}function o(t,e,i){const r=~(i-1);for(let i=0;i<16;i++){const n=r&(t[i]^e[i]);t[i]^=n;e[i]^=n}}function a(t,e){const r=i();const n=i();for(let t=0;t<16;t++){n[t]=e[t]}s(n);s(n);s(n);for(let t=0;t<2;t++){r[0]=n[0]-65517;for(let t=1;t<15;t++){r[t]=n[t]-65535-(r[t-1]>>16&1);r[t-1]&=65535}r[15]=n[15]-32767-(r[14]>>16&1);const t=r[15]>>16&1;r[14]&=65535;o(n,r,1-t)}for(let e=0;e<16;e++){t[2*e]=n[e]&255;t[2*e+1]=n[e]>>8}}function c(t,e){for(let i=0;i<16;i++){t[i]=e[2*i]+(e[2*i+1]<<8)}t[15]&=32767}function h(t,e,i){for(let r=0;r<16;r++){t[r]=e[r]+i[r]}}function u(t,e,i){for(let r=0;r<16;r++){t[r]=e[r]-i[r]}}function f(t,e,i){let r,n,s=0,o=0,a=0,c=0,h=0,u=0,f=0,l=0,d=0,p=0,w=0,y=0,v=0,b=0,m=0,_=0,g=0,E=0,O=0,S=0,I=0,j=0,A=0,N=0,P=0,M=0,x=0,T=0,U=0,R=0,C=0,$=i[0],D=i[1],k=i[2],L=i[3],V=i[4],q=i[5],F=i[6],G=i[7],B=i[8],H=i[9],K=i[10],z=i[11],W=i[12],J=i[13],X=i[14],Y=i[15];r=e[0];s+=r*$;o+=r*D;a+=r*k;c+=r*L;h+=r*V;u+=r*q;f+=r*F;l+=r*G;d+=r*B;p+=r*H;w+=r*K;y+=r*z;v+=r*W;b+=r*J;m+=r*X;_+=r*Y;r=e[1];o+=r*$;a+=r*D;c+=r*k;h+=r*L;u+=r*V;f+=r*q;l+=r*F;d+=r*G;p+=r*B;w+=r*H;y+=r*K;v+=r*z;b+=r*W;m+=r*J;_+=r*X;g+=r*Y;r=e[2];a+=r*$;c+=r*D;h+=r*k;u+=r*L;f+=r*V;l+=r*q;d+=r*F;p+=r*G;w+=r*B;y+=r*H;v+=r*K;b+=r*z;m+=r*W;_+=r*J;g+=r*X;E+=r*Y;r=e[3];c+=r*$;h+=r*D;u+=r*k;f+=r*L;l+=r*V;d+=r*q;p+=r*F;w+=r*G;y+=r*B;v+=r*H;b+=r*K;m+=r*z;_+=r*W;g+=r*J;E+=r*X;O+=r*Y;r=e[4];h+=r*$;u+=r*D;f+=r*k;l+=r*L;d+=r*V;p+=r*q;w+=r*F;y+=r*G;v+=r*B;b+=r*H;m+=r*K;_+=r*z;g+=r*W;E+=r*J;O+=r*X;S+=r*Y;r=e[5];u+=r*$;f+=r*D;l+=r*k;d+=r*L;p+=r*V;w+=r*q;y+=r*F;v+=r*G;b+=r*B;m+=r*H;_+=r*K;g+=r*z;E+=r*W;O+=r*J;S+=r*X;I+=r*Y;r=e[6];f+=r*$;l+=r*D;d+=r*k;p+=r*L;w+=r*V;y+=r*q;v+=r*F;b+=r*G;m+=r*B;_+=r*H;g+=r*K;E+=r*z;O+=r*W;S+=r*J;I+=r*X;j+=r*Y;r=e[7];l+=r*$;d+=r*D;p+=r*k;w+=r*L;y+=r*V;v+=r*q;b+=r*F;m+=r*G;_+=r*B;g+=r*H;E+=r*K;O+=r*z;S+=r*W;I+=r*J;j+=r*X;A+=r*Y;r=e[8];d+=r*$;p+=r*D;w+=r*k;y+=r*L;v+=r*V;b+=r*q;m+=r*F;_+=r*G;g+=r*B;E+=r*H;O+=r*K;S+=r*z;I+=r*W;j+=r*J;A+=r*X;N+=r*Y;r=e[9];p+=r*$;w+=r*D;y+=r*k;v+=r*L;b+=r*V;m+=r*q;_+=r*F;g+=r*G;E+=r*B;O+=r*H;S+=r*K;I+=r*z;j+=r*W;A+=r*J;N+=r*X;P+=r*Y;r=e[10];w+=r*$;y+=r*D;v+=r*k;b+=r*L;m+=r*V;_+=r*q;g+=r*F;E+=r*G;O+=r*B;S+=r*H;I+=r*K;j+=r*z;A+=r*W;N+=r*J;P+=r*X;M+=r*Y;r=e[11];y+=r*$;v+=r*D;b+=r*k;m+=r*L;_+=r*V;g+=r*q;E+=r*F;O+=r*G;S+=r*B;I+=r*H;j+=r*K;A+=r*z;N+=r*W;P+=r*J;M+=r*X;x+=r*Y;r=e[12];v+=r*$;b+=r*D;m+=r*k;_+=r*L;g+=r*V;E+=r*q;O+=r*F;S+=r*G;I+=r*B;j+=r*H;A+=r*K;N+=r*z;P+=r*W;M+=r*J;x+=r*X;T+=r*Y;r=e[13];b+=r*$;m+=r*D;_+=r*k;g+=r*L;E+=r*V;O+=r*q;S+=r*F;I+=r*G;j+=r*B;A+=r*H;N+=r*K;P+=r*z;M+=r*W;x+=r*J;T+=r*X;U+=r*Y;r=e[14];m+=r*$;_+=r*D;g+=r*k;E+=r*L;O+=r*V;S+=r*q;I+=r*F;j+=r*G;A+=r*B;N+=r*H;P+=r*K;M+=r*z;x+=r*W;T+=r*J;U+=r*X;R+=r*Y;r=e[15];_+=r*$;g+=r*D;E+=r*k;O+=r*L;S+=r*V;I+=r*q;j+=r*F;A+=r*G;N+=r*B;P+=r*H;M+=r*K;x+=r*z;T+=r*W;U+=r*J;R+=r*X;C+=r*Y;s+=38*g;o+=38*E;a+=38*O;c+=38*S;h+=38*I;u+=38*j;f+=38*A;l+=38*N;d+=38*P;p+=38*M;w+=38*x;y+=38*T;v+=38*U;b+=38*R;m+=38*C;n=1;r=s+n+65535;n=Math.floor(r/65536);s=r-n*65536;r=o+n+65535;n=Math.floor(r/65536);o=r-n*65536;r=a+n+65535;n=Math.floor(r/65536);a=r-n*65536;r=c+n+65535;n=Math.floor(r/65536);c=r-n*65536;r=h+n+65535;n=Math.floor(r/65536);h=r-n*65536;r=u+n+65535;n=Math.floor(r/65536);u=r-n*65536;r=f+n+65535;n=Math.floor(r/65536);f=r-n*65536;r=l+n+65535;n=Math.floor(r/65536);l=r-n*65536;r=d+n+65535;n=Math.floor(r/65536);d=r-n*65536;r=p+n+65535;n=Math.floor(r/65536);p=r-n*65536;r=w+n+65535;n=Math.floor(r/65536);w=r-n*65536;r=y+n+65535;n=Math.floor(r/65536);y=r-n*65536;r=v+n+65535;n=Math.floor(r/65536);v=r-n*65536;r=b+n+65535;n=Math.floor(r/65536);b=r-n*65536;r=m+n+65535;n=Math.floor(r/65536);m=r-n*65536;r=_+n+65535;n=Math.floor(r/65536);_=r-n*65536;s+=n-1+37*(n-1);n=1;r=s+n+65535;n=Math.floor(r/65536);s=r-n*65536;r=o+n+65535;n=Math.floor(r/65536);o=r-n*65536;r=a+n+65535;n=Math.floor(r/65536);a=r-n*65536;r=c+n+65535;n=Math.floor(r/65536);c=r-n*65536;r=h+n+65535;n=Math.floor(r/65536);h=r-n*65536;r=u+n+65535;n=Math.floor(r/65536);u=r-n*65536;r=f+n+65535;n=Math.floor(r/65536);f=r-n*65536;r=l+n+65535;n=Math.floor(r/65536);l=r-n*65536;r=d+n+65535;n=Math.floor(r/65536);d=r-n*65536;r=p+n+65535;n=Math.floor(r/65536);p=r-n*65536;r=w+n+65535;n=Math.floor(r/65536);w=r-n*65536;r=y+n+65535;n=Math.floor(r/65536);y=r-n*65536;r=v+n+65535;n=Math.floor(r/65536);v=r-n*65536;r=b+n+65535;n=Math.floor(r/65536);b=r-n*65536;r=m+n+65535;n=Math.floor(r/65536);m=r-n*65536;r=_+n+65535;n=Math.floor(r/65536);_=r-n*65536;s+=n-1+37*(n-1);t[0]=s;t[1]=o;t[2]=a;t[3]=c;t[4]=h;t[5]=u;t[6]=f;t[7]=l;t[8]=d;t[9]=p;t[10]=w;t[11]=y;t[12]=v;t[13]=b;t[14]=m;t[15]=_}function l(t,e){f(t,e,e)}function d(t,e){const r=i();for(let t=0;t<16;t++){r[t]=e[t]}for(let t=253;t>=0;t--){l(r,r);if(t!==2&&t!==4){f(r,r,e)}}for(let e=0;e<16;e++){t[e]=r[e]}}function p(t,e){const r=new Uint8Array(32);const s=new Float64Array(80);const p=i(),w=i(),y=i(),v=i(),b=i(),m=i();for(let e=0;e<31;e++){r[e]=t[e]}r[31]=t[31]&127|64;r[0]&=248;c(s,e);for(let t=0;t<16;t++){w[t]=s[t]}p[0]=v[0]=1;for(let t=254;t>=0;--t){const e=r[t>>>3]>>>(t&7)&1;o(p,w,e);o(y,v,e);h(b,p,y);u(p,p,y);h(y,w,v);u(w,w,v);l(v,b);l(m,p);f(p,y,p);f(y,w,b);h(b,p,y);u(p,p,y);l(w,p);u(y,v,m);f(p,y,n);h(p,p,v);f(y,y,p);f(p,v,m);f(v,w,s);l(w,b);o(p,w,e);o(y,v,e)}for(let t=0;t<16;t++){s[t+16]=p[t];s[t+32]=y[t];s[t+48]=w[t];s[t+64]=v[t]}const _=s.subarray(32);const g=s.subarray(16);d(_,_);f(g,g,_);const E=new Uint8Array(32);a(E,g);return E}e.scalarMult=p;function w(t){return p(t,r)}e.scalarMultBase=w;function y(t){if(t.length!==e.SECRET_KEY_LENGTH){throw new Error(`x25519: seed must be ${e.SECRET_KEY_LENGTH} bytes`)}const i=new Uint8Array(t);const r=w(i);return{publicKey:r,secretKey:i}}e.generateKeyPairFromSeed=y;function v(t){const e=(0,Fi.randomBytes)(32,t);const i=y(e);(0,Di.wipe)(e);return i}e.generateKeyPair=v;function b(t,i,r=false){if(t.length!==e.PUBLIC_KEY_LENGTH){throw new Error("X25519: incorrect secret key length")}if(i.length!==e.PUBLIC_KEY_LENGTH){throw new Error("X25519: incorrect public key length")}const n=p(t,i);if(r){let t=0;for(let e=0;e<n.length;e++){t|=n[e]}if(t===0){throw new Error("X25519: invalid shared key")}}return n}e.sharedKey=b}));var In=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});function i(t,e){for(let i=0;i<t.byteLength;i++){if(t[i]<e[i]){return-1}if(t[i]>e[i]){return 1}}if(t.byteLength>e.byteLength){return 1}if(t.byteLength<e.byteLength){return-1}return 0}e.compare=i}));var jn=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});function i(t,e){if(t===e){return true}if(t.byteLength!==e.byteLength){return false}for(let i=0;i<t.byteLength;i++){if(t[i]!==e[i]){return false}}return true}e.equals=i}));var An=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});function i(t,e){if(t.length!==e.length){throw new Error("Inputs should have the same length")}const i=nr.allocUnsafe(t.length);for(let r=0;r<t.length;r++){i[r]=t[r]^e[r]}return i}e.xor=i}));var Nn=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.compare=In.compare;e.concat=sr.concat;e.equals=jn.equals;e.fromString=cn.fromString;e.toString=an.toString;e.xor=An.xor}));var Pn=undefined&&undefined.__spreadArray||function(t,e,i){if(i||arguments.length===2)for(var r=0,n=e.length,s;r<n;r++){if(s||!(r in e)){if(!s)s=Array.prototype.slice.call(e,0,r);s[r]=e[r]}}return t.concat(s||Array.prototype.slice.call(e))};var Mn=function(){function t(t,e,i){this.name=t;this.version=e;this.os=i;this.type="browser"}return t}();var xn=function(){function t(t){this.version=t;this.type="node";this.name="node";this.os=process.platform}return t}();var Tn=function(){function t(t,e,i,r){this.name=t;this.version=e;this.os=i;this.bot=r;this.type="bot-device"}return t}();var Un=function(){function t(){this.type="bot";this.bot=true;this.name="bot";this.version=null;this.os=null}return t}();var Rn=function(){function t(){this.type="react-native";this.name="react-native";this.version=null;this.os=null}return t}();var Cn=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/;var $n=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/;var Dn=3;var kn=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Cn]];var Ln=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Vn(t){if(!!t){return Fn(t)}if(typeof document==="undefined"&&typeof navigator!=="undefined"&&navigator.product==="ReactNative"){return new Rn}if(typeof navigator!=="undefined"){return Fn(navigator.userAgent)}return Bn()}function qn(t){return t!==""&&kn.reduce((function(e,i){var r=i[0],n=i[1];if(e){return e}var s=n.exec(t);return!!s&&[r,s]}),false)}function Fn(t){var e=qn(t);if(!e){return null}var i=e[0],r=e[1];if(i==="searchbot"){return new Un}var n=r[1]&&r[1].split(".").join("_").split("_").slice(0,3);if(n){if(n.length<Dn){n=Pn(Pn([],n,true),Hn(Dn-n.length),true)}}else{n=[]}var s=n.join(".");var o=Gn(t);var a=$n.exec(t);if(a&&a[1]){return new Tn(i,s,o,a[1])}return new Mn(i,s,o)}function Gn(t){for(var e=0,i=Ln.length;e<i;e++){var r=Ln[e],n=r[0],s=r[1];var o=s.exec(t);if(o){return n}}return null}function Bn(){var t=typeof process!=="undefined"&&process.version;return t?new xn(process.version.slice(1)):null}function Hn(t){var e=[];for(var i=0;i<t;i++){e.push("0")}return e}var Kn=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.getLocalStorage=e.getLocalStorageOrThrow=e.getCrypto=e.getCryptoOrThrow=e.getLocation=e.getLocationOrThrow=e.getNavigator=e.getNavigatorOrThrow=e.getDocument=e.getDocumentOrThrow=e.getFromWindowOrThrow=e.getFromWindow=void 0;function i(t){let e=undefined;if(typeof window!=="undefined"&&typeof window[t]!=="undefined"){e=window[t]}return e}e.getFromWindow=i;function r(t){const e=i(t);if(!e){throw new Error(`${t} is not defined in Window`)}return e}e.getFromWindowOrThrow=r;function n(){return r("document")}e.getDocumentOrThrow=n;function s(){return i("document")}e.getDocument=s;function o(){return r("navigator")}e.getNavigatorOrThrow=o;function a(){return i("navigator")}e.getNavigator=a;function c(){return r("location")}e.getLocationOrThrow=c;function h(){return i("location")}e.getLocation=h;function u(){return r("crypto")}e.getCryptoOrThrow=u;function f(){return i("crypto")}e.getCrypto=f;function l(){return r("localStorage")}e.getLocalStorageOrThrow=l;function d(){return i("localStorage")}e.getLocalStorage=d}));var zn=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.getWindowMetadata=void 0;function i(){let t;let e;try{t=Kn.getDocumentOrThrow();e=Kn.getLocationOrThrow()}catch(t){return null}function i(){const i=t.getElementsByTagName("link");const r=[];for(let t=0;t<i.length;t++){const n=i[t];const s=n.getAttribute("rel");if(s){if(s.toLowerCase().indexOf("icon")>-1){const t=n.getAttribute("href");if(t){if(t.toLowerCase().indexOf("https:")===-1&&t.toLowerCase().indexOf("http:")===-1&&t.indexOf("//")!==0){let i=e.protocol+"//"+e.host;if(t.indexOf("/")===0){i+=t}else{const r=e.pathname.split("/");r.pop();const n=r.join("/");i+=n+"/"+t}r.push(i)}else if(t.indexOf("//")===0){const i=e.protocol+t;r.push(i)}else{r.push(t)}}}}}return r}function r(...e){const i=t.getElementsByTagName("meta");for(let t=0;t<i.length;t++){const r=i[t];const n=["itemprop","property","name"].map((t=>r.getAttribute(t))).filter((t=>{if(t){return e.includes(t)}return false}));if(n.length&&n){const t=r.getAttribute("content");if(t){return t}}}return""}function n(){let e=r("name","og:site_name","og:title","twitter:title");if(!e){e=t.title}return e}function s(){const t=r("description","og:description","twitter:description","keywords");return t}const o=n();const a=s();const c=e.origin;const h=i();const u={description:a,url:c,icons:h,name:o};return u}e.getWindowMetadata=i}));var Wn=t=>encodeURIComponent(t).replace(/[!'()*]/g,(t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`));var Jn="%[a-f0-9]{2}";var Xn=new RegExp("("+Jn+")|([^%]+?)","gi");var Yn=new RegExp("("+Jn+")+","gi");function Zn(t,e){try{return[decodeURIComponent(t.join(""))]}catch(t){}if(t.length===1){return t}e=e||1;var i=t.slice(0,e);var r=t.slice(e);return Array.prototype.concat.call([],Zn(i),Zn(r))}function Qn(t){try{return decodeURIComponent(t)}catch(r){var e=t.match(Xn)||[];for(var i=1;i<e.length;i++){t=Zn(e,i).join("");e=t.match(Xn)||[]}return t}}function ts(t){var e={"%FE%FF":"","%FF%FE":""};var i=Yn.exec(t);while(i){try{e[i[0]]=decodeURIComponent(i[0])}catch(t){var r=Qn(i[0]);if(r!==i[0]){e[i[0]]=r}}i=Yn.exec(t)}e["%C2"]="";var n=Object.keys(e);for(var s=0;s<n.length;s++){var o=n[s];t=t.replace(new RegExp(o,"g"),e[o])}return t}var es=function(t){if(typeof t!=="string"){throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`")}try{t=t.replace(/\+/g," ");return decodeURIComponent(t)}catch(e){return ts(t)}};var is=(t,e)=>{if(!(typeof t==="string"&&typeof e==="string")){throw new TypeError("Expected the arguments to be of type `string`")}if(e===""){return[t]}const i=t.indexOf(e);if(i===-1){return[t]}return[t.slice(0,i),t.slice(i+e.length)]};var rs=function(t,e){var i={};var r=Object.keys(t);var n=Array.isArray(e);for(var s=0;s<r.length;s++){var o=r[s];var a=t[o];if(n?e.indexOf(o)!==-1:e(o,a,t)){i[o]=a}}return i};var ns=t((function(t,e){const i=t=>t===null||t===undefined;const r=Symbol("encodeFragmentIdentifier");function n(t){switch(t.arrayFormat){case"index":return e=>(i,r)=>{const n=i.length;if(r===undefined||t.skipNull&&r===null||t.skipEmptyString&&r===""){return i}if(r===null){return[...i,[a(e,t),"[",n,"]"].join("")]}return[...i,[a(e,t),"[",a(n,t),"]=",a(r,t)].join("")]};case"bracket":return e=>(i,r)=>{if(r===undefined||t.skipNull&&r===null||t.skipEmptyString&&r===""){return i}if(r===null){return[...i,[a(e,t),"[]"].join("")]}return[...i,[a(e,t),"[]=",a(r,t)].join("")]};case"colon-list-separator":return e=>(i,r)=>{if(r===undefined||t.skipNull&&r===null||t.skipEmptyString&&r===""){return i}if(r===null){return[...i,[a(e,t),":list="].join("")]}return[...i,[a(e,t),":list=",a(r,t)].join("")]};case"comma":case"separator":case"bracket-separator":{const e=t.arrayFormat==="bracket-separator"?"[]=":"=";return i=>(r,n)=>{if(n===undefined||t.skipNull&&n===null||t.skipEmptyString&&n===""){return r}n=n===null?"":n;if(r.length===0){return[[a(i,t),e,a(n,t)].join("")]}return[[r,a(n,t)].join(t.arrayFormatSeparator)]}}default:return e=>(i,r)=>{if(r===undefined||t.skipNull&&r===null||t.skipEmptyString&&r===""){return i}if(r===null){return[...i,a(e,t)]}return[...i,[a(e,t),"=",a(r,t)].join("")]}}}function s(t){let e;switch(t.arrayFormat){case"index":return(t,i,r)=>{e=/\[(\d*)\]$/.exec(t);t=t.replace(/\[\d*\]$/,"");if(!e){r[t]=i;return}if(r[t]===undefined){r[t]={}}r[t][e[1]]=i};case"bracket":return(t,i,r)=>{e=/(\[\])$/.exec(t);t=t.replace(/\[\]$/,"");if(!e){r[t]=i;return}if(r[t]===undefined){r[t]=[i];return}r[t]=[].concat(r[t],i)};case"colon-list-separator":return(t,i,r)=>{e=/(:list)$/.exec(t);t=t.replace(/:list$/,"");if(!e){r[t]=i;return}if(r[t]===undefined){r[t]=[i];return}r[t]=[].concat(r[t],i)};case"comma":case"separator":return(e,i,r)=>{const n=typeof i==="string"&&i.includes(t.arrayFormatSeparator);const s=typeof i==="string"&&!n&&c(i,t).includes(t.arrayFormatSeparator);i=s?c(i,t):i;const o=n||s?i.split(t.arrayFormatSeparator).map((e=>c(e,t))):i===null?i:c(i,t);r[e]=o};case"bracket-separator":return(e,i,r)=>{const n=/(\[\])$/.test(e);e=e.replace(/\[\]$/,"");if(!n){r[e]=i?c(i,t):i;return}const s=i===null?[]:i.split(t.arrayFormatSeparator).map((e=>c(e,t)));if(r[e]===undefined){r[e]=s;return}r[e]=[].concat(r[e],s)};default:return(t,e,i)=>{if(i[t]===undefined){i[t]=e;return}i[t]=[].concat(i[t],e)}}}function o(t){if(typeof t!=="string"||t.length!==1){throw new TypeError("arrayFormatSeparator must be single character string")}}function a(t,e){if(e.encode){return e.strict?Wn(t):encodeURIComponent(t)}return t}function c(t,e){if(e.decode){return es(t)}return t}function h(t){if(Array.isArray(t)){return t.sort()}if(typeof t==="object"){return h(Object.keys(t)).sort(((t,e)=>Number(t)-Number(e))).map((e=>t[e]))}return t}function u(t){const e=t.indexOf("#");if(e!==-1){t=t.slice(0,e)}return t}function f(t){let e="";const i=t.indexOf("#");if(i!==-1){e=t.slice(i)}return e}function l(t){t=u(t);const e=t.indexOf("?");if(e===-1){return""}return t.slice(e+1)}function d(t,e){if(e.parseNumbers&&!Number.isNaN(Number(t))&&(typeof t==="string"&&t.trim()!=="")){t=Number(t)}else if(e.parseBooleans&&t!==null&&(t.toLowerCase()==="true"||t.toLowerCase()==="false")){t=t.toLowerCase()==="true"}return t}function p(t,e){e=Object.assign({decode:true,sort:true,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:false,parseBooleans:false},e);o(e.arrayFormatSeparator);const i=s(e);const r=Object.create(null);if(typeof t!=="string"){return r}t=t.trim().replace(/^[?#&]/,"");if(!t){return r}for(const n of t.split("&")){if(n===""){continue}let[t,s]=is(e.decode?n.replace(/\+/g," "):n,"=");s=s===undefined?null:["comma","separator","bracket-separator"].includes(e.arrayFormat)?s:c(s,e);i(c(t,e),s,r)}for(const t of Object.keys(r)){const i=r[t];if(typeof i==="object"&&i!==null){for(const t of Object.keys(i)){i[t]=d(i[t],e)}}else{r[t]=d(i,e)}}if(e.sort===false){return r}return(e.sort===true?Object.keys(r).sort():Object.keys(r).sort(e.sort)).reduce(((t,e)=>{const i=r[e];if(Boolean(i)&&typeof i==="object"&&!Array.isArray(i)){t[e]=h(i)}else{t[e]=i}return t}),Object.create(null))}e.extract=l;e.parse=p;e.stringify=(t,e)=>{if(!t){return""}e=Object.assign({encode:true,strict:true,arrayFormat:"none",arrayFormatSeparator:","},e);o(e.arrayFormatSeparator);const r=r=>e.skipNull&&i(t[r])||e.skipEmptyString&&t[r]==="";const s=n(e);const c={};for(const e of Object.keys(t)){if(!r(e)){c[e]=t[e]}}const h=Object.keys(c);if(e.sort!==false){h.sort(e.sort)}return h.map((i=>{const r=t[i];if(r===undefined){return""}if(r===null){return a(i,e)}if(Array.isArray(r)){if(r.length===0&&e.arrayFormat==="bracket-separator"){return a(i,e)+"[]"}return r.reduce(s(i),[]).join("&")}return a(i,e)+"="+a(r,e)})).filter((t=>t.length>0)).join("&")};e.parseUrl=(t,e)=>{e=Object.assign({decode:true},e);const[i,r]=is(t,"#");return Object.assign({url:i.split("?")[0]||"",query:p(l(t),e)},e&&e.parseFragmentIdentifier&&r?{fragmentIdentifier:c(r,e)}:{})};e.stringifyUrl=(t,i)=>{i=Object.assign({encode:true,strict:true,[r]:true},i);const n=u(t.url).split("?")[0]||"";const s=e.extract(t.url);const o=e.parse(s,{sort:false});const c=Object.assign(o,t.query);let h=e.stringify(c,i);if(h){h=`?${h}`}let l=f(t.url);if(t.fragmentIdentifier){l=`#${i[r]?a(t.fragmentIdentifier,i):t.fragmentIdentifier}`}return`${n}${h}${l}`};e.pick=(t,i,n)=>{n=Object.assign({parseFragmentIdentifier:true,[r]:false},n);const{url:s,query:o,fragmentIdentifier:a}=e.parseUrl(t,n);return e.stringifyUrl({url:s,query:rs(o,i),fragmentIdentifier:a},n)};e.exclude=(t,i,r)=>{const n=Array.isArray(i)?t=>!i.includes(t):(t,e)=>!i(t,e);return e.pick(t,n,r)}}));const ss={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};function os(t,e){return t.includes(":")?[t]:e.chains||[]}const as="base10",cs="base16",hs="base64pad",us="utf8",fs=0,ls=1,ds=0,ps=1,ws=12,ys=32;function vs(){const t=Sn.generateKeyPair();return{privateKey:Nn.toString(t.secretKey,cs),publicKey:Nn.toString(t.publicKey,cs)}}function bs(){const t=Fi.randomBytes(ys);return Nn.toString(t,cs)}function ms(t,e){const i=Sn.sharedKey(Nn.fromString(t,cs),Nn.fromString(e,cs)),r=new En.HKDF(On.SHA256,i).expand(ys);return Nn.toString(r,cs)}function _s(t){const e=On.hash(Nn.fromString(t,cs));return Nn.toString(e,cs)}function gs(t){const e=On.hash(Nn.fromString(t,us));return Nn.toString(e,cs)}function Es(t){return Nn.fromString(`${t}`,as)}function Os(t){return Number(Nn.toString(t,as))}function Ss(t){const e=Es(typeof t.type<"u"?t.type:fs);if(Os(e)===ls&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const i=typeof t.senderPublicKey<"u"?Nn.fromString(t.senderPublicKey,cs):void 0,r=typeof t.iv<"u"?Nn.fromString(t.iv,cs):Fi.randomBytes(ws),n=new mn.ChaCha20Poly1305(Nn.fromString(t.symKey,cs)).seal(r,Nn.fromString(t.message,us));return js({type:e,sealed:n,iv:r,senderPublicKey:i})}function Is(t){const e=new mn.ChaCha20Poly1305(Nn.fromString(t.symKey,cs)),{sealed:i,iv:r}=As(t.encoded),n=e.open(r,i);if(n===null)throw new Error("Failed to decrypt");return Nn.toString(n,us)}function js(t){if(Os(t.type)===ls){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Nn.toString(Nn.concat([t.type,t.senderPublicKey,t.iv,t.sealed]),hs)}return Nn.toString(Nn.concat([t.type,t.iv,t.sealed]),hs)}function As(t){const e=Nn.fromString(t,hs),i=e.slice(ds,ps),r=ps;if(Os(i)===ls){const t=r+ys,n=t+ws,s=e.slice(r,t),o=e.slice(t,n),a=e.slice(n);return{type:i,sealed:a,iv:o,senderPublicKey:s}}const n=r+ws,s=e.slice(r,n),o=e.slice(n);return{type:i,sealed:o,iv:s}}function Ns(t,e){const i=As(t);return Ps({type:Os(i.type),senderPublicKey:typeof i.senderPublicKey<"u"?Nn.toString(i.senderPublicKey,cs):void 0,receiverPublicKey:e?.receiverPublicKey})}function Ps(t){const e=t?.type||fs;if(e===ls){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function Ms(t){return t.type===ls&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var xs=Object.defineProperty,Ts=Object.getOwnPropertySymbols,Us=Object.prototype.hasOwnProperty,Rs=Object.prototype.propertyIsEnumerable,Cs=(t,e,i)=>e in t?xs(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,$s=(t,e)=>{for(var i in e||(e={}))Us.call(e,i)&&Cs(t,i,e[i]);if(Ts)for(var i of Ts(e))Rs.call(e,i)&&Cs(t,i,e[i]);return t};const Ds="ReactNative",ks={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Ls="js";function Vs(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function qs(){return!Kn.getDocument()&&!!Kn.getNavigator()&&navigator.product===Ds}function Fs(){return!Vs()&&!!Kn.getNavigator()}function Gs(){return qs()?ks.reactNative:Vs()?ks.node:Fs()?ks.browser:ks.unknown}function Bs(t,e){let i=ns.parse(t);return i=$s($s({},i),e),t=ns.stringify(i),t}function Hs(){return zn.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function Ks(){const t=Vn();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function zs(){var t;const e=Gs();return e===ks.browser?[e,((t=Kn.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function Ws(t,e,i){const r=Ks(),n=zs();return[[t,e].join("-"),[Ls,i].join("-"),r,n].join("/")}function Js({protocol:t,version:e,relayUrl:i,sdkVersion:r,auth:n,projectId:s}){const o=i.split("?"),a=Ws(t,e,r),c={auth:n,ua:a,projectId:s},h=Bs(o[1]||"",c);return o[0]+"?"+h}function Xs(t,e){return t.filter((t=>e.includes(t))).length===t.length}function Ys(t){return Object.fromEntries(t.entries())}function Zs(t){return new Map(Object.entries(t))}function Qs(t=ke.FIVE_MINUTES,e){const i=ke.toMiliseconds(t||ke.FIVE_MINUTES);let r,n,s;return{resolve:t=>{s&&r&&(clearTimeout(s),r(t))},reject:t=>{s&&n&&(clearTimeout(s),n(t))},done:()=>new Promise(((t,o)=>{s=setTimeout((()=>{o(new Error(e))}),i),r=t,n=o}))}}function to(t,e){return new Promise((async(i,r)=>{const n=setTimeout((()=>r()),e),s=await t;clearTimeout(n),i(s)}))}function eo(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function io(t){return eo("topic",t)}function ro(t){return eo("id",t)}function no(t){const[e,i]=t.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof i=="string")r.topic=i;else if(e==="id"&&Number.isInteger(Number(i)))r.id=Number(i);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${i}`);return r}function so(t,e){return ke.fromMiliseconds((e||Date.now())+ke.toMiliseconds(t))}function oo(t){return Date.now()>=ke.toMiliseconds(t)}function ao(t,e){return`${t}${e?`:${e}`:""}`}const co="irn";function ho(t){return t?.relay||{protocol:co}}function uo(t){const e=ss[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var fo=Object.defineProperty,lo=Object.getOwnPropertySymbols,po=Object.prototype.hasOwnProperty,wo=Object.prototype.propertyIsEnumerable,yo=(t,e,i)=>e in t?fo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,vo=(t,e)=>{for(var i in e||(e={}))po.call(e,i)&&yo(t,i,e[i]);if(lo)for(var i of lo(e))wo.call(e,i)&&yo(t,i,e[i]);return t};function bo(t,e="-"){const i={},r="relay"+e;return Object.keys(t).forEach((e=>{if(e.startsWith(r)){const n=e.replace(r,""),s=t[e];i[n]=s}})),i}function mo(t){const e=t.indexOf(":"),i=t.indexOf("?")!==-1?t.indexOf("?"):void 0,r=t.substring(0,e),n=t.substring(e+1,i).split("@"),s=typeof i<"u"?t.substring(i):"",o=ns.parse(s);return{protocol:r,topic:n[0],version:parseInt(n[1],10),symKey:o.symKey,relay:bo(o)}}function _o(t,e="-"){const i="relay",r={};return Object.keys(t).forEach((n=>{const s=i+e+n;t[n]&&(r[s]=t[n])})),r}function go(t){return`${t.protocol}:${t.topic}@${t.version}?`+ns.stringify(vo({symKey:t.symKey},_o(t.relay)))}function Eo(t){const e=[];return t.forEach((t=>{const[i,r]=t.split(":");e.push(`${i}:${r}`)})),e}function Oo(t){const e=[];return Object.values(t).forEach((t=>{e.push(...Eo(t.accounts))})),e}function So(t,e){const i=[];return Object.values(t).forEach((t=>{Eo(t.accounts).includes(e)&&i.push(...t.methods)})),i}function Io(t,e){const i=[];return Object.values(t).forEach((t=>{Eo(t.accounts).includes(e)&&i.push(...t.events)})),i}function jo(t,e){const i=Yo(t,e);if(i)throw new Error(i.message);const r={};for(const[e,i]of Object.entries(t))r[e]={methods:i.methods,events:i.events,chains:i.accounts.map((t=>`${t.split(":")[0]}:${t.split(":")[1]}`))};return r}const Ao={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},No={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Po(t,e){const{message:i,code:r}=No[t];return{message:e?`${i} ${e}`:i,code:r}}function Mo(t,e){const{message:i,code:r}=Ao[t];return{message:e?`${i} ${e}`:i,code:r}}function xo(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function To(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Uo(t){return typeof t>"u"}function Ro(t,e){return e&&Uo(t)?!0:typeof t=="string"&&Boolean(t.trim().length)}function Co(t,e){return e&&Uo(t)?!0:typeof t=="number"&&!isNaN(t)}function $o(t,e){const{requiredNamespaces:i}=e,r=Object.keys(t.namespaces),n=Object.keys(i);let s=!0;return Xs(n,r)?(r.forEach((e=>{const{accounts:r,methods:n,events:o}=t.namespaces[e],a=Eo(r),c=i[e];(!Xs(os(e,c),a)||!Xs(c.methods,n)||!Xs(c.events,o))&&(s=!1)})),s):!1}function Do(t){return Ro(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function ko(t){if(Ro(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&Do(t)}}return!1}function Lo(t){if(Ro(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function Vo(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function qo(t){return t?.topic}function Fo(t,e){let i=null;return Ro(t?.publicKey,!1)||(i=Po("MISSING_OR_INVALID",`${e} controller public key should be a string`)),i}function Go(t){let e=!0;return xo(t)?t.length&&(e=t.every((t=>Ro(t,!1)))):e=!1,e}function Bo(t,e,i){let r=null;return xo(e)?e.forEach((e=>{r||(!Do(e)||!e.includes(t))&&(r=Mo("UNSUPPORTED_CHAINS",`${i}, chain ${e} should be a string and conform to "namespace:chainId" format`))})):r=Mo("UNSUPPORTED_CHAINS",`${i}, chains ${e} should be an array of strings conforming to "namespace:chainId" format`),r}function Ho(t,e){let i=null;return Object.entries(t).forEach((([t,r])=>{if(i)return;const n=Bo(t,os(t,r),`${e} requiredNamespace`);n&&(i=n)})),i}function Ko(t,e){let i=null;return xo(t)?t.forEach((t=>{i||ko(t)||(i=Mo("UNSUPPORTED_ACCOUNTS",`${e}, account ${t} should be a string and conform to "namespace:chainId:address" format`))})):i=Mo("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),i}function zo(t,e){let i=null;return Object.values(t).forEach((t=>{if(i)return;const r=Ko(t?.accounts,`${e} namespace`);r&&(i=r)})),i}function Wo(t,e){let i=null;return Go(t?.methods)?Go(t?.events)||(i=Mo("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):i=Mo("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),i}function Jo(t,e){let i=null;return Object.values(t).forEach((t=>{if(i)return;const r=Wo(t,`${e}, namespace`);r&&(i=r)})),i}function Xo(t,e,i){let r=null;if(t&&To(t)){const i=Jo(t,e);i&&(r=i);const n=Ho(t,e);n&&(r=n)}else r=Po("MISSING_OR_INVALID",`${e}, ${i} should be an object with data`);return r}function Yo(t,e){let i=null;if(t&&To(t)){const r=Jo(t,e);r&&(i=r);const n=zo(t,e);n&&(i=n)}else i=Po("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return i}function Zo(t){return Ro(t.protocol,!0)}function Qo(t,e){let i=!1;return e&&!t?i=!0:t&&xo(t)&&t.length&&t.forEach((t=>{i=Zo(t)})),i}function ta(t){return typeof t=="number"}function ea(t){return typeof t<"u"&&typeof t!==null}function ia(t){return!(!t||typeof t!="object"||!t.code||!Co(t.code,!1)||!t.message||!Ro(t.message,!1))}function ra(t){return!(Uo(t)||!Ro(t.method,!1))}function na(t){return!(Uo(t)||Uo(t.result)&&Uo(t.error)||!Co(t.id,!1)||!Ro(t.jsonrpc,!1))}function sa(t){return!(Uo(t)||!Ro(t.name,!1))}function oa(t,e){return!(!Do(e)||!Oo(t).includes(e))}function aa(t,e,i){return Ro(i,!1)?So(t,e).includes(i):!1}function ca(t,e,i){return Ro(i,!1)?Io(t,e).includes(i):!1}function ha(t,e,i,r){let n=null;const s=Object.keys(t),o=Object.keys(e);return Xs(s,o)?s.forEach((r=>{if(n)return;const s=Eo(e[r].accounts);Xs(os(r,t[r]),s)?Xs(t[r].methods,e[r].methods)?Xs(t[r].events,e[r].events)||(n=Po("NON_CONFORMING_NAMESPACES",`${i} namespaces events don't satisfy namespace events for ${r}`)):n=Po("NON_CONFORMING_NAMESPACES",`${i} namespaces methods don't satisfy namespace methods for ${r}`):n=Po("NON_CONFORMING_NAMESPACES",`${i} namespaces accounts don't satisfy namespace chains for ${r}`)})):n=Po("NON_CONFORMING_NAMESPACES",`${i} namespaces keys don't satisfy ${r}`),n}function ua(t,e){return Co(t,!1)&&t<=e.max&&t>=e.min}const fa="PARSE_ERROR";const la="INVALID_REQUEST";const da="METHOD_NOT_FOUND";const pa="INVALID_PARAMS";const wa="INTERNAL_ERROR";const ya="SERVER_ERROR";const va=[-32700,-32600,-32601,-32602,-32603];const ba={[fa]:{code:-32700,message:"Parse error"},[la]:{code:-32600,message:"Invalid Request"},[da]:{code:-32601,message:"Method not found"},[pa]:{code:-32602,message:"Invalid params"},[wa]:{code:-32603,message:"Internal error"},[ya]:{code:-32e3,message:"Server error"}};const ma=ya;function _a(t){return va.includes(t)}function ga(t){if(!Object.keys(ba).includes(t)){return ba[ma]}return ba[t]}function Ea(t){const e=Object.values(ba).find((e=>e.code===t));if(!e){return ba[ma]}return e}function Oa(t,e,i){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${i} RPC url at ${e}`):t}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Sa=function(t,e){Sa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return Sa(t,e)};function Ia(t,e){Sa(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var ja=function(){ja=Object.assign||function t(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s))e[s]=i[s]}return e};return ja.apply(this,arguments)};function Aa(t,e){var i={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0)i[r]=t[r];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var n=0,r=Object.getOwnPropertySymbols(t);n<r.length;n++){if(e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n]))i[r[n]]=t[r[n]]}return i}function Na(t,e,i,r){var n=arguments.length,s=n<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r,o;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)if(o=t[a])s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s;return n>3&&s&&Object.defineProperty(e,i,s),s}function Pa(t,e){return function(i,r){e(i,r,t)}}function Ma(t,e){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(t,e)}function xa(t,e,i,r){function n(t){return t instanceof i?t:new i((function(e){e(t)}))}return new(i||(i=Promise))((function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r["throw"](t))}catch(t){s(t)}}function c(t){t.done?i(t.value):n(t.value).then(o,a)}c((r=r.apply(t,e||[])).next())}))}function Ta(t,e){var i={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,n,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(t){return function(e){return c([t,e])}}function c(o){if(r)throw new TypeError("Generator is already executing.");while(i)try{if(r=1,n&&(s=o[0]&2?n["return"]:o[0]?n["throw"]||((s=n["return"])&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;if(n=0,s)o=[o[0]&2,s.value];switch(o[0]){case 0:case 1:s=o;break;case 4:i.label++;return{value:o[1],done:false};case 5:i.label++;n=o[1];o=[0];continue;case 7:o=i.ops.pop();i.trys.pop();continue;default:if(!(s=i.trys,s=s.length>0&&s[s.length-1])&&(o[0]===6||o[0]===2)){i=0;continue}if(o[0]===3&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(o[0]===6&&i.label<s[1]){i.label=s[1];s=o;break}if(s&&i.label<s[2]){i.label=s[2];i.ops.push(o);break}if(s[2])i.ops.pop();i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t];n=0}finally{r=s=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}}function Ua(t,e,i,r){if(r===undefined)r=i;t[r]=e[i]}function Ra(t,e){for(var i in t)if(i!=="default"&&!e.hasOwnProperty(i))e[i]=t[i]}function Ca(t){var e=typeof Symbol==="function"&&Symbol.iterator,i=e&&t[e],r=0;if(i)return i.call(t);if(t&&typeof t.length==="number")return{next:function(){if(t&&r>=t.length)t=void 0;return{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function $a(t,e){var i=typeof Symbol==="function"&&t[Symbol.iterator];if(!i)return t;var r=i.call(t),n,s=[],o;try{while((e===void 0||e-- >0)&&!(n=r.next()).done)s.push(n.value)}catch(t){o={error:t}}finally{try{if(n&&!n.done&&(i=r["return"]))i.call(r)}finally{if(o)throw o.error}}return s}function Da(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat($a(arguments[e]));return t}function ka(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var r=Array(t),n=0,e=0;e<i;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,n++)r[n]=s[o];return r}function La(t){return this instanceof La?(this.v=t,this):new La(t)}function Va(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=i.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(t){if(r[t])n[t]=function(e){return new Promise((function(i,r){s.push([t,e,i,r])>1||a(t,e)}))}}function a(t,e){try{c(r[t](e))}catch(t){f(s[0][3],t)}}function c(t){t.value instanceof La?Promise.resolve(t.value.v).then(h,u):f(s[0][2],t)}function h(t){a("next",t)}function u(t){a("throw",t)}function f(t,e){if(t(e),s.shift(),s.length)a(s[0][0],s[0][1])}}function qa(t){var e,i;return e={},r("next"),r("throw",(function(t){throw t})),r("return"),e[Symbol.iterator]=function(){return this},e;function r(r,n){e[r]=t[r]?function(e){return(i=!i)?{value:La(t[r](e)),done:r==="return"}:n?n(e):e}:n}}function Fa(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],i;return e?e.call(t):(t=typeof Ca==="function"?Ca(t):t[Symbol.iterator](),i={},r("next"),r("throw"),r("return"),i[Symbol.asyncIterator]=function(){return this},i);function r(e){i[e]=t[e]&&function(i){return new Promise((function(r,s){i=t[e](i),n(r,s,i.done,i.value)}))}}function n(t,e,i,r){Promise.resolve(r).then((function(e){t({value:e,done:i})}),e)}}function Ga(t,e){if(Object.defineProperty){Object.defineProperty(t,"raw",{value:e})}else{t.raw=e}return t}function Ba(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var i in t)if(Object.hasOwnProperty.call(t,i))e[i]=t[i];e.default=t;return e}function Ha(t){return t&&t.__esModule?t:{default:t}}function Ka(t,e){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return e.get(t)}function za(t,e,i){if(!e.has(t)){throw new TypeError("attempted to set private field on non-instance")}e.set(t,i);return i}const Wa=Object.freeze({__proto__:null,__extends:Ia,get __assign(){return ja},__rest:Aa,__decorate:Na,__param:Pa,__metadata:Ma,__awaiter:xa,__generator:Ta,__createBinding:Ua,__exportStar:Ra,__values:Ca,__read:$a,__spread:Da,__spreadArrays:ka,__await:La,__asyncGenerator:Va,__asyncDelegator:qa,__asyncValues:Fa,__makeTemplateObject:Ga,__importStar:Ba,__importDefault:Ha,__classPrivateFieldGet:Ka,__classPrivateFieldSet:za});var Ja=t((function(t,i){Object.defineProperty(i,"__esModule",{value:true});i.isBrowserCryptoAvailable=i.getSubtleCrypto=i.getBrowerCrypto=void 0;function r(){return(e===null||e===void 0?void 0:e.crypto)||(e===null||e===void 0?void 0:e.msCrypto)||{}}i.getBrowerCrypto=r;function n(){const t=r();return t.subtle||t.webkitSubtle}i.getSubtleCrypto=n;function s(){return!!r()&&!!n()}i.isBrowserCryptoAvailable=s}));var Xa=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});e.isBrowser=e.isNode=e.isReactNative=void 0;function i(){return typeof document==="undefined"&&typeof navigator!=="undefined"&&navigator.product==="ReactNative"}e.isReactNative=i;function r(){return typeof process!=="undefined"&&typeof process.versions!=="undefined"&&typeof process.versions.node!=="undefined"}e.isNode=r;function n(){return!i()&&!r()}e.isBrowser=n}));const Ya=i(Wa);var Za=t((function(t,e){Object.defineProperty(e,"__esModule",{value:true});Ya.__exportStar(Ja,e);Ya.__exportStar(Xa,e)}));function Qa(){const t=Date.now()*Math.pow(10,3);const e=Math.floor(Math.random()*Math.pow(10,3));return t+e}function tc(t,e,i){return{id:i||Qa(),jsonrpc:"2.0",method:t,params:e}}function ec(t,e){return{id:t,jsonrpc:"2.0",result:e}}function ic(t,e,i){return{id:t,jsonrpc:"2.0",error:rc(e,i)}}function rc(t,e){if(typeof t==="undefined"){return ga(wa)}if(typeof t==="string"){t=Object.assign(Object.assign({},ga(ya)),{message:t})}if(typeof e!=="undefined"){t.data=e}if(_a(t.code)){t=Ea(t.code)}return t}class nc{}class sc extends nc{constructor(){super()}}class oc extends sc{constructor(t){super()}}const ac="^https?:";const cc="^wss?:";function hc(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!e||!e.length)return;return e[0]}function uc(t,e){const i=hc(t);if(typeof i==="undefined")return false;return new RegExp(e).test(i)}function fc(t){return uc(t,ac)}function lc(t){return uc(t,cc)}function dc(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function pc(t){return typeof t==="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function wc(t){return pc(t)&&"method"in t}function yc(t){return pc(t)&&(vc(t)||bc(t))}function vc(t){return"result"in t}function bc(t){return"error"in t}class mc extends oc{constructor(t){super(t);this.events=new D.EventEmitter;this.hasRegisteredEventListeners=false;this.connection=this.setConnection(t);if(this.connection.connected){this.registerEventListeners()}}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,e){this.events.on(t,e)}once(t,e){this.events.once(t,e)}off(t,e){this.events.off(t,e)}removeListener(t,e){this.events.removeListener(t,e)}async request(t,e){return this.requestStrict(tc(t.method,t.params||[]),e)}async requestStrict(t,e){return new Promise((async(i,r)=>{if(!this.connection.connected){try{await this.open()}catch(t){r(t)}}this.events.on(`${t.id}`,(t=>{if(bc(t)){r(t.error)}else{i(t.result)}}));try{await this.connection.send(t,e)}catch(t){r(t)}}))}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t);if(yc(t)){this.events.emit(`${t.id}`,t)}else{this.events.emit("message",{type:t.method,data:t.params})}}async open(t=this.connection){if(this.connection===t&&this.connection.connected)return;if(this.connection.connected)this.close();if(typeof t==="string"){await this.connection.open(t);t=this.connection}this.connection=this.setConnection(t);await this.connection.open();this.registerEventListeners();this.events.emit("connect")}async close(){await this.connection.close()}registerEventListeners(){if(this.hasRegisteredEventListeners)return;this.connection.on("payload",(t=>this.onPayload(t)));this.connection.on("close",(()=>this.events.emit("disconnect")));this.connection.on("error",(t=>this.events.emit("error",t)));this.hasRegisteredEventListeners=true}}const _c=10;const gc=()=>{if(typeof global!=="undefined"&&typeof global.WebSocket!=="undefined"){return global.WebSocket}if(typeof window!=="undefined"&&typeof window.WebSocket!=="undefined"){return window.WebSocket}return require("ws")};const Ec=()=>typeof window!=="undefined";const Oc=gc();class Sc{constructor(t){this.url=t;this.events=new D.EventEmitter;this.registering=false;if(!lc(t)){throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`)}this.url=t}get connected(){return typeof this.socket!=="undefined"}get connecting(){return this.registering}on(t,e){this.events.on(t,e)}once(t,e){this.events.once(t,e)}off(t,e){this.events.off(t,e)}removeListener(t,e){this.events.removeListener(t,e)}async open(t=this.url){await this.register(t)}async close(){return new Promise(((t,e)=>{if(typeof this.socket==="undefined"){e(new Error("Connection already closed"));return}this.socket.onclose=()=>{this.onClose();t()};this.socket.close()}))}async send(t,e){if(typeof this.socket==="undefined"){this.socket=await this.register()}try{this.socket.send(Ci(t))}catch(e){this.onError(t.id,e)}}register(t=this.url){if(!lc(t)){throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`)}if(this.registering){const t=this.events.getMaxListeners();if(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t){this.events.setMaxListeners(t+1)}return new Promise(((t,e)=>{this.events.once("register_error",(t=>{this.resetMaxListeners();e(t)}));this.events.once("open",(()=>{this.resetMaxListeners();if(typeof this.socket==="undefined"){return e(new Error("WebSocket connection is missing or invalid"))}t(this.socket)}))}))}this.url=t;this.registering=true;return new Promise(((e,i)=>{const r=!Za.isReactNative()?{rejectUnauthorized:!dc(t)}:undefined;const n=new Oc(t,[],r);if(Ec()){n.onerror=t=>{const e=t;i(this.emitError(e.error))}}else{n.on("error",(t=>{i(this.emitError(t))}))}n.onopen=()=>{this.onOpen(n);e(n)}}))}onOpen(t){t.onmessage=t=>this.onPayload(t);t.onclose=()=>this.onClose();this.socket=t;this.registering=false;this.events.emit("open")}onClose(){this.socket=undefined;this.registering=false;this.events.emit("close")}onPayload(t){if(typeof t.data==="undefined")return;const e=typeof t.data==="string"?Ri(t.data):t.data;this.events.emit("payload",e)}onError(t,e){const i=this.parseError(e);const r=i.message||i.toString();const n=ic(t,r);this.events.emit("payload",n)}parseError(t,e=this.url){return Oa(t,e,"WS")}resetMaxListeners(){if(this.events.getMaxListeners()>_c){this.events.setMaxListeners(_c)}}emitError(t){const e=this.parseError(new Error((t===null||t===void 0?void 0:t.message)||`WebSocket connection failed for URL: ${this.url}`));this.events.emit("register_error",e);return e}}var Ic=t((function(t,i){var r=200;var n="__lodash_hash_undefined__";var s=1,o=2;var a=9007199254740991;var c="[object Arguments]",h="[object Array]",u="[object AsyncFunction]",f="[object Boolean]",l="[object Date]",d="[object Error]",p="[object Function]",w="[object GeneratorFunction]",y="[object Map]",v="[object Number]",b="[object Null]",m="[object Object]",_="[object Promise]",g="[object Proxy]",E="[object RegExp]",O="[object Set]",S="[object String]",I="[object Symbol]",j="[object Undefined]",A="[object WeakMap]";var N="[object ArrayBuffer]",P="[object DataView]",M="[object Float32Array]",x="[object Float64Array]",T="[object Int8Array]",U="[object Int16Array]",R="[object Int32Array]",C="[object Uint8Array]",$="[object Uint8ClampedArray]",D="[object Uint16Array]",k="[object Uint32Array]";var L=/[\\^$.*+?()[\]{}|]/g;var V=/^\[object .+?Constructor\]$/;var q=/^(?:0|[1-9]\d*)$/;var F={};F[M]=F[x]=F[T]=F[U]=F[R]=F[C]=F[$]=F[D]=F[k]=true;F[c]=F[h]=F[N]=F[f]=F[P]=F[l]=F[d]=F[p]=F[y]=F[v]=F[m]=F[E]=F[O]=F[S]=F[A]=false;var G=typeof e=="object"&&e&&e.Object===Object&&e;var B=typeof self=="object"&&self&&self.Object===Object&&self;var H=G||B||Function("return this")();var K=i&&!i.nodeType&&i;var z=K&&"object"=="object"&&t&&!t.nodeType&&t;var W=z&&z.exports===K;var J=W&&G.process;var X=function(){try{return J&&J.binding&&J.binding("util")}catch(t){}}();var Y=X&&X.isTypedArray;function Z(t,e){var i=-1,r=t==null?0:t.length,n=0,s=[];while(++i<r){var o=t[i];if(e(o,i,t)){s[n++]=o}}return s}function Q(t,e){var i=-1,r=e.length,n=t.length;while(++i<r){t[n+i]=e[i]}return t}function tt(t,e){var i=-1,r=t==null?0:t.length;while(++i<r){if(e(t[i],i,t)){return true}}return false}function et(t,e){var i=-1,r=Array(t);while(++i<t){r[i]=e(i)}return r}function it(t){return function(e){return t(e)}}function rt(t,e){return t.has(e)}function nt(t,e){return t==null?undefined:t[e]}function st(t){var e=-1,i=Array(t.size);t.forEach((function(t,r){i[++e]=[r,t]}));return i}function ot(t,e){return function(i){return t(e(i))}}function at(t){var e=-1,i=Array(t.size);t.forEach((function(t){i[++e]=t}));return i}var ct=Array.prototype,ht=Function.prototype,ut=Object.prototype;var ft=H["__core-js_shared__"];var lt=ht.toString;var dt=ut.hasOwnProperty;var pt=function(){var t=/[^.]+$/.exec(ft&&ft.keys&&ft.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();var wt=ut.toString;var yt=RegExp("^"+lt.call(dt).replace(L,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var vt=W?H.Buffer:undefined,bt=H.Symbol,mt=H.Uint8Array,_t=ut.propertyIsEnumerable,gt=ct.splice,Et=bt?bt.toStringTag:undefined;var Ot=Object.getOwnPropertySymbols,St=vt?vt.isBuffer:undefined,It=ot(Object.keys,Object);var jt=Ae(H,"DataView"),At=Ae(H,"Map"),Nt=Ae(H,"Promise"),Pt=Ae(H,"Set"),Mt=Ae(H,"WeakMap"),xt=Ae(Object,"create");var Tt=$e(jt),Ut=$e(At),Rt=$e(Nt),Ct=$e(Pt),$t=$e(Mt);var Dt=bt?bt.prototype:undefined,kt=Dt?Dt.valueOf:undefined;function Lt(t){var e=-1,i=t==null?0:t.length;this.clear();while(++e<i){var r=t[e];this.set(r[0],r[1])}}function Vt(){this.__data__=xt?xt(null):{};this.size=0}function qt(t){var e=this.has(t)&&delete this.__data__[t];this.size-=e?1:0;return e}function Ft(t){var e=this.__data__;if(xt){var i=e[t];return i===n?undefined:i}return dt.call(e,t)?e[t]:undefined}function Gt(t){var e=this.__data__;return xt?e[t]!==undefined:dt.call(e,t)}function Bt(t,e){var i=this.__data__;this.size+=this.has(t)?0:1;i[t]=xt&&e===undefined?n:e;return this}Lt.prototype.clear=Vt;Lt.prototype["delete"]=qt;Lt.prototype.get=Ft;Lt.prototype.has=Gt;Lt.prototype.set=Bt;function Ht(t){var e=-1,i=t==null?0:t.length;this.clear();while(++e<i){var r=t[e];this.set(r[0],r[1])}}function Kt(){this.__data__=[];this.size=0}function zt(t){var e=this.__data__,i=de(e,t);if(i<0){return false}var r=e.length-1;if(i==r){e.pop()}else{gt.call(e,i,1)}--this.size;return true}function Wt(t){var e=this.__data__,i=de(e,t);return i<0?undefined:e[i][1]}function Jt(t){return de(this.__data__,t)>-1}function Xt(t,e){var i=this.__data__,r=de(i,t);if(r<0){++this.size;i.push([t,e])}else{i[r][1]=e}return this}Ht.prototype.clear=Kt;Ht.prototype["delete"]=zt;Ht.prototype.get=Wt;Ht.prototype.has=Jt;Ht.prototype.set=Xt;function Yt(t){var e=-1,i=t==null?0:t.length;this.clear();while(++e<i){var r=t[e];this.set(r[0],r[1])}}function Zt(){this.size=0;this.__data__={hash:new Lt,map:new(At||Ht),string:new Lt}}function Qt(t){var e=je(this,t)["delete"](t);this.size-=e?1:0;return e}function te(t){return je(this,t).get(t)}function ee(t){return je(this,t).has(t)}function ie(t,e){var i=je(this,t),r=i.size;i.set(t,e);this.size+=i.size==r?0:1;return this}Yt.prototype.clear=Zt;Yt.prototype["delete"]=Qt;Yt.prototype.get=te;Yt.prototype.has=ee;Yt.prototype.set=ie;function re(t){var e=-1,i=t==null?0:t.length;this.__data__=new Yt;while(++e<i){this.add(t[e])}}function ne(t){this.__data__.set(t,n);return this}function se(t){return this.__data__.has(t)}re.prototype.add=re.prototype.push=ne;re.prototype.has=se;function oe(t){var e=this.__data__=new Ht(t);this.size=e.size}function ae(){this.__data__=new Ht;this.size=0}function ce(t){var e=this.__data__,i=e["delete"](t);this.size=e.size;return i}function he(t){return this.__data__.get(t)}function ue(t){return this.__data__.has(t)}function fe(t,e){var i=this.__data__;if(i instanceof Ht){var n=i.__data__;if(!At||n.length<r-1){n.push([t,e]);this.size=++i.size;return this}i=this.__data__=new Yt(n)}i.set(t,e);this.size=i.size;return this}oe.prototype.clear=ae;oe.prototype["delete"]=ce;oe.prototype.get=he;oe.prototype.has=ue;oe.prototype.set=fe;function le(t,e){var i=Le(t),r=!i&&ke(t),n=!i&&!r&&qe(t),s=!i&&!r&&!n&&ze(t),o=i||r||n||s,a=o?et(t.length,String):[],c=a.length;for(var h in t){if((e||dt.call(t,h))&&!(o&&(h=="length"||n&&(h=="offset"||h=="parent")||s&&(h=="buffer"||h=="byteLength"||h=="byteOffset")||xe(h,c)))){a.push(h)}}return a}function de(t,e){var i=t.length;while(i--){if(De(t[i][0],e)){return i}}return-1}function pe(t,e,i){var r=e(t);return Le(t)?r:Q(r,i(t))}function we(t){if(t==null){return t===undefined?j:b}return Et&&Et in Object(t)?Ne(t):Ce(t)}function ye(t){return Ke(t)&&we(t)==c}function ve(t,e,i,r,n){if(t===e){return true}if(t==null||e==null||!Ke(t)&&!Ke(e)){return t!==t&&e!==e}return be(t,e,i,r,ve,n)}function be(t,e,i,r,n,o){var a=Le(t),u=Le(e),f=a?h:Me(t),l=u?h:Me(e);f=f==c?m:f;l=l==c?m:l;var d=f==m,p=l==m,w=f==l;if(w&&qe(t)){if(!qe(e)){return false}a=true;d=false}if(w&&!d){o||(o=new oe);return a||ze(t)?Ee(t,e,i,r,n,o):Oe(t,e,f,i,r,n,o)}if(!(i&s)){var y=d&&dt.call(t,"__wrapped__"),v=p&&dt.call(e,"__wrapped__");if(y||v){var b=y?t.value():t,_=v?e.value():e;o||(o=new oe);return n(b,_,i,r,o)}}if(!w){return false}o||(o=new oe);return Se(t,e,i,r,n,o)}function me(t){if(!He(t)||Ue(t)){return false}var e=Ge(t)?yt:V;return e.test($e(t))}function _e(t){return Ke(t)&&Be(t.length)&&!!F[we(t)]}function ge(t){if(!Re(t)){return It(t)}var e=[];for(var i in Object(t)){if(dt.call(t,i)&&i!="constructor"){e.push(i)}}return e}function Ee(t,e,i,r,n,a){var c=i&s,h=t.length,u=e.length;if(h!=u&&!(c&&u>h)){return false}var f=a.get(t);if(f&&a.get(e)){return f==e}var l=-1,d=true,p=i&o?new re:undefined;a.set(t,e);a.set(e,t);while(++l<h){var w=t[l],y=e[l];if(r){var v=c?r(y,w,l,e,t,a):r(w,y,l,t,e,a)}if(v!==undefined){if(v){continue}d=false;break}if(p){if(!tt(e,(function(t,e){if(!rt(p,e)&&(w===t||n(w,t,i,r,a))){return p.push(e)}}))){d=false;break}}else if(!(w===y||n(w,y,i,r,a))){d=false;break}}a["delete"](t);a["delete"](e);return d}function Oe(t,e,i,r,n,a,c){switch(i){case P:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset){return false}t=t.buffer;e=e.buffer;case N:if(t.byteLength!=e.byteLength||!a(new mt(t),new mt(e))){return false}return true;case f:case l:case v:return De(+t,+e);case d:return t.name==e.name&&t.message==e.message;case E:case S:return t==e+"";case y:var h=st;case O:var u=r&s;h||(h=at);if(t.size!=e.size&&!u){return false}var p=c.get(t);if(p){return p==e}r|=o;c.set(t,e);var w=Ee(h(t),h(e),r,n,a,c);c["delete"](t);return w;case I:if(kt){return kt.call(t)==kt.call(e)}}return false}function Se(t,e,i,r,n,o){var a=i&s,c=Ie(t),h=c.length,u=Ie(e),f=u.length;if(h!=f&&!a){return false}var l=h;while(l--){var d=c[l];if(!(a?d in e:dt.call(e,d))){return false}}var p=o.get(t);if(p&&o.get(e)){return p==e}var w=true;o.set(t,e);o.set(e,t);var y=a;while(++l<h){d=c[l];var v=t[d],b=e[d];if(r){var m=a?r(b,v,d,e,t,o):r(v,b,d,t,e,o)}if(!(m===undefined?v===b||n(v,b,i,r,o):m)){w=false;break}y||(y=d=="constructor")}if(w&&!y){var _=t.constructor,g=e.constructor;if(_!=g&&("constructor"in t&&"constructor"in e)&&!(typeof _=="function"&&_ instanceof _&&typeof g=="function"&&g instanceof g)){w=false}}o["delete"](t);o["delete"](e);return w}function Ie(t){return pe(t,We,Pe)}function je(t,e){var i=t.__data__;return Te(e)?i[typeof e=="string"?"string":"hash"]:i.map}function Ae(t,e){var i=nt(t,e);return me(i)?i:undefined}function Ne(t){var e=dt.call(t,Et),i=t[Et];try{t[Et]=undefined;var r=true}catch(t){}var n=wt.call(t);if(r){if(e){t[Et]=i}else{delete t[Et]}}return n}var Pe=!Ot?Je:function(t){if(t==null){return[]}t=Object(t);return Z(Ot(t),(function(e){return _t.call(t,e)}))};var Me=we;if(jt&&Me(new jt(new ArrayBuffer(1)))!=P||At&&Me(new At)!=y||Nt&&Me(Nt.resolve())!=_||Pt&&Me(new Pt)!=O||Mt&&Me(new Mt)!=A){Me=function(t){var e=we(t),i=e==m?t.constructor:undefined,r=i?$e(i):"";if(r){switch(r){case Tt:return P;case Ut:return y;case Rt:return _;case Ct:return O;case $t:return A}}return e}}function xe(t,e){e=e==null?a:e;return!!e&&(typeof t=="number"||q.test(t))&&(t>-1&&t%1==0&&t<e)}function Te(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function Ue(t){return!!pt&&pt in t}function Re(t){var e=t&&t.constructor,i=typeof e=="function"&&e.prototype||ut;return t===i}function Ce(t){return wt.call(t)}function $e(t){if(t!=null){try{return lt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function De(t,e){return t===e||t!==t&&e!==e}var ke=ye(function(){return arguments}())?ye:function(t){return Ke(t)&&dt.call(t,"callee")&&!_t.call(t,"callee")};var Le=Array.isArray;function Ve(t){return t!=null&&Be(t.length)&&!Ge(t)}var qe=St||Xe;function Fe(t,e){return ve(t,e)}function Ge(t){if(!He(t)){return false}var e=we(t);return e==p||e==w||e==u||e==g}function Be(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=a}function He(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function Ke(t){return t!=null&&typeof t=="object"}var ze=Y?it(Y):_e;function We(t){return Ve(t)?le(t):ge(t)}function Je(){return[]}function Xe(){return false}t.exports=Fe}));function jc(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),r=0;r<i.length;r++)i[r]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(i[o]!==255)throw new TypeError(s+" is ambiguous");i[o]=n}var a=t.length,c=t.charAt(0),h=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function f(e){if(e instanceof Uint8Array||(ArrayBuffer.isView(e)?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):Array.isArray(e)&&(e=Uint8Array.from(e))),!(e instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(e.length===0)return"";for(var i=0,r=0,n=0,s=e.length;n!==s&&e[n]===0;)n++,i++;for(var o=(s-n)*u+1>>>0,h=new Uint8Array(o);n!==s;){for(var f=e[n],l=0,d=o-1;(f!==0||l<r)&&d!==-1;d--,l++)f+=256*h[d]>>>0,h[d]=f%a>>>0,f=f/a>>>0;if(f!==0)throw new Error("Non-zero carry");r=l,n++}for(var p=o-r;p!==o&&h[p]===0;)p++;for(var w=c.repeat(i);p<o;++p)w+=t.charAt(h[p]);return w}function l(t){if(typeof t!="string")throw new TypeError("Expected String");if(t.length===0)return new Uint8Array;var e=0;if(t[e]!==" "){for(var r=0,n=0;t[e]===c;)r++,e++;for(var s=(t.length-e)*h+1>>>0,o=new Uint8Array(s);t[e];){var u=i[t.charCodeAt(e)];if(u===255)return;for(var f=0,l=s-1;(u!==0||f<n)&&l!==-1;l--,f++)u+=a*o[l]>>>0,o[l]=u%256>>>0,u=u/256>>>0;if(u!==0)throw new Error("Non-zero carry");n=f,e++}if(t[e]!==" "){for(var d=s-n;d!==s&&o[d]===0;)d++;for(var p=new Uint8Array(r+(s-d)),w=r;d!==s;)p[w++]=o[d++];return p}}}function d(t){var i=l(t);if(i)return i;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:l,decode:d}}var Ac=jc,Nc=Ac;const Pc=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Mc=t=>(new TextEncoder).encode(t),xc=t=>(new TextDecoder).decode(t);class Tc{constructor(t,e,i){this.name=t,this.prefix=e,this.baseEncode=i}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class Uc{constructor(t,e,i){if(this.name=t,this.prefix=e,e.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=e.codePointAt(0),this.baseDecode=i}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Cc(this,t)}}class Rc{constructor(t){this.decoders=t}or(t){return Cc(this,t)}decode(t){const e=t[0],i=this.decoders[e];if(i)return i.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Cc=(t,e)=>new Rc({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class $c{constructor(t,e,i,r){this.name=t,this.prefix=e,this.baseEncode=i,this.baseDecode=r,this.encoder=new Tc(t,e,i),this.decoder=new Uc(t,e,r)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Dc=({name:t,prefix:e,encode:i,decode:r})=>new $c(t,e,i,r),kc=({prefix:t,name:e,alphabet:i})=>{const{encode:r,decode:n}=Nc(i,e);return Dc({prefix:t,name:e,encode:r,decode:t=>Pc(n(t))})},Lc=(t,e,i,r)=>{const n={};for(let t=0;t<e.length;++t)n[e[t]]=t;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*i/8|0);let a=0,c=0,h=0;for(let e=0;e<s;++e){const s=n[t[e]];if(s===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<i|s,a+=i,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=i||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Vc=(t,e,i)=>{const r=e[e.length-1]==="=",n=(1<<i)-1;let s="",o=0,a=0;for(let r=0;r<t.length;++r)for(a=a<<8|t[r],o+=8;o>i;)o-=i,s+=e[n&a>>o];if(o&&(s+=e[n&a<<i-o]),r)for(;s.length*i&7;)s+="=";return s},qc=({name:t,prefix:e,bitsPerChar:i,alphabet:r})=>Dc({prefix:e,name:t,encode(t){return Vc(t,r,i)},decode(e){return Lc(e,r,i,t)}}),Fc=Dc({prefix:"\0",name:"identity",encode:t=>xc(t),decode:t=>Mc(t)});var Gc=Object.freeze({__proto__:null,identity:Fc});const Bc=qc({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Hc=Object.freeze({__proto__:null,base2:Bc});const Kc=qc({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var zc=Object.freeze({__proto__:null,base8:Kc});const Wc=kc({prefix:"9",name:"base10",alphabet:"0123456789"});var Jc=Object.freeze({__proto__:null,base10:Wc});const Xc=qc({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Yc=qc({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Zc=Object.freeze({__proto__:null,base16:Xc,base16upper:Yc});const Qc=qc({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),th=qc({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),eh=qc({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ih=qc({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),rh=qc({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),nh=qc({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),sh=qc({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),oh=qc({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ah=qc({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var ch=Object.freeze({__proto__:null,base32:Qc,base32upper:th,base32pad:eh,base32padupper:ih,base32hex:rh,base32hexupper:nh,base32hexpad:sh,base32hexpadupper:oh,base32z:ah});const hh=kc({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),uh=kc({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var fh=Object.freeze({__proto__:null,base36:hh,base36upper:uh});const lh=kc({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),dh=kc({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var ph=Object.freeze({__proto__:null,base58btc:lh,base58flickr:dh});const wh=qc({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),yh=qc({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),vh=qc({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),bh=qc({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var mh=Object.freeze({__proto__:null,base64:wh,base64pad:yh,base64url:vh,base64urlpad:bh});const _h=Array.from(""),gh=_h.reduce(((t,e,i)=>(t[i]=e,t)),[]),Eh=_h.reduce(((t,e,i)=>(t[e.codePointAt(0)]=i,t)),[]);function Oh(t){return t.reduce(((t,e)=>(t+=gh[e],t)),"")}function Sh(t){const e=[];for(const i of t){const t=Eh[i.codePointAt(0)];if(t===void 0)throw new Error(`Non-base256emoji character: ${i}`);e.push(t)}return new Uint8Array(e)}const Ih=Dc({prefix:"",name:"base256emoji",encode:Oh,decode:Sh});var jh=Object.freeze({__proto__:null,base256emoji:Ih}),Ah=Th,Nh=128,Ph=127,Mh=~Ph,xh=Math.pow(2,31);function Th(t,e,i){e=e||[],i=i||0;for(var r=i;t>=xh;)e[i++]=t&255|Nh,t/=128;for(;t&Mh;)e[i++]=t&255|Nh,t>>>=7;return e[i]=t|0,Th.bytes=i-r+1,e}var Uh=$h,Rh=128,Ch=127;function $h(t,e){var i=0,e=e||0,r=0,n=e,s,o=t.length;do{if(n>=o)throw $h.bytes=0,new RangeError("Could not decode varint");s=t[n++],i+=r<28?(s&Ch)<<r:(s&Ch)*Math.pow(2,r),r+=7}while(s>=Rh);return $h.bytes=n-e,i}var Dh=Math.pow(2,7),kh=Math.pow(2,14),Lh=Math.pow(2,21),Vh=Math.pow(2,28),qh=Math.pow(2,35),Fh=Math.pow(2,42),Gh=Math.pow(2,49),Bh=Math.pow(2,56),Hh=Math.pow(2,63),Kh=function(t){return t<Dh?1:t<kh?2:t<Lh?3:t<Vh?4:t<qh?5:t<Fh?6:t<Gh?7:t<Bh?8:t<Hh?9:10},zh={encode:Ah,decode:Uh,encodingLength:Kh},Wh=zh;const Jh=(t,e,i=0)=>(Wh.encode(t,e,i),e),Xh=t=>Wh.encodingLength(t),Yh=(t,e)=>{const i=e.byteLength,r=Xh(t),n=r+Xh(i),s=new Uint8Array(n+i);return Jh(t,s,0),Jh(i,s,r),s.set(e,n),new Zh(t,i,e,s)};class Zh{constructor(t,e,i,r){this.code=t,this.size=e,this.digest=i,this.bytes=r}}const Qh=({name:t,code:e,encode:i})=>new tu(t,e,i);class tu{constructor(t,e,i){this.name=t,this.code=e,this.encode=i}digest(t){if(t instanceof Uint8Array){const e=this.encode(t);return e instanceof Uint8Array?Yh(this.code,e):e.then((t=>Yh(this.code,t)))}else throw Error("Unknown type, must be binary type")}}const eu=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),iu=Qh({name:"sha2-256",code:18,encode:eu("SHA-256")}),ru=Qh({name:"sha2-512",code:19,encode:eu("SHA-512")});Object.freeze({__proto__:null,sha256:iu,sha512:ru});const nu=0,su="identity",ou=Pc,au=t=>Yh(nu,ou(t)),cu={code:nu,name:su,encode:ou,digest:au};Object.freeze({__proto__:null,identity:cu});new TextEncoder,new TextDecoder;const hu={...Gc,...Hc,...zc,...Jc,...Zc,...ch,...fh,...ph,...mh,...jh};function uu(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function fu(t,e,i,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:i},decoder:{decode:r}}}const lu=fu("utf8","u",(t=>"u"+new TextDecoder("utf8").decode(t)),(t=>(new TextEncoder).encode(t.substring(1)))),du=fu("ascii","a",(t=>{let e="a";for(let i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e}),(t=>{t=t.substring(1);const e=uu(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e})),pu={utf8:lu,"utf-8":lu,hex:hu.base16,latin1:du,ascii:du,binary:du,...hu};function wu(t,e="utf8"){const i=pu[e];if(!i)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):i.decoder.decode(`${i.prefix}${t}`)}const yu="wc",vu=2,bu="core",mu=`${yu}@${2}:${bu}:`,_u={name:bu,logger:"error"},gu={database:":memory:"},Eu="crypto",Ou="client_ed25519_seed",Su=ke.ONE_DAY,Iu="keychain",ju="0.3",Au="messages",Nu="0.3",Pu=ke.SIX_HOURS,Mu="publisher",xu="irn",Tu="error",Uu="wss://relay.walletconnect.com",Ru="relayer",Cu={message:"relayer_message",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},$u="_subscription",Du={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},ku=ke.ONE_SECOND,Lu="2.4.6",Vu="0.3",qu={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Fu="subscription",Gu="0.3",Bu=ke.FIVE_SECONDS*1e3,Hu="pairing",Ku="0.3",zu={wc_pairingDelete:{req:{ttl:ke.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ke.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ke.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ke.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ke.ONE_DAY,prompt:!1,tag:0},res:{ttl:ke.ONE_DAY,prompt:!1,tag:0}}},Wu={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Ju="history",Xu="0.3",Yu="expirer",Zu={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Qu="0.3";class tf{constructor(t,e){this.core=t,this.logger=e,this.keychain=new Map,this.name=Iu,this.version=ju,this.initialized=!1,this.storagePrefix=mu,this.init=async()=>{if(!this.initialized){const t=await this.getKeyChain();typeof t<"u"&&(this.keychain=t),this.initialized=!0}},this.has=t=>(this.isInitialized(),this.keychain.has(t)),this.set=async(t,e)=>{this.isInitialized(),this.keychain.set(t,e),await this.persist()},this.get=t=>{this.isInitialized();const e=this.keychain.get(t);if(typeof e>"u"){const{message:e}=Po("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(e)}return e},this.del=async t=>{this.isInitialized(),this.keychain.delete(t),await this.persist()},this.core=t,this.logger=Oi.generateChildLogger(e,this.name)}get context(){return Oi.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,Ys(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Zs(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=Po("NOT_INITIALIZED",this.name);throw new Error(t)}}}class ef{constructor(t,e,i){this.core=t,this.logger=e,this.name=Eu,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=t=>(this.isInitialized(),this.keychain.has(t)),this.getClientId=async()=>{this.isInitialized();const t=await this.getClientSeed(),e=pn(t);return un(e.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const t=vs();return this.setPrivateKey(t.publicKey,t.privateKey)},this.signJWT=async t=>{this.isInitialized();const e=await this.getClientSeed(),i=pn(e),r=bs(),n=Su;return await wn(r,t,n,i)},this.generateSharedKey=(t,e,i)=>{this.isInitialized();const r=this.getPrivateKey(t),n=ms(r,e);return this.setSymKey(n,i)},this.setSymKey=async(t,e)=>{this.isInitialized();const i=e||_s(t);return await this.keychain.set(i,t),i},this.deleteKeyPair=async t=>{this.isInitialized(),await this.keychain.del(t)},this.deleteSymKey=async t=>{this.isInitialized(),await this.keychain.del(t)},this.encode=async(t,e,i)=>{this.isInitialized();const r=Ps(i),n=Ci(e);if(Ms(r)){const e=r.senderPublicKey,i=r.receiverPublicKey;t=await this.generateSharedKey(e,i)}const s=this.getSymKey(t),{type:o,senderPublicKey:a}=r;return Ss({type:o,symKey:s,message:n,senderPublicKey:a})},this.decode=async(t,e,i)=>{this.isInitialized();const r=Ns(e,i);if(Ms(r)){const e=r.receiverPublicKey,i=r.senderPublicKey;t=await this.generateSharedKey(e,i)}const n=this.getSymKey(t),s=Is({symKey:n,encoded:e});return Ri(s)},this.core=t,this.logger=Oi.generateChildLogger(e,this.name),this.keychain=i||new tf(this.core,this.logger)}get context(){return Oi.getLoggerContext(this.logger)}getPayloadType(t){const e=As(t);return Os(e.type)}async setPrivateKey(t,e){return await this.keychain.set(t,e),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(Ou)}catch{t=bs(),await this.keychain.set(Ou,t)}return wu(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=Po("NOT_INITIALIZED",this.name);throw new Error(t)}}}class rf extends ji{constructor(t,e){super(t,e),this.logger=t,this.core=e,this.messages=new Map,this.name=Au,this.version=Nu,this.initialized=!1,this.storagePrefix=mu,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const t=await this.getRelayerMessages();typeof t<"u"&&(this.messages=t),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}finally{this.initialized=!0}}},this.set=async(t,e)=>{this.isInitialized();const i=gs(e);let r=this.messages.get(t);return typeof r>"u"&&(r={}),typeof r[i]<"u"||(r[i]=e,this.messages.set(t,r),await this.persist()),i},this.get=t=>{this.isInitialized();let e=this.messages.get(t);return typeof e>"u"&&(e={}),e},this.has=(t,e)=>{this.isInitialized();const i=this.get(t),r=gs(e);return typeof i[r]<"u"},this.del=async t=>{this.isInitialized(),this.messages.delete(t),await this.persist()},this.logger=Oi.generateChildLogger(t,this.name),this.core=e}get context(){return Oi.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,Ys(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Zs(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=Po("NOT_INITIALIZED",this.name);throw new Error(t)}}}class nf extends Ai{constructor(t,e){super(t,e),this.relayer=t,this.logger=e,this.events=new D.EventEmitter,this.name=Mu,this.queue=new Map,this.publishTimeout=1e4,this.publish=async(t,e,i)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:t,message:e,opts:i}});try{const r=i?.ttl||Pu,n=ho(i),s=i?.prompt||!1,o=i?.tag||0,a={topic:t,message:e,opts:{ttl:r,relay:n,prompt:s,tag:o}},c=gs(e);this.queue.set(c,a);try{await await to(this.rpcPublish(t,e,r,n,s,o),this.publishTimeout),this.relayer.events.emit(Cu.publish,a)}catch{this.logger.debug("Publishing Payload stalled"),this.relayer.events.emit(Cu.connection_stalled);return}this.onPublish(c,a),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:t,message:e,opts:i}})}catch(t){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(t),t}},this.on=(t,e)=>{this.events.on(t,e)},this.once=(t,e)=>{this.events.once(t,e)},this.off=(t,e)=>{this.events.off(t,e)},this.removeListener=(t,e)=>{this.events.removeListener(t,e)},this.relayer=t,this.logger=Oi.generateChildLogger(e,this.name),this.registerEventListeners()}get context(){return Oi.getLoggerContext(this.logger)}rpcPublish(t,e,i,r,n,s){var o,a,c,h;const u={method:uo(r.protocol).publish,params:{topic:t,message:e,ttl:i,prompt:n,tag:s}};return Uo((o=u.params)==null?void 0:o.prompt)&&((a=u.params)==null||delete a.prompt),Uo((c=u.params)==null?void 0:c.tag)&&((h=u.params)==null||delete h.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:u}),this.relayer.provider.request(u)}onPublish(t,e){this.queue.delete(t)}checkQueue(){this.queue.forEach((async t=>{const{topic:e,message:i,opts:r}=t;await this.publish(e,i,r)}))}registerEventListeners(){this.relayer.core.heartbeat.on(We.HEARTBEAT_EVENTS.pulse,(()=>{this.checkQueue()}))}}class sf{constructor(){this.map=new Map,this.set=(t,e)=>{const i=this.get(t);this.exists(t,e)||this.map.set(t,[...i,e])},this.get=t=>this.map.get(t)||[],this.exists=(t,e)=>this.get(t).includes(e),this.delete=(t,e)=>{if(typeof e>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const i=this.get(t);if(!this.exists(t,e))return;const r=i.filter((t=>t!==e));if(!r.length){this.map.delete(t);return}this.map.set(t,r)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var of=Object.defineProperty,af=Object.defineProperties,cf=Object.getOwnPropertyDescriptors,hf=Object.getOwnPropertySymbols,uf=Object.prototype.hasOwnProperty,ff=Object.prototype.propertyIsEnumerable,lf=(t,e,i)=>e in t?of(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,df=(t,e)=>{for(var i in e||(e={}))uf.call(e,i)&&lf(t,i,e[i]);if(hf)for(var i of hf(e))ff.call(e,i)&&lf(t,i,e[i]);return t},pf=(t,e)=>af(t,cf(e));class wf extends Mi{constructor(t,e){super(t,e),this.relayer=t,this.logger=e,this.subscriptions=new Map,this.topicMap=new sf,this.events=new D.EventEmitter,this.name=Fu,this.version=Gu,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=mu,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(t,e)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:t,opts:e}});try{const i=ho(e),r={topic:t,relay:i};this.pending.set(t,r);const n=await this.rpcSubscribe(t,i);return this.onSubscribe(n,r),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:t,opts:e}}),n}catch(t){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(t),t}},this.unsubscribe=async(t,e)=>{await this.restartToComplete(),this.isInitialized(),typeof e?.id<"u"?await this.unsubscribeById(t,e.id,e):await this.unsubscribeByTopic(t,e)},this.isSubscribed=async t=>this.topics.includes(t)?!0:await new Promise(((e,i)=>{const r=new ke.Watch;r.start(this.pendingSubscriptionWatchLabel);const n=setInterval((()=>{!this.pending.has(t)&&this.topics.includes(t)&&(clearInterval(n),r.stop(this.pendingSubscriptionWatchLabel),e(!0)),r.elapsed(this.pendingSubscriptionWatchLabel)>=Bu&&(clearInterval(n),r.stop(this.pendingSubscriptionWatchLabel),i(!1))}),this.pollingInterval)})),this.on=(t,e)=>{this.events.on(t,e)},this.once=(t,e)=>{this.events.once(t,e)},this.off=(t,e)=>{this.events.off(t,e)},this.removeListener=(t,e)=>{this.events.removeListener(t,e)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=Oi.generateChildLogger(e,this.name),this.clientId=""}get context(){return Oi.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,e){let i=!1;try{i=this.getSubscription(t).topic===e}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear(),this.initialized=!1}async unsubscribeByTopic(t,e){const i=this.topicMap.get(t);await Promise.all(i.map((async i=>await this.unsubscribeById(t,i,e))))}async unsubscribeById(t,e,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:e,opts:i}});try{const r=ho(i);await this.rpcUnsubscribe(t,e,r);const n=Mo("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,e,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:e,opts:i}})}catch(t){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(t),t}}async rpcSubscribe(t,e){const i={method:uo(e.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await to(this.relayer.provider.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Cu.connection_stalled)}return gs(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const e=t[0].relay,i={method:uo(e.protocol).batchSubscribe,params:{topics:t.map((t=>t.topic))}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{return await await to(this.relayer.provider.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Cu.connection_stalled)}}rpcUnsubscribe(t,e,i){const r={method:uo(i.protocol).unsubscribe,params:{topic:t,id:e}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r}),this.relayer.provider.request(r)}onSubscribe(t,e){this.setSubscription(t,pf(df({},e),{id:t})),this.pending.delete(e.topic)}onBatchSubscribe(t){t.length&&t.forEach((t=>{this.setSubscription(t.id,df({},t)),this.pending.delete(t.topic)}))}async onUnsubscribe(t,e,i){this.events.removeAllListeners(e),this.hasSubscription(e,t)&&this.deleteSubscription(e,i),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,e){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:e}),this.addSubscription(t,e))}addSubscription(t,e){this.subscriptions.set(t,df({},e)),this.topicMap.set(e.topic,t),this.events.emit(qu.created,e)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const e=this.subscriptions.get(t);if(!e){const{message:e}=Po("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(e)}return e}deleteSubscription(t,e){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:e});const i=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(i.topic,t),this.events.emit(qu.deleted,pf(df({},i),{reason:e}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(qu.sync)}async reset(){if(!this.cached.length)return;const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let e=0;e<t;e++){const t=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(t)}this.events.emit(qu.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:t}=Po("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const e=await this.rpcBatchSubscribe(t);this.onBatchSubscribe(e.map(((e,i)=>pf(df({},t[i]),{id:e}))))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach((e=>{t.push(e)})),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(We.HEARTBEAT_EVENTS.pulse,(async()=>{await this.checkPending()})),this.relayer.on(Cu.connect,(async()=>{await this.onConnect()})),this.relayer.on(Cu.disconnect,(()=>{this.onDisconnect()})),this.events.on(qu.created,(async t=>{const e=qu.created;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,data:t}),await this.persist()})),this.events.on(qu.deleted,(async t=>{const e=qu.deleted;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,data:t}),await this.persist()}))}isInitialized(){if(!this.initialized){const{message:t}=Po("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise((t=>{const e=setInterval((()=>{this.restartInProgress||(clearInterval(e),t())}),this.pollingInterval)}))}}var yf=Object.defineProperty,vf=Object.getOwnPropertySymbols,bf=Object.prototype.hasOwnProperty,mf=Object.prototype.propertyIsEnumerable,_f=(t,e,i)=>e in t?yf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,gf=(t,e)=>{for(var i in e||(e={}))bf.call(e,i)&&_f(t,i,e[i]);if(vf)for(var i of vf(e))mf.call(e,i)&&_f(t,i,e[i]);return t};class Ef extends Ni{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new D.EventEmitter,this.name=Ru,this.transportExplicitlyClosed=!1,this.initialized=!1,this.reconnecting=!1,this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?Oi.generateChildLogger(t.logger,this.name):h(Oi.getDefaultLoggerOptions({level:t.logger||Tu})),this.messages=new rf(this.logger,t.core),this.subscriber=new wf(this,this.logger),this.publisher=new nf(this,this.logger),this.relayUrl=t?.relayUrl||Uu,this.projectId=t.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.provider=await this.createProvider(),await Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0}get context(){return Oi.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,e,i){this.isInitialized(),await this.publisher.publish(t,e,i),await this.recordMessageEvent({topic:t,message:e,publishedAt:Date.now()})}async subscribe(t,e){this.isInitialized();let i="";return await Promise.all([new Promise((e=>{this.subscriber.once(qu.created,(i=>{i.topic===t&&e()}))})),new Promise((async r=>{i=await this.subscriber.subscribe(t,e),r()}))]),i}async unsubscribe(t,e){this.isInitialized(),await this.subscriber.unsubscribe(t,e)}on(t,e){this.events.on(t,e)}once(t,e){this.events.once(t,e)}off(t,e){this.events.off(t,e)}removeListener(t,e){this.events.removeListener(t,e)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(Cu.transport_closed))}async transportOpen(t){if(!this.reconnecting){this.relayUrl=t||this.relayUrl,this.transportExplicitlyClosed=!1,this.reconnecting=!0;try{await Promise.all([new Promise((t=>{this.initialized||t(),this.subscriber.once(qu.resubscribed,(()=>{t()}))})),await Promise.race([new Promise((async t=>{await this.provider.connect(),this.removeListener(Cu.transport_closed,this.rejectTransportOpen),t()})),new Promise((t=>this.once(Cu.transport_closed,this.rejectTransportOpen)))])])}catch(t){const e=t;if(!/socket hang up/i.test(e.message))throw t;this.logger.error(t),this.events.emit(Cu.transport_closed)}finally{this.reconnecting=!1}}}async restartTransport(t){this.transportExplicitlyClosed||(await this.transportClose(),await new Promise((t=>setTimeout(t,ku))),await this.transportOpen(t))}rejectTransportOpen(){throw new Error("closeTransport called before connection was established")}async createProvider(){const t=await this.core.crypto.signJWT(this.relayUrl);return new mc(new Sc(Js({sdkVersion:Lu,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t})))}async recordMessageEvent(t){const{topic:e,message:i}=t;await this.messages.set(e,i)}async shouldIgnoreMessageEvent(t){const{topic:e,message:i}=t;return await this.subscriber.isSubscribed(e)?this.messages.has(e,i):!0}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),wc(t)){if(!t.method.endsWith($u))return;const e=t.params,{topic:i,message:r,publishedAt:n}=e.data,s={topic:i,message:r,publishedAt:n};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(gf({type:"event",event:e.id},s)),this.events.emit(e.id,s),await this.acknowledgePayload(t),await this.onMessageEvent(s)}}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Cu.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const e=ec(t.id,!0);await this.provider.connection.send(e)}registerEventListeners(){this.provider.on(Du.payload,(t=>this.onProviderPayload(t))),this.provider.on(Du.connect,(()=>{this.events.emit(Cu.connect)})),this.provider.on(Du.disconnect,(()=>{this.events.emit(Cu.disconnect),this.attemptToReconnect()})),this.provider.on(Du.error,(t=>this.events.emit(Cu.error,t))),this.events.on(Cu.connection_stalled,(async()=>{await this.restartTransport()}))}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout((async()=>{await this.transportOpen()}),ke.toMiliseconds(ku))}isInitialized(){if(!this.initialized){const{message:t}=Po("NOT_INITIALIZED",this.name);throw new Error(t)}}}var Of=Object.defineProperty,Sf=Object.getOwnPropertySymbols,If=Object.prototype.hasOwnProperty,jf=Object.prototype.propertyIsEnumerable,Af=(t,e,i)=>e in t?Of(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Nf=(t,e)=>{for(var i in e||(e={}))If.call(e,i)&&Af(t,i,e[i]);if(Sf)for(var i of Sf(e))jf.call(e,i)&&Af(t,i,e[i]);return t};class Pf extends Pi{constructor(t,e,i,r=mu,n=void 0){super(t,e,i,r),this.core=t,this.logger=e,this.name=i,this.map=new Map,this.version=Vu,this.cached=[],this.initialized=!1,this.storagePrefix=mu,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach((t=>{Vo(t)?this.map.set(t.id,t):qo(t)?this.map.set(t.topic,t):this.getKey&&t!==null&&!Uo(t)&&this.map.set(this.getKey(t),t)})),this.cached=[],this.initialized=!0)},this.set=async(t,e)=>{this.isInitialized(),this.map.has(t)?await this.update(t,e):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:t,value:e}),this.map.set(t,e),await this.persist())},this.get=t=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:t}),this.getData(t)),this.getAll=t=>(this.isInitialized(),t?this.values.filter((e=>Object.keys(t).every((i=>Ic(e[i],t[i]))))):this.values),this.update=async(t,e)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:t,update:e});const i=Nf(Nf({},this.getData(t)),e);this.map.set(t,i),await this.persist()},this.delete=async(t,e)=>{this.isInitialized(),this.map.has(t)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:t,reason:e}),this.map.delete(t),await this.persist())},this.logger=Oi.generateChildLogger(e,this.name),this.storagePrefix=r,this.getKey=n}get context(){return Oi.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const e=this.map.get(t);if(!e){const{message:e}=Po("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(e),new Error(e)}return e}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:t}=Po("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=Po("NOT_INITIALIZED",this.name);throw new Error(t)}}}class Mf{constructor(t,e){this.core=t,this.logger=e,this.name=Hu,this.version=Ku,this.events=new D,this.initialized=!1,this.storagePrefix=mu,this.ignoredPayloadTypes=[ls],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:t})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...t])]},this.create=async()=>{this.isInitialized();const t=bs(),e=await this.core.crypto.setSymKey(t),i=so(ke.FIVE_MINUTES),r={protocol:xu},n={topic:e,expiry:i,relay:r,active:!1},s=go({protocol:this.core.protocol,version:this.core.version,topic:e,symKey:t,relay:r});return await this.pairings.set(e,n),await this.core.relayer.subscribe(e),this.core.expirer.set(e,i),{topic:e,uri:s}},this.pair=async t=>{this.isInitialized(),this.isValidPair(t);const{topic:e,symKey:i,relay:r}=mo(t.uri),n=so(ke.FIVE_MINUTES),s={topic:e,relay:r,expiry:n,active:!1};return await this.pairings.set(e,s),await this.core.crypto.setSymKey(i,e),await this.core.relayer.subscribe(e,{relay:r}),this.core.expirer.set(e,n),t.activatePairing&&await this.activate({topic:e}),s},this.activate=async({topic:t})=>{this.isInitialized();const e=so(ke.THIRTY_DAYS);await this.pairings.update(t,{active:!0,expiry:e}),this.core.expirer.set(t,e)},this.ping=async t=>{this.isInitialized(),await this.isValidPing(t);const{topic:e}=t;if(this.pairings.keys.includes(e)){const t=await this.sendRequest(e,"wc_pairingPing",{}),{done:i,resolve:r,reject:n}=Qs();this.events.once(ao("pairing_ping",t),(({error:t})=>{t?n(t):r()})),await i()}},this.updateExpiry=async({topic:t,expiry:e})=>{this.isInitialized(),await this.pairings.update(t,{expiry:e})},this.updateMetadata=async({topic:t,metadata:e})=>{this.isInitialized(),await this.pairings.update(t,{peerMetadata:e})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async t=>{this.isInitialized(),await this.isValidDisconnect(t);const{topic:e}=t;this.pairings.keys.includes(e)&&(await this.sendRequest(e,"wc_pairingDelete",Mo("USER_DISCONNECTED")),await this.deletePairing(e))},this.sendRequest=async(t,e,i)=>{const r=tc(e,i),n=await this.core.crypto.encode(t,r),s=zu[e].req;return this.core.history.set(t,r),await this.core.relayer.publish(t,n,s),r.id},this.sendResult=async(t,e,i)=>{const r=ec(t,i),n=await this.core.crypto.encode(e,r),s=await this.core.history.get(e,t),o=zu[s.request.method].res;await this.core.relayer.publish(e,n,o),await this.core.history.resolve(r)},this.sendError=async(t,e,i)=>{const r=ic(t,i),n=await this.core.crypto.encode(e,r),s=await this.core.history.get(e,t),o=zu[s.request.method]?zu[s.request.method].res:zu.unregistered_method.res;await this.core.relayer.publish(e,n,o),await this.core.history.resolve(r)},this.deletePairing=async(t,e)=>{await this.core.relayer.unsubscribe(t),await Promise.all([this.pairings.delete(t,Mo("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(t),e?Promise.resolve():this.core.expirer.del(t)])},this.cleanup=async()=>{const t=this.pairings.getAll().filter((t=>oo(t.expiry)));await Promise.all(t.map((t=>this.deletePairing(t.topic))))},this.onRelayEventRequest=t=>{const{topic:e,payload:i}=t,r=i.method;if(this.pairings.keys.includes(e))switch(r){case"wc_pairingPing":return this.onPairingPingRequest(e,i);case"wc_pairingDelete":return this.onPairingDeleteRequest(e,i);default:return this.onUnknownRpcMethodRequest(e,i)}},this.onRelayEventResponse=async t=>{const{topic:e,payload:i}=t,r=(await this.core.history.get(e,i.id)).request.method;if(this.pairings.keys.includes(e))switch(r){case"wc_pairingPing":return this.onPairingPingResponse(e,i);default:return this.onUnknownRpcMethodResponse(r)}},this.onPairingPingRequest=async(t,e)=>{const{id:i}=e;try{this.isValidPing({topic:t}),await this.sendResult(i,t,!0),this.events.emit("pairing_ping",{id:i,topic:t})}catch(e){await this.sendError(i,t,e),this.logger.error(e)}},this.onPairingPingResponse=(t,e)=>{const{id:i}=e;setTimeout((()=>{vc(e)?this.events.emit(ao("pairing_ping",i),{}):bc(e)&&this.events.emit(ao("pairing_ping",i),{error:e.error})}),500)},this.onPairingDeleteRequest=async(t,e)=>{const{id:i}=e;try{this.isValidDisconnect({topic:t}),await this.deletePairing(t),this.events.emit("pairing_delete",{id:i,topic:t})}catch(e){await this.sendError(i,t,e),this.logger.error(e)}},this.onUnknownRpcMethodRequest=async(t,e)=>{const{id:i,method:r}=e;try{if(this.registeredMethods.includes(r))return;const e=Mo("WC_METHOD_UNSUPPORTED",r);await this.sendError(i,t,e),this.logger.error(e)}catch(e){await this.sendError(i,t,e),this.logger.error(e)}},this.onUnknownRpcMethodResponse=t=>{this.registeredMethods.includes(t)||this.logger.error(Mo("WC_METHOD_UNSUPPORTED",t))},this.isValidPair=t=>{if(!ea(t)){const{message:e}=Po("MISSING_OR_INVALID",`pair() params: ${t}`);throw new Error(e)}if(!Lo(t.uri)){const{message:e}=Po("MISSING_OR_INVALID",`pair() uri: ${t.uri}`);throw new Error(e)}},this.isValidPing=async t=>{if(!ea(t)){const{message:e}=Po("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(e)}const{topic:e}=t;await this.isValidPairingTopic(e)},this.isValidDisconnect=async t=>{if(!ea(t)){const{message:e}=Po("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(e)}const{topic:e}=t;await this.isValidPairingTopic(e)},this.isValidPairingTopic=async t=>{if(!Ro(t,!1)){const{message:e}=Po("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(e)}if(!this.pairings.keys.includes(t)){const{message:e}=Po("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(e)}if(oo(this.pairings.get(t).expiry)){await this.deletePairing(t);const{message:e}=Po("EXPIRED",`pairing topic: ${t}`);throw new Error(e)}},this.core=t,this.logger=Oi.generateChildLogger(e,this.name),this.pairings=new Pf(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Oi.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=Po("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Cu.message,(async t=>{const{topic:e,message:i}=t;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const r=await this.core.crypto.decode(e,i);wc(r)?(this.core.history.set(e,r),this.onRelayEventRequest({topic:e,payload:r})):yc(r)&&(await this.core.history.resolve(r),this.onRelayEventResponse({topic:e,payload:r}))}))}registerExpirerEvents(){this.core.expirer.on(Zu.expired,(async t=>{const{topic:e}=no(t.target);e&&this.pairings.keys.includes(e)&&(await this.deletePairing(e,!0),this.events.emit("pairing_expire",{topic:e}))}))}}class xf extends Ii{constructor(t,e){super(t,e),this.core=t,this.logger=e,this.records=new Map,this.events=new D.EventEmitter,this.name=Ju,this.version=Xu,this.cached=[],this.initialized=!1,this.storagePrefix=mu,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach((t=>this.records.set(t.id,t))),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(t,e,i)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:t,request:e,chainId:i}),this.records.has(e.id))return;const r={id:e.id,topic:t,request:{method:e.method,params:e.params||null},chainId:i};this.records.set(r.id,r),this.events.emit(Wu.created,r)},this.resolve=async t=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:t}),!this.records.has(t.id))return;const e=await this.getRecord(t.id);typeof e.response>"u"&&(e.response=bc(t)?{error:t.error}:{result:t.result},this.records.set(e.id,e),this.events.emit(Wu.updated,e))},this.get=async(t,e)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:t,id:e}),await this.getRecord(e)),this.delete=(t,e)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:e}),this.values.forEach((i=>{if(i.topic===t){if(typeof e<"u"&&i.id!==e)return;this.records.delete(i.id),this.events.emit(Wu.deleted,i)}}))},this.exists=async(t,e)=>(this.isInitialized(),this.records.has(e)?(await this.getRecord(e)).topic===t:!1),this.on=(t,e)=>{this.events.on(t,e)},this.once=(t,e)=>{this.events.once(t,e)},this.off=(t,e)=>{this.events.off(t,e)},this.removeListener=(t,e)=>{this.events.removeListener(t,e)},this.logger=Oi.generateChildLogger(e,this.name)}get context(){return Oi.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach((e=>{if(typeof e.response<"u")return;const i={topic:e.topic,request:tc(e.request.method,e.request.params,e.id),chainId:e.chainId};return t.push(i)})),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const e=this.records.get(t);if(!e){const{message:e}=Po("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(e)}return e}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Wu.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:t}=Po("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(Wu.created,(t=>{const e=Wu.created;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,record:t}),this.persist()})),this.events.on(Wu.updated,(t=>{const e=Wu.updated;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,record:t}),this.persist()})),this.events.on(Wu.deleted,(t=>{const e=Wu.deleted;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,record:t}),this.persist()}))}isInitialized(){if(!this.initialized){const{message:t}=Po("NOT_INITIALIZED",this.name);throw new Error(t)}}}class Tf extends xi{constructor(t,e){super(t,e),this.core=t,this.logger=e,this.expirations=new Map,this.events=new D.EventEmitter,this.name=Yu,this.version=Qu,this.cached=[],this.initialized=!1,this.storagePrefix=mu,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach((t=>this.expirations.set(t.target,t))),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=t=>{try{const e=this.formatTarget(t);return typeof this.getExpiration(e)<"u"}catch{return!1}},this.set=(t,e)=>{this.isInitialized();const i=this.formatTarget(t),r={target:i,expiry:e};this.expirations.set(i,r),this.checkExpiry(i,r),this.events.emit(Zu.created,{target:i,expiration:r})},this.get=t=>{this.isInitialized();const e=this.formatTarget(t);return this.getExpiration(e)},this.del=t=>{if(this.isInitialized(),this.has(t)){const e=this.formatTarget(t),i=this.getExpiration(e);this.expirations.delete(e),this.events.emit(Zu.deleted,{target:e,expiration:i})}},this.on=(t,e)=>{this.events.on(t,e)},this.once=(t,e)=>{this.events.once(t,e)},this.off=(t,e)=>{this.events.off(t,e)},this.removeListener=(t,e)=>{this.events.removeListener(t,e)},this.logger=Oi.generateChildLogger(e,this.name)}get context(){return Oi.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return io(t);if(typeof t=="number")return ro(t);const{message:e}=Po("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(e)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Zu.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:t}=Po("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const e=this.expirations.get(t);if(!e){const{message:e}=Po("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(e),new Error(e)}return e}checkExpiry(t,e){const{expiry:i}=e;ke.toMiliseconds(i)-Date.now()<=0&&this.expire(t,e)}expire(t,e){this.expirations.delete(t),this.events.emit(Zu.expired,{target:t,expiration:e})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach(((t,e)=>this.checkExpiry(e,t)))}registerEventListeners(){this.core.heartbeat.on(We.HEARTBEAT_EVENTS.pulse,(()=>this.checkExpirations())),this.events.on(Zu.created,(t=>{const e=Zu.created;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,data:t}),this.persist()})),this.events.on(Zu.expired,(t=>{const e=Zu.expired;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,data:t}),this.persist()})),this.events.on(Zu.deleted,(t=>{const e=Zu.deleted;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,data:t}),this.persist()}))}isInitialized(){if(!this.initialized){const{message:t}=Po("NOT_INITIALIZED",this.name);throw new Error(t)}}}var Uf=Object.defineProperty,Rf=Object.getOwnPropertySymbols,Cf=Object.prototype.hasOwnProperty,$f=Object.prototype.propertyIsEnumerable,Df=(t,e,i)=>e in t?Uf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,kf=(t,e)=>{for(var i in e||(e={}))Cf.call(e,i)&&Df(t,i,e[i]);if(Rf)for(var i of Rf(e))$f.call(e,i)&&Df(t,i,e[i]);return t};class Lf extends Si{constructor(t){super(t),this.protocol=yu,this.version=vu,this.name=bu,this.events=new D.EventEmitter,this.initialized=!1,this.on=(t,e)=>this.events.on(t,e),this.once=(t,e)=>this.events.once(t,e),this.off=(t,e)=>this.events.off(t,e),this.removeListener=(t,e)=>this.events.removeListener(t,e),this.projectId=t?.projectId,this.relayUrl=t?.relayUrl||Uu;const e=typeof t?.logger<"u"&&typeof t?.logger!="string"?t.logger:h(Oi.getDefaultLoggerOptions({level:t?.logger||_u.logger}));this.logger=Oi.generateChildLogger(e,this.name),this.heartbeat=new We.HeartBeat,this.crypto=new ef(this,this.logger,t?.keychain),this.history=new xf(this,this.logger),this.expirer=new Tf(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new xt(kf(kf({},gu),t?.storageOptions)),this.relayer=new Ef({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Mf(this,this.logger)}static async init(t){const e=new Lf(t);return await e.initialize(),e}get context(){return Oi.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const Vf=Lf;const qf="wc",Ff=2,Gf="client",Bf=`${qf}@${Ff}:${Gf}:`,Hf={name:Gf,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Kf="proposal",zf="Proposal expired",Wf="session",Jf=ke.SEVEN_DAYS,Xf="engine",Yf={wc_sessionPropose:{req:{ttl:ke.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ke.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ke.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ke.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ke.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ke.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ke.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ke.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ke.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ke.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ke.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ke.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ke.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ke.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ke.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ke.THIRTY_SECONDS,prompt:!1,tag:1115}}},Zf={min:ke.FIVE_MINUTES,max:ke.SEVEN_DAYS},Qf="request";var tl=Object.defineProperty,el=Object.defineProperties,il=Object.getOwnPropertyDescriptors,rl=Object.getOwnPropertySymbols,nl=Object.prototype.hasOwnProperty,sl=Object.prototype.propertyIsEnumerable,ol=(t,e,i)=>e in t?tl(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,al=(t,e)=>{for(var i in e||(e={}))nl.call(e,i)&&ol(t,i,e[i]);if(rl)for(var i of rl(e))sl.call(e,i)&&ol(t,i,e[i]);return t},cl=(t,e)=>el(t,il(e));class hl extends Ui{constructor(t){super(t),this.name=Xf,this.events=new D,this.initialized=!1,this.ignoredPayloadTypes=[ls],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(Yf)}),this.initialized=!0)},this.connect=async t=>{this.isInitialized();const e=cl(al({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(e);const{pairingTopic:i,requiredNamespaces:r,optionalNamespaces:n,sessionProperties:s,relays:o}=e;let a=i,c,h=!1;if(a&&(h=this.client.core.pairing.pairings.get(a).active),!a||!h){const{topic:t,uri:e}=await this.client.core.pairing.create();a=t,c=e}const u=await this.client.core.crypto.generateKeyPair(),f=al({requiredNamespaces:r,optionalNamespaces:n,relays:o??[{protocol:xu}],proposer:{publicKey:u,metadata:this.client.metadata}},s&&{sessionProperties:s}),{reject:l,resolve:d,done:p}=Qs(ke.FIVE_MINUTES,zf);if(this.events.once(ao("session_connect"),(async({error:t,session:e})=>{if(t)l(t);else if(e){e.self.publicKey=u;const t=cl(al({},e),{requiredNamespaces:e.requiredNamespaces,optionalNamespaces:e.optionalNamespaces});await this.client.session.set(e.topic,t),await this.setExpiry(e.topic,e.expiry),a&&await this.client.core.pairing.updateMetadata({topic:a,metadata:e.peer.metadata}),d(t)}})),!a){const{message:t}=Po("NO_MATCHING_KEY",`connect() pairing topic: ${a}`);throw new Error(t)}const w=await this.sendRequest(a,"wc_sessionPropose",f),y=so(ke.FIVE_MINUTES);return await this.setProposal(w,al({id:w,expiry:y},f)),{uri:c,approval:p}},this.pair=async t=>(this.isInitialized(),await this.client.core.pairing.pair(t)),this.approve=async t=>{this.isInitialized(),await this.isValidApprove(t);const{id:e,relayProtocol:i,namespaces:r,sessionProperties:n}=t,s=this.client.proposal.get(e);let{pairingTopic:o,proposer:a,requiredNamespaces:c,optionalNamespaces:h}=s;To(c)||(c=jo(r,"approve()"));const u=await this.client.core.crypto.generateKeyPair(),f=a.publicKey,l=await this.client.core.crypto.generateSharedKey(u,f);o&&e&&(await this.client.core.pairing.updateMetadata({topic:o,metadata:a.metadata}),await this.sendResult(e,o,{relay:{protocol:i??"irn"},responderPublicKey:u}),await this.client.proposal.delete(e,Mo("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:o}));const d=al({relay:{protocol:i??"irn"},namespaces:r,requiredNamespaces:c,optionalNamespaces:h,controller:{publicKey:u,metadata:this.client.metadata},expiry:so(Jf)},n&&{sessionProperties:n});await this.client.core.relayer.subscribe(l);const p=await this.sendRequest(l,"wc_sessionSettle",d),{done:w,resolve:y,reject:v}=Qs();this.events.once(ao("session_approve",p),(({error:t})=>{t?v(t):y(this.client.session.get(l))}));const b=cl(al({},d),{topic:l,acknowledged:!1,self:d.controller,peer:{publicKey:a.publicKey,metadata:a.metadata},controller:u});return await this.client.session.set(l,b),await this.setExpiry(l,so(Jf)),{topic:l,acknowledged:w}},this.reject=async t=>{this.isInitialized(),await this.isValidReject(t);const{id:e,reason:i}=t,{pairingTopic:r}=this.client.proposal.get(e);r&&(await this.sendError(e,r,i),await this.client.proposal.delete(e,Mo("USER_DISCONNECTED")))},this.update=async t=>{this.isInitialized(),await this.isValidUpdate(t);const{topic:e,namespaces:i}=t,r=await this.sendRequest(e,"wc_sessionUpdate",{namespaces:i}),{done:n,resolve:s,reject:o}=Qs();return this.events.once(ao("session_update",r),(({error:t})=>{t?o(t):s()})),await this.client.session.update(e,{namespaces:i}),{acknowledged:n}},this.extend=async t=>{this.isInitialized(),await this.isValidExtend(t);const{topic:e}=t,i=await this.sendRequest(e,"wc_sessionExtend",{}),{done:r,resolve:n,reject:s}=Qs();return this.events.once(ao("session_extend",i),(({error:t})=>{t?s(t):n()})),await this.setExpiry(e,so(Jf)),{acknowledged:r}},this.request=async t=>{this.isInitialized(),await this.isValidRequest(t);const{chainId:e,request:i,topic:r,expiry:n}=t,s=await this.sendRequest(r,"wc_sessionRequest",{request:i,chainId:e},n),{done:o,resolve:a,reject:c}=Qs(n);return this.events.once(ao("session_request",s),(({error:t,result:e})=>{t?c(t):a(e)})),this.client.events.emit("session_request_sent",{topic:r,request:i,chainId:e}),await o()},this.respond=async t=>{this.isInitialized(),await this.isValidRespond(t);const{topic:e,response:i}=t,{id:r}=i;vc(i)?await this.sendResult(r,e,i.result):bc(i)&&await this.sendError(r,e,i.error),this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0})},this.ping=async t=>{this.isInitialized(),await this.isValidPing(t);const{topic:e}=t;if(this.client.session.keys.includes(e)){const t=await this.sendRequest(e,"wc_sessionPing",{}),{done:i,resolve:r,reject:n}=Qs();this.events.once(ao("session_ping",t),(({error:t})=>{t?n(t):r()})),await i()}else this.client.core.pairing.pairings.keys.includes(e)&&await this.client.core.pairing.ping({topic:e})},this.emit=async t=>{this.isInitialized(),await this.isValidEmit(t);const{topic:e,event:i,chainId:r}=t;await this.sendRequest(e,"wc_sessionEvent",{event:i,chainId:r})},this.disconnect=async t=>{this.isInitialized(),await this.isValidDisconnect(t);const{topic:e}=t;this.client.session.keys.includes(e)?(await this.sendRequest(e,"wc_sessionDelete",Mo("USER_DISCONNECTED")),await this.deleteSession(e)):await this.client.core.pairing.disconnect({topic:e})},this.find=t=>(this.isInitialized(),this.client.session.getAll().filter((e=>$o(e,t)))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.deleteSession=async(t,e)=>{const{self:i}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),await Promise.all([this.client.session.delete(t,Mo("USER_DISCONNECTED")),this.client.core.crypto.deleteKeyPair(i.publicKey),this.client.core.crypto.deleteSymKey(t),e?Promise.resolve():this.client.core.expirer.del(t)])},this.deleteProposal=async(t,e)=>{await Promise.all([this.client.proposal.delete(t,Mo("USER_DISCONNECTED")),e?Promise.resolve():this.client.core.expirer.del(t)])},this.deletePendingSessionRequest=async(t,e,i=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,e),i?Promise.resolve():this.client.core.expirer.del(t)])},this.setExpiry=async(t,e)=>{this.client.session.keys.includes(t)&&await this.client.session.update(t,{expiry:e}),this.client.core.expirer.set(t,e)},this.setProposal=async(t,e)=>{await this.client.proposal.set(t,e),this.client.core.expirer.set(t,e.expiry)},this.setPendingSessionRequest=async t=>{const e=Yf.wc_sessionRequest.req.ttl,{id:i,topic:r,params:n}=t;await this.client.pendingRequest.set(i,{id:i,topic:r,params:n}),e&&this.client.core.expirer.set(i,so(e))},this.sendRequest=async(t,e,i,r)=>{const n=tc(e,i),s=await this.client.core.crypto.encode(t,n),o=Yf[e].req;return r&&(o.ttl=r),this.client.core.history.set(t,n),this.client.core.relayer.publish(t,s,o),n.id},this.sendResult=async(t,e,i)=>{const r=ec(t,i),n=await this.client.core.crypto.encode(e,r),s=await this.client.core.history.get(e,t),o=Yf[s.request.method].res;this.client.core.relayer.publish(e,n,o),await this.client.core.history.resolve(r)},this.sendError=async(t,e,i)=>{const r=ic(t,i),n=await this.client.core.crypto.encode(e,r),s=await this.client.core.history.get(e,t),o=Yf[s.request.method].res;this.client.core.relayer.publish(e,n,o),await this.client.core.history.resolve(r)},this.cleanup=async()=>{const t=[],e=[];this.client.session.getAll().forEach((e=>{oo(e.expiry)&&t.push(e.topic)})),this.client.proposal.getAll().forEach((t=>{oo(t.expiry)&&e.push(t.id)})),await Promise.all([...t.map((t=>this.deleteSession(t))),...e.map((t=>this.deleteProposal(t)))])},this.onRelayEventRequest=t=>{const{topic:e,payload:i}=t,r=i.method;switch(r){case"wc_sessionPropose":return this.onSessionProposeRequest(e,i);case"wc_sessionSettle":return this.onSessionSettleRequest(e,i);case"wc_sessionUpdate":return this.onSessionUpdateRequest(e,i);case"wc_sessionExtend":return this.onSessionExtendRequest(e,i);case"wc_sessionPing":return this.onSessionPingRequest(e,i);case"wc_sessionDelete":return this.onSessionDeleteRequest(e,i);case"wc_sessionRequest":return this.onSessionRequest(e,i);case"wc_sessionEvent":return this.onSessionEventRequest(e,i);default:return this.client.logger.info(`Unsupported request method ${r}`)}},this.onRelayEventResponse=async t=>{const{topic:e,payload:i}=t,r=(await this.client.core.history.get(e,i.id)).request.method;switch(r){case"wc_sessionPropose":return this.onSessionProposeResponse(e,i);case"wc_sessionSettle":return this.onSessionSettleResponse(e,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(e,i);case"wc_sessionExtend":return this.onSessionExtendResponse(e,i);case"wc_sessionPing":return this.onSessionPingResponse(e,i);case"wc_sessionRequest":return this.onSessionRequestResponse(e,i);default:return this.client.logger.info(`Unsupported response method ${r}`)}},this.onSessionProposeRequest=async(t,e)=>{const{params:i,id:r}=e;try{this.isValidConnect(al({},e.params));const n=so(ke.FIVE_MINUTES),s=al({id:r,pairingTopic:t,expiry:n},i);await this.setProposal(r,s),this.client.events.emit("session_proposal",{id:r,params:s})}catch(e){await this.sendError(r,t,e),this.client.logger.error(e)}},this.onSessionProposeResponse=async(t,e)=>{const{id:i}=e;if(vc(e)){const{result:r}=e;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:r});const n=this.client.proposal.get(i);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:n});const s=n.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:s});const o=r.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:o});const a=await this.client.core.crypto.generateSharedKey(s,o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:a});const c=await this.client.core.relayer.subscribe(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:c}),await this.client.core.pairing.activate({topic:t})}else bc(e)&&(await this.client.proposal.delete(i,Mo("USER_DISCONNECTED")),this.events.emit(ao("session_connect"),{error:e.error}))},this.onSessionSettleRequest=async(t,e)=>{const{id:i,params:r}=e;try{this.isValidSessionSettleRequest(r);const{relay:i,controller:n,expiry:s,namespaces:o,requiredNamespaces:a,optionalNamespaces:c,sessionProperties:h}=e.params,u=al({topic:t,relay:i,expiry:s,namespaces:o,acknowledged:!0,requiredNamespaces:a,optionalNamespaces:c,controller:n.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:n.publicKey,metadata:n.metadata}},h&&{sessionProperties:h});await this.sendResult(e.id,t,!0),this.events.emit(ao("session_connect"),{session:u})}catch(e){await this.sendError(i,t,e),this.client.logger.error(e)}},this.onSessionSettleResponse=async(t,e)=>{const{id:i}=e;vc(e)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(ao("session_approve",i),{})):bc(e)&&(await this.client.session.delete(t,Mo("USER_DISCONNECTED")),this.events.emit(ao("session_approve",i),{error:e.error}))},this.onSessionUpdateRequest=async(t,e)=>{const{params:i,id:r}=e;try{this.isValidUpdate(al({topic:t},i)),await this.client.session.update(t,{namespaces:i.namespaces}),await this.sendResult(r,t,!0),this.client.events.emit("session_update",{id:r,topic:t,params:i})}catch(e){await this.sendError(r,t,e),this.client.logger.error(e)}},this.onSessionUpdateResponse=(t,e)=>{const{id:i}=e;vc(e)?this.events.emit(ao("session_update",i),{}):bc(e)&&this.events.emit(ao("session_update",i),{error:e.error})},this.onSessionExtendRequest=async(t,e)=>{const{id:i}=e;try{this.isValidExtend({topic:t}),await this.setExpiry(t,so(Jf)),await this.sendResult(i,t,!0),this.client.events.emit("session_extend",{id:i,topic:t})}catch(e){await this.sendError(i,t,e),this.client.logger.error(e)}},this.onSessionExtendResponse=(t,e)=>{const{id:i}=e;vc(e)?this.events.emit(ao("session_extend",i),{}):bc(e)&&this.events.emit(ao("session_extend",i),{error:e.error})},this.onSessionPingRequest=async(t,e)=>{const{id:i}=e;try{this.isValidPing({topic:t}),await this.sendResult(i,t,!0),this.client.events.emit("session_ping",{id:i,topic:t})}catch(e){await this.sendError(i,t,e),this.client.logger.error(e)}},this.onSessionPingResponse=(t,e)=>{const{id:i}=e;setTimeout((()=>{vc(e)?this.events.emit(ao("session_ping",i),{}):bc(e)&&this.events.emit(ao("session_ping",i),{error:e.error})}),500)},this.onSessionDeleteRequest=async(t,e)=>{const{id:i}=e;try{this.isValidDisconnect({topic:t,reason:e.params}),this.client.core.relayer.once(Cu.publish,(async()=>{await this.deleteSession(t)})),await this.sendResult(i,t,!0),this.client.events.emit("session_delete",{id:i,topic:t})}catch(e){await this.sendError(i,t,e),this.client.logger.error(e)}},this.onSessionRequest=async(t,e)=>{const{id:i,params:r}=e;try{this.isValidRequest(al({topic:t},r)),await this.setPendingSessionRequest({id:i,topic:t,params:r}),this.client.events.emit("session_request",{id:i,topic:t,params:r})}catch(e){await this.sendError(i,t,e),this.client.logger.error(e)}},this.onSessionRequestResponse=(t,e)=>{const{id:i}=e;vc(e)?this.events.emit(ao("session_request",i),{result:e.result}):bc(e)&&this.events.emit(ao("session_request",i),{error:e.error})},this.onSessionEventRequest=async(t,e)=>{const{id:i,params:r}=e;try{this.isValidEmit(al({topic:t},r)),this.client.events.emit("session_event",{id:i,topic:t,params:r})}catch(e){await this.sendError(i,t,e),this.client.logger.error(e)}},this.isValidConnect=async t=>{if(!ea(t)){const{message:e}=Po("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(e)}const{pairingTopic:e,requiredNamespaces:i,optionalNamespaces:r,sessionProperties:n,relays:s}=t;if(Uo(e)||await this.isValidPairingTopic(e),!Qo(s,!0)){const{message:t}=Po("MISSING_OR_INVALID",`connect() relays: ${s}`);throw new Error(t)}!Uo(i)&&To(i)!==0&&this.validateNamespaces(i,"requiredNamespaces"),!Uo(r)&&To(r)!==0&&this.validateNamespaces(r,"optionalNamespaces"),Uo(n)||this.validateSessionProps(n,"sessionProperties")},this.validateNamespaces=(t,e)=>{const i=Xo(t,"connect()",e);if(i)throw new Error(i.message)},this.isValidApprove=async t=>{if(!ea(t))throw new Error(Po("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:e,namespaces:i,relayProtocol:r,sessionProperties:n}=t;await this.isValidProposalId(e);const s=this.client.proposal.get(e),o=Yo(i,"approve()");if(o)throw new Error(o.message);const a=ha(s.requiredNamespaces,i,"approve()","requiredNamespaces");if(a)throw new Error(a.message);if(!Ro(r,!0)){const{message:t}=Po("MISSING_OR_INVALID",`approve() relayProtocol: ${r}`);throw new Error(t)}if(Object.keys(i).length>Object.keys(s.requiredNamespaces).length){const t=Object.keys(s.optionalNamespaces).filter((t=>i[t])),e={};for(const i in s.optionalNamespaces)t.includes(i)&&(e[i]=s.optionalNamespaces[i]);const r=ha(e,i,"approve()","optionalNamespaces");if(r)throw new Error(r.message)}Uo(n)||this.validateSessionProps(n,"sessionProperties")},this.isValidReject=async t=>{if(!ea(t)){const{message:e}=Po("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(e)}const{id:e,reason:i}=t;if(await this.isValidProposalId(e),!ia(i)){const{message:t}=Po("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(i)}`);throw new Error(t)}},this.isValidSessionSettleRequest=t=>{if(!ea(t)){const{message:e}=Po("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(e)}const{relay:e,controller:i,namespaces:r,expiry:n}=t;if(!Zo(e)){const{message:t}=Po("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(t)}const s=Fo(i,"onSessionSettleRequest()");if(s)throw new Error(s.message);const o=Yo(r,"onSessionSettleRequest()");if(o)throw new Error(o.message);if(oo(n)){const{message:t}=Po("EXPIRED","onSessionSettleRequest()");throw new Error(t)}},this.isValidUpdate=async t=>{if(!ea(t)){const{message:e}=Po("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(e)}const{topic:e,namespaces:i}=t;await this.isValidSessionTopic(e);const r=this.client.session.get(e),n=Yo(i,"update()");if(n)throw new Error(n.message);const s=ha(r.requiredNamespaces,i,"update()","requiredNamespaces");if(s)throw new Error(s.message)},this.isValidExtend=async t=>{if(!ea(t)){const{message:e}=Po("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(e)}const{topic:e}=t;await this.isValidSessionTopic(e)},this.isValidRequest=async t=>{if(!ea(t)){const{message:e}=Po("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(e)}const{topic:e,request:i,chainId:r,expiry:n}=t;await this.isValidSessionTopic(e);const{namespaces:s}=this.client.session.get(e);if(!oa(s,r)){const{message:t}=Po("MISSING_OR_INVALID",`request() chainId: ${r}`);throw new Error(t)}if(!ra(i)){const{message:t}=Po("MISSING_OR_INVALID",`request() ${JSON.stringify(i)}`);throw new Error(t)}if(!aa(s,r,i.method)){const{message:t}=Po("MISSING_OR_INVALID",`request() method: ${i.method}`);throw new Error(t)}if(n&&!ua(n,Zf)){const{message:t}=Po("MISSING_OR_INVALID",`request() expiry: ${n}. Expiry must be a number (in seconds) between ${Zf.min} and ${Zf.max}`);throw new Error(t)}},this.isValidRespond=async t=>{if(!ea(t)){const{message:e}=Po("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(e)}const{topic:e,response:i}=t;if(await this.isValidSessionTopic(e),!na(i)){const{message:t}=Po("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(i)}`);throw new Error(t)}},this.isValidPing=async t=>{if(!ea(t)){const{message:e}=Po("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(e)}const{topic:e}=t;await this.isValidSessionOrPairingTopic(e)},this.isValidEmit=async t=>{if(!ea(t)){const{message:e}=Po("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(e)}const{topic:e,event:i,chainId:r}=t;await this.isValidSessionTopic(e);const{namespaces:n}=this.client.session.get(e);if(!oa(n,r)){const{message:t}=Po("MISSING_OR_INVALID",`emit() chainId: ${r}`);throw new Error(t)}if(!sa(i)){const{message:t}=Po("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(t)}if(!ca(n,r,i.name)){const{message:t}=Po("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(t)}},this.isValidDisconnect=async t=>{if(!ea(t)){const{message:e}=Po("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(e)}const{topic:e}=t;await this.isValidSessionOrPairingTopic(e)},this.validateSessionProps=(t,e)=>{Object.values(t).forEach((t=>{if(!Ro(t,!1)){const{message:i}=Po("MISSING_OR_INVALID",`${e} must be in Record<string, string> format. Received: ${JSON.stringify(t)}`);throw new Error(i)}}))}}isInitialized(){if(!this.initialized){const{message:t}=Po("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.client.core.relayer.on(Cu.message,(async t=>{const{topic:e,message:i}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const r=await this.client.core.crypto.decode(e,i);wc(r)?(this.client.core.history.set(e,r),this.onRelayEventRequest({topic:e,payload:r})):yc(r)&&(await this.client.core.history.resolve(r),this.onRelayEventResponse({topic:e,payload:r}))}))}registerExpirerEvents(){this.client.core.expirer.on(Zu.expired,(async t=>{const{topic:e,id:i}=no(t.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,Po("EXPIRED"),!0);e?this.client.session.keys.includes(e)&&(await this.deleteSession(e,!0),this.client.events.emit("session_expire",{topic:e})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))}))}isValidPairingTopic(t){if(!Ro(t,!1)){const{message:e}=Po("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(e)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:e}=Po("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(e)}if(oo(this.client.core.pairing.pairings.get(t).expiry)){const{message:e}=Po("EXPIRED",`pairing topic: ${t}`);throw new Error(e)}}async isValidSessionTopic(t){if(!Ro(t,!1)){const{message:e}=Po("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(e)}if(!this.client.session.keys.includes(t)){const{message:e}=Po("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(e)}if(oo(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:e}=Po("EXPIRED",`session topic: ${t}`);throw new Error(e)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(Ro(t,!1)){const{message:e}=Po("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(e)}else{const{message:e}=Po("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(e)}}async isValidProposalId(t){if(!ta(t)){const{message:e}=Po("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(e)}if(!this.client.proposal.keys.includes(t)){const{message:e}=Po("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(e)}if(oo(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:e}=Po("EXPIRED",`proposal id: ${t}`);throw new Error(e)}}}class ul extends Pf{constructor(t,e){super(t,e,Kf,Bf),this.core=t,this.logger=e}}class fl extends Pf{constructor(t,e){super(t,e,Wf,Bf),this.core=t,this.logger=e}}class ll extends Pf{constructor(t,e){super(t,e,Qf,Bf),this.core=t,this.logger=e}}class dl extends Ti{constructor(t){super(t),this.protocol=qf,this.version=Ff,this.name=Hf.name,this.events=new D.EventEmitter,this.on=(t,e)=>this.events.on(t,e),this.once=(t,e)=>this.events.once(t,e),this.off=(t,e)=>this.events.off(t,e),this.removeListener=(t,e)=>this.events.removeListener(t,e),this.removeAllListeners=t=>this.events.removeAllListeners(t),this.connect=async t=>{try{return await this.engine.connect(t)}catch(t){throw this.logger.error(t.message),t}},this.pair=async t=>{try{return await this.engine.pair(t)}catch(t){throw this.logger.error(t.message),t}},this.approve=async t=>{try{return await this.engine.approve(t)}catch(t){throw this.logger.error(t.message),t}},this.reject=async t=>{try{return await this.engine.reject(t)}catch(t){throw this.logger.error(t.message),t}},this.update=async t=>{try{return await this.engine.update(t)}catch(t){throw this.logger.error(t.message),t}},this.extend=async t=>{try{return await this.engine.extend(t)}catch(t){throw this.logger.error(t.message),t}},this.request=async t=>{try{return await this.engine.request(t)}catch(t){throw this.logger.error(t.message),t}},this.respond=async t=>{try{return await this.engine.respond(t)}catch(t){throw this.logger.error(t.message),t}},this.ping=async t=>{try{return await this.engine.ping(t)}catch(t){throw this.logger.error(t.message),t}},this.emit=async t=>{try{return await this.engine.emit(t)}catch(t){throw this.logger.error(t.message),t}},this.disconnect=async t=>{try{return await this.engine.disconnect(t)}catch(t){throw this.logger.error(t.message),t}},this.find=t=>{try{return this.engine.find(t)}catch(t){throw this.logger.error(t.message),t}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(t){throw this.logger.error(t.message),t}},this.name=t?.name||Hf.name,this.metadata=t?.metadata||Hs();const e=typeof t?.logger<"u"&&typeof t?.logger!="string"?t.logger:h(Oi.getDefaultLoggerOptions({level:t?.logger||Hf.logger}));this.core=t?.core||new Vf(t),this.logger=Oi.generateChildLogger(e,this.name),this.session=new fl(this.core,this.logger),this.proposal=new ul(this.core,this.logger),this.pendingRequest=new ll(this.core,this.logger),this.engine=new hl(this)}static async init(t){const e=new dl(t);return await e.initialize(),e}get context(){return Oi.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}}var pl=t((function(t,i){var r=typeof self!=="undefined"?self:e;var n=function(){function t(){this.fetch=false;this.DOMException=r.DOMException}t.prototype=r;return new t}();(function(t){(function(e){var i={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{new Blob;return true}catch(t){return false}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};function r(t){return t&&DataView.prototype.isPrototypeOf(t)}if(i.arrayBuffer){var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"];var s=ArrayBuffer.isView||function(t){return t&&n.indexOf(Object.prototype.toString.call(t))>-1}}function o(t){if(typeof t!=="string"){t=String(t)}if(/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(t)){throw new TypeError("Invalid character in header field name")}return t.toLowerCase()}function a(t){if(typeof t!=="string"){t=String(t)}return t}function c(t){var e={next:function(){var e=t.shift();return{done:e===undefined,value:e}}};if(i.iterable){e[Symbol.iterator]=function(){return e}}return e}function h(t){this.map={};if(t instanceof h){t.forEach((function(t,e){this.append(e,t)}),this)}else if(Array.isArray(t)){t.forEach((function(t){this.append(t[0],t[1])}),this)}else if(t){Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}}h.prototype.append=function(t,e){t=o(t);e=a(e);var i=this.map[t];this.map[t]=i?i+", "+e:e};h.prototype["delete"]=function(t){delete this.map[o(t)]};h.prototype.get=function(t){t=o(t);return this.has(t)?this.map[t]:null};h.prototype.has=function(t){return this.map.hasOwnProperty(o(t))};h.prototype.set=function(t,e){this.map[o(t)]=a(e)};h.prototype.forEach=function(t,e){for(var i in this.map){if(this.map.hasOwnProperty(i)){t.call(e,this.map[i],i,this)}}};h.prototype.keys=function(){var t=[];this.forEach((function(e,i){t.push(i)}));return c(t)};h.prototype.values=function(){var t=[];this.forEach((function(e){t.push(e)}));return c(t)};h.prototype.entries=function(){var t=[];this.forEach((function(e,i){t.push([i,e])}));return c(t)};if(i.iterable){h.prototype[Symbol.iterator]=h.prototype.entries}function u(t){if(t.bodyUsed){return Promise.reject(new TypeError("Already read"))}t.bodyUsed=true}function f(t){return new Promise((function(e,i){t.onload=function(){e(t.result)};t.onerror=function(){i(t.error)}}))}function l(t){var e=new FileReader;var i=f(e);e.readAsArrayBuffer(t);return i}function d(t){var e=new FileReader;var i=f(e);e.readAsText(t);return i}function p(t){var e=new Uint8Array(t);var i=new Array(e.length);for(var r=0;r<e.length;r++){i[r]=String.fromCharCode(e[r])}return i.join("")}function w(t){if(t.slice){return t.slice(0)}else{var e=new Uint8Array(t.byteLength);e.set(new Uint8Array(t));return e.buffer}}function y(){this.bodyUsed=false;this._initBody=function(t){this._bodyInit=t;if(!t){this._bodyText=""}else if(typeof t==="string"){this._bodyText=t}else if(i.blob&&Blob.prototype.isPrototypeOf(t)){this._bodyBlob=t}else if(i.formData&&FormData.prototype.isPrototypeOf(t)){this._bodyFormData=t}else if(i.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)){this._bodyText=t.toString()}else if(i.arrayBuffer&&i.blob&&r(t)){this._bodyArrayBuffer=w(t.buffer);this._bodyInit=new Blob([this._bodyArrayBuffer])}else if(i.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(t)||s(t))){this._bodyArrayBuffer=w(t)}else{this._bodyText=t=Object.prototype.toString.call(t)}if(!this.headers.get("content-type")){if(typeof t==="string"){this.headers.set("content-type","text/plain;charset=UTF-8")}else if(this._bodyBlob&&this._bodyBlob.type){this.headers.set("content-type",this._bodyBlob.type)}else if(i.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)){this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8")}}};if(i.blob){this.blob=function(){var t=u(this);if(t){return t}if(this._bodyBlob){return Promise.resolve(this._bodyBlob)}else if(this._bodyArrayBuffer){return Promise.resolve(new Blob([this._bodyArrayBuffer]))}else if(this._bodyFormData){throw new Error("could not read FormData body as blob")}else{return Promise.resolve(new Blob([this._bodyText]))}};this.arrayBuffer=function(){if(this._bodyArrayBuffer){return u(this)||Promise.resolve(this._bodyArrayBuffer)}else{return this.blob().then(l)}}}this.text=function(){var t=u(this);if(t){return t}if(this._bodyBlob){return d(this._bodyBlob)}else if(this._bodyArrayBuffer){return Promise.resolve(p(this._bodyArrayBuffer))}else if(this._bodyFormData){throw new Error("could not read FormData body as text")}else{return Promise.resolve(this._bodyText)}};if(i.formData){this.formData=function(){return this.text().then(_)}}this.json=function(){return this.text().then(JSON.parse)};return this}var v=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function b(t){var e=t.toUpperCase();return v.indexOf(e)>-1?e:t}function m(t,e){e=e||{};var i=e.body;if(t instanceof m){if(t.bodyUsed){throw new TypeError("Already read")}this.url=t.url;this.credentials=t.credentials;if(!e.headers){this.headers=new h(t.headers)}this.method=t.method;this.mode=t.mode;this.signal=t.signal;if(!i&&t._bodyInit!=null){i=t._bodyInit;t.bodyUsed=true}}else{this.url=String(t)}this.credentials=e.credentials||this.credentials||"same-origin";if(e.headers||!this.headers){this.headers=new h(e.headers)}this.method=b(e.method||this.method||"GET");this.mode=e.mode||this.mode||null;this.signal=e.signal||this.signal;this.referrer=null;if((this.method==="GET"||this.method==="HEAD")&&i){throw new TypeError("Body not allowed for GET or HEAD requests")}this._initBody(i)}m.prototype.clone=function(){return new m(this,{body:this._bodyInit})};function _(t){var e=new FormData;t.trim().split("&").forEach((function(t){if(t){var i=t.split("=");var r=i.shift().replace(/\+/g," ");var n=i.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(n))}}));return e}function g(t){var e=new h;var i=t.replace(/\r?\n[\t ]+/g," ");i.split(/\r?\n/).forEach((function(t){var i=t.split(":");var r=i.shift().trim();if(r){var n=i.join(":").trim();e.append(r,n)}}));return e}y.call(m.prototype);function E(t,e){if(!e){e={}}this.type="default";this.status=e.status===undefined?200:e.status;this.ok=this.status>=200&&this.status<300;this.statusText="statusText"in e?e.statusText:"OK";this.headers=new h(e.headers);this.url=e.url||"";this._initBody(t)}y.call(E.prototype);E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})};E.error=function(){var t=new E(null,{status:0,statusText:""});t.type="error";return t};var O=[301,302,303,307,308];E.redirect=function(t,e){if(O.indexOf(e)===-1){throw new RangeError("Invalid status code")}return new E(null,{status:e,headers:{location:t}})};e.DOMException=t.DOMException;try{new e.DOMException}catch(t){e.DOMException=function(t,e){this.message=t;this.name=e;var i=Error(t);this.stack=i.stack};e.DOMException.prototype=Object.create(Error.prototype);e.DOMException.prototype.constructor=e.DOMException}function S(t,r){return new Promise((function(n,s){var o=new m(t,r);if(o.signal&&o.signal.aborted){return s(new e.DOMException("Aborted","AbortError"))}var a=new XMLHttpRequest;function c(){a.abort()}a.onload=function(){var t={status:a.status,statusText:a.statusText,headers:g(a.getAllResponseHeaders()||"")};t.url="responseURL"in a?a.responseURL:t.headers.get("X-Request-URL");var e="response"in a?a.response:a.responseText;n(new E(e,t))};a.onerror=function(){s(new TypeError("Network request failed"))};a.ontimeout=function(){s(new TypeError("Network request failed"))};a.onabort=function(){s(new e.DOMException("Aborted","AbortError"))};a.open(o.method,o.url,true);if(o.credentials==="include"){a.withCredentials=true}else if(o.credentials==="omit"){a.withCredentials=false}if("responseType"in a&&i.blob){a.responseType="blob"}o.headers.forEach((function(t,e){a.setRequestHeader(e,t)}));if(o.signal){o.signal.addEventListener("abort",c);a.onreadystatechange=function(){if(a.readyState===4){o.signal.removeEventListener("abort",c)}}}a.send(typeof o._bodyInit==="undefined"?null:o._bodyInit)}))}S.polyfill=true;if(!t.fetch){t.fetch=S;t.Headers=h;t.Request=m;t.Response=E}e.Headers=h;e.Request=m;e.Response=E;e.fetch=S;Object.defineProperty(e,"__esModule",{value:true});return e})({})})(n);n.fetch.ponyfill=true;delete n.fetch.polyfill;var s=n;i=s.fetch;i.default=s.fetch;i.fetch=s.fetch;i.Headers=s.Headers;i.Request=s.Request;i.Response=s.Response;t.exports=i}));const wl=r(pl);const yl={Accept:"application/json","Content-Type":"application/json"};const vl="POST";const bl={headers:yl,method:vl};const ml=10;class _l{constructor(t){this.url=t;this.events=new D.EventEmitter;this.isAvailable=false;this.registering=false;if(!fc(t)){throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`)}this.url=t}get connected(){return this.isAvailable}get connecting(){return this.registering}on(t,e){this.events.on(t,e)}once(t,e){this.events.once(t,e)}off(t,e){this.events.off(t,e)}removeListener(t,e){this.events.removeListener(t,e)}async open(t=this.url){await this.register(t)}async close(){if(!this.isAvailable){throw new Error("Connection already closed")}this.onClose()}async send(t,e){if(!this.isAvailable){await this.register()}try{const e=Ci(t);const i=await wl(this.url,Object.assign(Object.assign({},bl),{body:e}));const r=await i.json();this.onPayload({data:r})}catch(e){this.onError(t.id,e)}}async register(t=this.url){if(!fc(t)){throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`)}if(this.registering){const t=this.events.getMaxListeners();if(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t){this.events.setMaxListeners(t+1)}return new Promise(((t,e)=>{this.events.once("register_error",(t=>{this.resetMaxListeners();e(t)}));this.events.once("open",(()=>{this.resetMaxListeners();if(typeof this.isAvailable==="undefined"){return e(new Error("HTTP connection is missing or invalid"))}t()}))}))}this.url=t;this.registering=true;try{const e=Ci({id:1,jsonrpc:"2.0",method:"test",params:[]});await wl(t,Object.assign(Object.assign({},bl),{body:e}));this.onOpen()}catch(t){const e=this.parseError(t);this.events.emit("register_error",e);this.onClose();throw e}}onOpen(){this.isAvailable=true;this.registering=false;this.events.emit("open")}onClose(){this.isAvailable=false;this.registering=false;this.events.emit("close")}onPayload(t){if(typeof t.data==="undefined")return;const e=typeof t.data==="string"?Ri(t.data):t.data;this.events.emit("payload",e)}onError(t,e){const i=this.parseError(e);const r=i.message||i.toString();const n=ic(t,r);this.events.emit("payload",n)}parseError(t,e=this.url){return Oa(t,e,"HTTP")}resetMaxListeners(){if(this.events.getMaxListeners()>ml){this.events.setMaxListeners(ml)}}}const gl="error",El="wss://relay.walletconnect.com",Ol="wc",Sl="universal_provider",Il=`${Ol}@${2}:${Sl}:`,jl="https://rpc.walletconnect.com/v1",Al={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function Nl(t,e,i){let r;const n=Pl(t);return e.rpcMap&&(r=e.rpcMap[n]),r||(r=`${jl}?chainId=eip155:${n}&projectId=${i}`),r}function Pl(t){return t.includes("eip155")?Number(t.split(":")[1]):Number(t)}function Ml(t,e){if(!e.includes(t))throw new Error(`Chain '${t}' not approved. Please use one of the following: ${e.toString()}`)}function xl(t){return t.map((t=>`${t.split(":")[0]}:${t.split(":")[1]}`))}const Tl=(t,e)=>{const i=r=>{r.request!==e.request||r.topic!==e.topic||(t.events.removeListener("session_request_sent",i),Ul())};t.on("session_request_sent",i)};function Ul(){if(typeof window<"u")try{const t=window.localStorage.getItem("WALLETCONNECT_DEEPLINK_CHOICE");if(t){const e=JSON.parse(t);window.open(e.href,"_self","noreferrer noopener")}}catch(t){console.error(t)}}class Rl{constructor(t){this.name="eip155",this.namespace=t.namespace,this.client=t.client,this.events=t.events,this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){var e;switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return this.handleSwitchChain(t.request.params?(e=t.request.params[0])==null?void 0:e.chainId:"0x0"),null;case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?(Tl(this.client,t),await this.client.request(t)):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,e){const i=Pl(t);if(!this.httpProviders[i]){const t=e||Nl(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!t)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,t)}this.chainId=i,this.events.emit(Al.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,e){const i=e||Nl(`${this.name}:${t}`,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new mc(new _l(i))}setHttpProvider(t,e){const i=this.createHttpProvider(t,e);i&&(this.httpProviders[t]=i)}createHttpProviders(){const t={};return this.namespace.chains.forEach((e=>{const i=Pl(e);t[i]=this.createHttpProvider(i)})),t}getAccounts(){const t=this.namespace.accounts;return t?t.filter((t=>t.split(":")[1]===this.chainId.toString())).map((t=>t.split(":")[2]))||[]:[]}getHttpProvider(){const t=this.chainId,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}handleSwitchChain(t){const e=parseInt(t,16),i=`${this.name}:${e}`;Ml(i,this.namespace.chains),this.setDefaultChain(`${e}`)}}class Cl{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=t.events,this.client=t.client,this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?(Tl(this.client,t),this.client.request(t)):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){if(!this.httpProviders[t]){const i=e||Nl(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,i)}this.chainId=t,this.events.emit(Al.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?t.filter((t=>t.split(":")[1]===this.chainId.toString())).map((t=>t.split(":")[2]))||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach((e=>{t[e]=this.createHttpProvider(e)})),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){const i=this.createHttpProvider(t,e);i&&(this.httpProviders[t]=i)}createHttpProvider(t,e){const i=e||Nl(t,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new mc(new _l(i))}}class $l{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=t.events,this.client=t.client,this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?(Tl(this.client,t),this.client.request(t)):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){if(this.chainId=t,!this.httpProviders[t]){const i=e||Nl(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,i)}this.events.emit(Al.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter((t=>t.split(":")[1]===this.chainId.toString())).map((t=>t.split(":")[2]))||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach((e=>{t[e]=this.createHttpProvider(e)})),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){const i=this.createHttpProvider(t,e);i&&(this.httpProviders[t]=i)}createHttpProvider(t,e){const i=e||Nl(t,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new mc(new _l(i))}}class Dl{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=t.events,this.client=t.client,this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?(Tl(this.client,t),this.client.request(t)):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){if(this.chainId=t,!this.httpProviders[t]){const i=e||Nl(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,i)}this.events.emit(Al.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter((t=>t.split(":")[1]===this.chainId.toString())).map((t=>t.split(":")[2]))||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach((e=>{t[e]=this.createHttpProvider(e)})),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){const i=this.createHttpProvider(t,e);i&&(this.httpProviders[t]=i)}createHttpProvider(t,e){const i=e||Nl(t,this.namespace);return typeof i>"u"?void 0:new mc(new _l(i))}}var kl=Object.defineProperty,Ll=Object.defineProperties,Vl=Object.getOwnPropertyDescriptors,ql=Object.getOwnPropertySymbols,Fl=Object.prototype.hasOwnProperty,Gl=Object.prototype.propertyIsEnumerable,Bl=(t,e,i)=>e in t?kl(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Hl=(t,e)=>{for(var i in e||(e={}))Fl.call(e,i)&&Bl(t,i,e[i]);if(ql)for(var i of ql(e))Gl.call(e,i)&&Bl(t,i,e[i]);return t},Kl=(t,e)=>Ll(t,Vl(e));class zl{constructor(t){this.events=new D,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.providerOpts=t,this.logger=typeof t?.logger<"u"&&typeof t?.logger!="string"?t.logger:h(Oi.getDefaultLoggerOptions({level:t?.logger||gl}))}static async init(t){const e=new zl(t);return await e.initialize(),e}async request(t,e){const[i,r]=this.validateChain(e);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:Hl({},t),chainId:`${i}:${r}`,topic:this.session.topic})}sendAsync(t,e,i){this.request(t,i).then((t=>e(null,t))).catch((t=>e(t,void 0)))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:Mo("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,e){this.events.on(t,e)}once(t,e){this.events.once(t,e)}removeListener(t,e){this.events.removeListener(t,e)}off(t,e){this.events.off(t,e)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let e=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(e>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:i,approval:r}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});i&&(this.uri=i,this.events.emit("display_uri",i)),await r().then((t=>{this.session=t})).catch((t=>{if(t.message!==zf)throw t;e++}))}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,e){try{const[i,r]=this.validateChain(t);this.getProvider(i).setDefaultChain(r,e)}catch(t){if(!/Please call connect/.test(t.message))throw t}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const e=this.client.pairing.getAll();if(xo(e)){for(const i of e)t.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${e.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await dl.init({logger:this.providerOpts.logger||gl,relayUrl:this.providerOpts.relayUrl||El,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");Object.keys(this.namespaces).forEach((t=>{var e,i,r;const n=((e=this.session)==null?void 0:e.namespaces[t].accounts)||[],s=xl(n),o=Kl(Hl({},Object.assign(this.namespaces[t],(r=(i=this.optionalNamespaces)==null?void 0:i[t])!=null?r:{})),{accounts:n,chains:s});switch(t){case"eip155":this.rpcProviders[t]=new Rl({client:this.client,namespace:o,events:this.events});break;case"solana":this.rpcProviders[t]=new Cl({client:this.client,namespace:o,events:this.events});break;case"cosmos":this.rpcProviders[t]=new $l({client:this.client,namespace:o,events:this.events});break;case"polkadot":break;case"cip34":this.rpcProviders[t]=new Dl({client:this.client,namespace:o,events:this.events});break}}))}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",(t=>{this.events.emit("session_ping",t)})),this.client.on("session_event",(t=>{const{params:e}=t,{event:i}=e;i.name==="accountsChanged"?this.events.emit("accountsChanged",i.data):i.name==="chainChanged"?this.onChainChanged(e.chainId):this.events.emit(i.name,i.data),this.events.emit("session_event",t)})),this.client.on("session_update",(({topic:t,params:e})=>{var i;const{namespaces:r}=e,n=(i=this.client)==null?void 0:i.session.get(t);this.session=Kl(Hl({},n),{namespaces:r}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:e})})),this.client.on("session_delete",(async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",Kl(Hl({},Mo("USER_DISCONNECTED")),{data:t.topic}))})),this.on(Al.DEFAULT_CHAIN_CHANGED,(t=>{this.onChainChanged(t,!0)}))}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach((t=>{var e;this.getProvider(t).updateNamespace((e=this.session)==null?void 0:e.namespaces[t])}))}setNamespaces(t){const{namespaces:e,optionalNamespaces:i,sessionProperties:r}=t;if(!e||!Object.keys(e).length)throw new Error("Namespaces must be not empty");this.namespaces=e,this.optionalNamespaces=i,this.sessionProperties=r,this.persist("namespaces",e),this.persist("optionalNamespaces",i)}validateChain(t){const[e,i]=t?.split(":")||["",""];if(e&&!Object.keys(this.namespaces).includes(e))throw new Error(`Namespace '${e}' is not configured. Please call connect() first with namespace config.`);if(e&&i)return[e,i];const r=Object.keys(this.namespaces)[0],n=this.rpcProviders[r].getDefaultChain();return[r,n]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,e=!1){const[i,r]=this.validateChain(t);e||this.getProvider(i).setDefaultChain(r),this.namespaces[i].defaultChain=r,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",r)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0})}persist(t,e){this.client.core.storage.setItem(`${Il}/${t}`,e)}async getFromStore(t){return await this.client.core.storage.getItem(`${Il}/${t}`)}}var Wl=undefined&&undefined.__awaiter||function(t,e,i,r){function n(t){return t instanceof i?t:new i((function(e){e(t)}))}return new(i||(i=Promise))((function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r["throw"](t))}catch(t){s(t)}}function c(t){t.done?i(t.value):n(t.value).then(o,a)}c((r=r.apply(t,e||[])).next())}))};const Jl={1:"https://ethereum.publicnode.com",5:"https://eth-goerli.g.alchemy.com/v2/yVhq9zPJorAWsw-F87fEabSUl7cCU6z4",11155111:"https://sepolia.infura.io/v3/9f79b2f9274344af90b8d4e244b580ef",137:"https://polygon-rpc.com/",80001:"https://polygon-mumbai.g.alchemy.com/v2/rVI6pOV4irVsrw20cJxc1fxK_1cSeiY0",56:"https://bsc-dataseed.binance.org/",97:"https://data-seed-prebsc-1-s1.binance.org:8545",43114:"https://api.avax.network/ext/bc/C/rpc",43113:"https://api.avax-test.network/ext/bc/C/rpc",250:"https://rpc.fantom.network/",25:"https://evm-cronos.crypto.org",338:"https://evm-t3.cronos.org",42161:"https://arb1.arbitrum.io/rpc",421613:"https://arb-goerli.g.alchemy.com/v2/nFrflomLgsQQL5NWjGileAVqIGGxZWce",10:"https://mainnet.optimism.io"};const Xl=["eip155:1","eip155:137","eip155:250","eip155:25","eip155:42161","eip155:10"];const Yl=()=>Wl(void 0,void 0,void 0,(function*(){return yield zl.init({projectId:"2ec7ead81da1226703ad789c0b2f7b30",logger:"debug",relayUrl:"wss://relay.walletconnect.com"})}));export{Jl as WC_DEFAULT_RPC_MAP,Xl as WC_V2_DEFAULT_CHAINS,Yl as getWalletConnectV2ProviderInstance};
//# sourceMappingURL=p-d4032b45.js.map