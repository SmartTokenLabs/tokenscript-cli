{"version":3,"names":["__awaiter","this","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","throw","return","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","Web3WalletProvider","client","safeConnectOptions","connections","prototype","saveConnections","savedConnections","address","con","chainId","providerType","blockchain","ethers","localStorage","setItem","LOCAL_STORAGE_KEY","JSON","stringify","emitSavedConnection","Object","keys","eventSender","data","toLocaleLowerCase","emitNetworkChange","deleteConnections","removeItem","sessionStorage","loadConnections","state","_a","_b","_c","_i","connection","e_1","_d","getItem","parse","connectWith","console","log","message","walletType","checkConnectionOnly","Error","logger","signMessage","provider","signer","getWalletProvider","getSigner","toLowerCase","getConnectedWalletData","values","registerNewWalletAddress","registerProvider","providerName","accounts","curAccount","_this","listAccounts","detectNetwork","on","disconnectWallet","getTokenStore","clearCachedTokens","enrichTokenLookupDataOnChainTokens","_chainId","reason","indexOf","MetaMask","window","ethereum","enable","ethers.providers.Web3Provider","WalletConnect","walletConnectProvider","walletConnect","import","getWalletConnectProviderInstance","connector","err","payload","catch","WalletConnectV2","universalWalletConnect","QRCodeModal","pairing","getWalletConnectV2ProviderInstance","uri","i","default","open","getUi","showError","connect","namespaces","eip155","methods","chains","WC_V2_CHAINS","events","rpcMap","CUSTOM_RPCS_FOR_WC_V2","pairingTopic","topic","close","Torus","TorusProvider","torus","getTorusProviderInstance","init","login","Phantom","accountAddress","solana","publicKey","toBase58","SafeConnect","getSafeConnectProvider","initSafeConnect","flowSubscribe","fcl","currentUser","ui","addr","dismissLoader","updateUI","error","Flow","flowProvider","fcl_1","e_2","getFlowProvider","subscribe","authenticate","safeConnectAvailable","undefined","SafeConnectProvider","S"],"sources":["../../token-negotiator/dist/wallet/Web3WalletProvider.js"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { ethers } from 'ethers';\nimport { logger } from '../utils';\nvar Web3WalletProvider = (function () {\n    function Web3WalletProvider(client, safeConnectOptions) {\n        this.connections = {};\n        this.client = client;\n        this.safeConnectOptions = safeConnectOptions;\n    }\n    Web3WalletProvider.prototype.saveConnections = function () {\n        var savedConnections = {};\n        for (var address in this.connections) {\n            var con = this.connections[address];\n            savedConnections[address] = {\n                address: con.address,\n                chainId: con.chainId,\n                providerType: con.providerType,\n                blockchain: con.blockchain,\n                ethers: ethers,\n            };\n        }\n        localStorage.setItem(Web3WalletProvider.LOCAL_STORAGE_KEY, JSON.stringify(savedConnections));\n    };\n    Web3WalletProvider.prototype.emitSavedConnection = function (address) {\n        if (Object.keys(this.connections).length && address) {\n            this.client.eventSender('connected-wallet', { data: this.connections[address.toLocaleLowerCase()] });\n            return this.connections[address.toLocaleLowerCase()];\n        }\n        else {\n            return null;\n        }\n    };\n    Web3WalletProvider.prototype.emitNetworkChange = function (chainId) {\n        if (chainId) {\n            this.client.eventSender('network-change', chainId);\n            return chainId;\n        }\n    };\n    Web3WalletProvider.prototype.deleteConnections = function () {\n        this.connections = {};\n        localStorage.removeItem(Web3WalletProvider.LOCAL_STORAGE_KEY);\n        localStorage.removeItem('walletconnect');\n        sessionStorage.removeItem('CURRENT_USER');\n    };\n    Web3WalletProvider.prototype.loadConnections = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var data, state, _a, _b, _c, _i, address, connection, e_1;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0:\n                        data = localStorage.getItem(Web3WalletProvider.LOCAL_STORAGE_KEY);\n                        if (!data)\n                            return [2];\n                        state = JSON.parse(data);\n                        if (!state)\n                            return [2];\n                        _a = state;\n                        _b = [];\n                        for (_c in _a)\n                            _b.push(_c);\n                        _i = 0;\n                        _d.label = 1;\n                    case 1:\n                        if (!(_i < _b.length)) return [3, 6];\n                        _c = _b[_i];\n                        if (!(_c in _a)) return [3, 5];\n                        address = _c;\n                        connection = state[address];\n                        _d.label = 2;\n                    case 2:\n                        _d.trys.push([2, 4, , 5]);\n                        return [4, this.connectWith(connection.providerType, true)];\n                    case 3:\n                        _d.sent();\n                        return [3, 5];\n                    case 4:\n                        e_1 = _d.sent();\n                        console.log(\"Wallet couldn't connect: \" + e_1.message);\n                        delete state[address];\n                        this.saveConnections();\n                        this.emitSavedConnection(address);\n                        return [3, 5];\n                    case 5:\n                        _i++;\n                        return [3, 1];\n                    case 6: return [2];\n                }\n            });\n        });\n    };\n    Web3WalletProvider.prototype.connectWith = function (walletType, checkConnectionOnly) {\n        if (checkConnectionOnly === void 0) { checkConnectionOnly = false; }\n        return __awaiter(this, void 0, void 0, function () {\n            var address;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!walletType)\n                            throw new Error('Please provide a Wallet type to connect with.');\n                        if (!this[walletType]) return [3, 2];\n                        return [4, this[walletType](checkConnectionOnly)];\n                    case 1:\n                        address = _a.sent();\n                        logger(2, 'address', address);\n                        this.saveConnections();\n                        this.emitSavedConnection(address);\n                        return [2, address];\n                    case 2: throw new Error('Wallet type not found');\n                }\n            });\n        });\n    };\n    Web3WalletProvider.prototype.signMessage = function (address, message) {\n        return __awaiter(this, void 0, void 0, function () {\n            var provider, signer;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        provider = this.getWalletProvider(address);\n                        signer = provider.getSigner(address);\n                        return [4, signer.signMessage(message)];\n                    case 1: return [2, _a.sent()];\n                }\n            });\n        });\n    };\n    Web3WalletProvider.prototype.getWalletProvider = function (address) {\n        var _a;\n        address = address.toLowerCase();\n        if (!((_a = this.connections[address]) === null || _a === void 0 ? void 0 : _a.provider))\n            throw new Error('Wallet provider not found for address');\n        return this.connections[address].provider;\n    };\n    Web3WalletProvider.prototype.getConnectedWalletData = function () {\n        return Object.values(this.connections);\n    };\n    Web3WalletProvider.prototype.registerNewWalletAddress = function (address, chainId, providerType, provider, blockchain) {\n        if (blockchain === void 0) { blockchain = 'evm'; }\n        this.connections[address.toLowerCase()] = { address: address, chainId: chainId, providerType: providerType, provider: provider, blockchain: blockchain, ethers: ethers };\n        return address;\n    };\n    Web3WalletProvider.prototype.registerProvider = function (provider, providerName) {\n        return __awaiter(this, void 0, void 0, function () {\n            var accounts, chainId, curAccount;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4, provider.listAccounts()];\n                    case 1:\n                        accounts = _a.sent();\n                        return [4, provider.detectNetwork()];\n                    case 2:\n                        chainId = (_a.sent()).chainId;\n                        if (accounts.length === 0) {\n                            throw new Error('No accounts found via wallet-connect.');\n                        }\n                        curAccount = accounts[0];\n                        this.registerNewWalletAddress(curAccount, chainId, providerName, provider);\n                        provider.provider.on('accountsChanged', function (accounts) {\n                            console.log(\"Account changed: \", accounts);\n                            if (!accounts || accounts.length === 0) {\n                                _this.client.disconnectWallet();\n                                return;\n                            }\n                            if (curAccount === accounts[0])\n                                return;\n                            delete _this.connections[curAccount.toLowerCase()];\n                            curAccount = accounts[0];\n                            _this.registerNewWalletAddress(curAccount, chainId, providerName, provider);\n                            _this.saveConnections();\n                            _this.emitSavedConnection(curAccount);\n                            _this.client.getTokenStore().clearCachedTokens();\n                            _this.client.enrichTokenLookupDataOnChainTokens();\n                        });\n                        provider.provider.on('chainChanged', function (_chainId) {\n                            console.log(\"Chain changed: \", _chainId);\n                            _this.registerNewWalletAddress(accounts[0], _chainId, providerName, provider);\n                            _this.saveConnections();\n                            _this.emitNetworkChange(_chainId);\n                        });\n                        provider.provider.on('disconnect', function (reason) {\n                            console.log(\"Disconnect wallet: \", reason);\n                            if ((reason === null || reason === void 0 ? void 0 : reason.message) && reason.message.indexOf('MetaMask: Disconnected from chain') > -1)\n                                return;\n                            _this.client.disconnectWallet();\n                        });\n                        return [2, accounts[0]];\n                }\n            });\n        });\n    };\n    Web3WalletProvider.prototype.MetaMask = function (checkConnectionOnly) {\n        return __awaiter(this, void 0, void 0, function () {\n            var provider;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        logger(2, 'connect MetaMask');\n                        if (!(typeof window.ethereum !== 'undefined')) return [3, 2];\n                        return [4, window.ethereum.enable()];\n                    case 1:\n                        _a.sent();\n                        provider = new ethers.providers.Web3Provider(window.ethereum, 'any');\n                        return [2, this.registerProvider(provider, 'MetaMask')];\n                    case 2: throw new Error('MetaMask is not available. Please check the extension is supported and active.');\n                }\n            });\n        });\n    };\n    Web3WalletProvider.prototype.WalletConnect = function (checkConnectionOnly) {\n        return __awaiter(this, void 0, void 0, function () {\n            var walletConnectProvider, walletConnect;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        logger(2, 'connect Wallet Connect');\n                        return [4, import('./WalletConnectProvider')];\n                    case 1:\n                        walletConnectProvider = _a.sent();\n                        return [4, walletConnectProvider.getWalletConnectProviderInstance(checkConnectionOnly)];\n                    case 2:\n                        walletConnect = _a.sent();\n                        return [2, new Promise(function (resolve, reject) {\n                                if (checkConnectionOnly) {\n                                    walletConnect.connector.on('display_uri', function (err, payload) {\n                                        reject(new Error('Connection expired'));\n                                    });\n                                }\n                                walletConnect\n                                    .enable()\n                                    .then(function () {\n                                    var provider = new ethers.providers.Web3Provider(walletConnect, 'any');\n                                    resolve(_this.registerProvider(provider, 'WalletConnect'));\n                                })\n                                    .catch(function (e) { return reject(e); });\n                            })];\n                }\n            });\n        });\n    };\n    Web3WalletProvider.prototype.WalletConnectV2 = function (checkConnectionOnly) {\n        return __awaiter(this, void 0, void 0, function () {\n            var walletConnectProvider, universalWalletConnect, QRCodeModal, pairing;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        logger(2, 'connect Wallet Connect V2');\n                        return [4, import('./WalletConnectV2Provider')];\n                    case 1:\n                        walletConnectProvider = _a.sent();\n                        return [4, walletConnectProvider.getWalletConnectV2ProviderInstance()];\n                    case 2:\n                        universalWalletConnect = _a.sent();\n                        universalWalletConnect.on('display_uri', function (uri) { return __awaiter(_this, void 0, void 0, function () {\n                            var _this = this;\n                            return __generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0:\n                                        console.log('EVENT', 'QR Code Modal open');\n                                        return [4, import('@walletconnect/qrcode-modal')];\n                                    case 1:\n                                        QRCodeModal = (_a.sent()).default;\n                                        QRCodeModal.open(uri, function () {\n                                            _this.client.getUi().showError('User closed modal');\n                                        });\n                                        return [2];\n                                }\n                            });\n                        }); });\n                        universalWalletConnect.on('session_delete', function (_a) {\n                            var id = _a.id, topic = _a.topic;\n                            console.log('WC V2 EVENT', 'session_deleted');\n                            _this.client.disconnectWallet();\n                        });\n                        if (!!checkConnectionOnly) return [3, 4];\n                        pairing = void 0;\n                        return [4, universalWalletConnect.connect({\n                                namespaces: {\n                                    eip155: {\n                                        methods: ['eth_sendTransaction', 'eth_signTransaction', 'eth_sign', 'personal_sign', 'eth_signTypedData'],\n                                        chains: walletConnectProvider.WC_V2_CHAINS,\n                                        events: ['chainChanged', 'accountsChanged'],\n                                        rpcMap: walletConnectProvider.CUSTOM_RPCS_FOR_WC_V2,\n                                    },\n                                },\n                                pairingTopic: pairing === null || pairing === void 0 ? void 0 : pairing.topic,\n                            })];\n                    case 3:\n                        _a.sent();\n                        QRCodeModal.close();\n                        _a.label = 4;\n                    case 4: return [2, new Promise(function (resolve, reject) {\n                            universalWalletConnect\n                                .enable()\n                                .then(function () {\n                                var provider = new ethers.providers.Web3Provider(universalWalletConnect, 'any');\n                                resolve(_this.registerProvider(provider, 'WalletConnectV2'));\n                            })\n                                .catch(function (e) {\n                                reject(e);\n                            });\n                        })];\n                }\n            });\n        });\n    };\n    Web3WalletProvider.prototype.Torus = function (checkConnectionOnly) {\n        return __awaiter(this, void 0, void 0, function () {\n            var TorusProvider, torus, provider;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4, import('./TorusProvider')];\n                    case 1:\n                        TorusProvider = _a.sent();\n                        return [4, TorusProvider.getTorusProviderInstance()];\n                    case 2:\n                        torus = _a.sent();\n                        return [4, torus.init()];\n                    case 3:\n                        _a.sent();\n                        return [4, torus.login()];\n                    case 4:\n                        _a.sent();\n                        provider = new ethers.providers.Web3Provider(torus.provider, 'any');\n                        return [2, this.registerProvider(provider, 'Torus')];\n                }\n            });\n        });\n    };\n    Web3WalletProvider.prototype.Phantom = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var connection, accountAddress;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        logger(2, 'connect Phantom');\n                        if (!(typeof window.solana !== 'undefined')) return [3, 2];\n                        return [4, window.solana.connect()];\n                    case 1:\n                        connection = _a.sent();\n                        accountAddress = connection.publicKey.toBase58();\n                        return [2, this.registerNewWalletAddress(accountAddress, 'mainnet-beta', 'phantom', window.solana, 'solana')];\n                    case 2: throw new Error('MetaMask is not available. Please check the extension is supported and active.');\n                }\n            });\n        });\n    };\n    Web3WalletProvider.prototype.SafeConnect = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var provider, address;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        logger(2, 'connect SafeConnect');\n                        return [4, this.getSafeConnectProvider()];\n                    case 1:\n                        provider = _a.sent();\n                        return [4, provider.initSafeConnect()];\n                    case 2:\n                        address = _a.sent();\n                        this.registerNewWalletAddress(address, 1, 'SafeConnect', provider);\n                        return [2, address];\n                }\n            });\n        });\n    };\n    Web3WalletProvider.prototype.flowSubscribe = function (fcl, currentUser) {\n        return __awaiter(this, void 0, void 0, function () {\n            var ui;\n            return __generator(this, function (_a) {\n                try {\n                    if (currentUser.addr) {\n                        this.registerNewWalletAddress(currentUser.addr, 1, 'flow', fcl);\n                        ui = this.client.getUi();\n                        if (ui)\n                            ui.dismissLoader();\n                        this.client.enrichTokenLookupDataOnChainTokens();\n                        if (ui)\n                            ui.updateUI('main');\n                    }\n                }\n                catch (e) {\n                    console.error('flow wallet connection error ==>', e);\n                    this.client.getUi().showError('Flow wallet connection error.');\n                }\n                return [2];\n            });\n        });\n    };\n    Web3WalletProvider.prototype.Flow = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var flowProvider, fcl_1, e_2;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 2, , 3]);\n                        return [4, import('./FlowProvider')];\n                    case 1:\n                        flowProvider = _a.sent();\n                        fcl_1 = flowProvider.getFlowProvider();\n                        fcl_1.currentUser.subscribe(function (currentUser) { return _this.flowSubscribe(fcl_1, currentUser); });\n                        fcl_1.authenticate();\n                        return [3, 3];\n                    case 2:\n                        e_2 = _a.sent();\n                        console.error('error ==>', e_2);\n                        return [3, 3];\n                    case 3: return [2, ''];\n                }\n            });\n        });\n    };\n    Web3WalletProvider.prototype.safeConnectAvailable = function () {\n        return this.safeConnectOptions !== undefined;\n    };\n    Web3WalletProvider.prototype.getSafeConnectProvider = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var SafeConnectProvider;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4, import('./SafeConnectProvider')];\n                    case 1:\n                        SafeConnectProvider = (_a.sent()).SafeConnectProvider;\n                        return [2, new SafeConnectProvider(this.client.getUi(), this.safeConnectOptions)];\n                }\n            });\n        });\n    };\n    Web3WalletProvider.LOCAL_STORAGE_KEY = 'tn-wallet-connections';\n    return Web3WalletProvider;\n}());\nexport { Web3WalletProvider };\nexport default Web3WalletProvider;\n//# sourceMappingURL=Web3WalletProvider.js.map"],"mappings":"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"}