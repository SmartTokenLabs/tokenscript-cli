{"version":3,"names":["debugViewerTabCss","DebugViewerTab","async","this","viewBinding","ViewBinding","host","setTokenScript","tokenScript","setViewBinding","querySelector","style","display","populateCards","populateTokens","loadView","componentDidLoad","loadTs","setTokenContext","tokenRef","refs","split","setCurrentTokenContext","length","parseInt","console","log","setCard","index","currentCardIndex","cards","getCards","currentTokens","getTokenMetadata","currentTokensFlat","Object","keys","reduce","tokenArr","contractName","nftDetails","tokens","map","nft","assign","contextId","push","flatToken","currentCard","showTokenCard","render","h","class","onChange","e","target","value","card","i","selected","label","token","name","collectionDetails","id","tokenId","sandbox"],"sources":["./src/components/tabs/debug-viewer-tab.css?tag=debug-viewer-tab","./src/components/tabs/debug-viewer-tab.tsx"],"sourcesContent":["\n:host {\n\tpadding: 0 20px;\n}\n\n.attribute-table {\n\ttext-align: left;\n\tborder: #000 solid 1px;\n}\n\n.attribute-table td, .attribute-table th {\n\tpadding: 8px;\n}\n\n.view-container {\n\theight: 550px;\n\tmax-width: 400px;\n\tmargin: 20px auto;\n\tposition: relative;\n}\n\n.view-loader {\n\tposition: absolute;\n\tleft: 0;\n\ttop: 0;\n\twidth: 100%;\n\theight: 100%;\n\talign-items: center;\n\tjustify-content: center;\n\tbackground-color: rgba(131,131,131,0.67)\n}\n\n.tokenscript-frame {\n\twidth: 100%;\n\theight: 500px;\n\tborder: 1px solid black;\n\tborder-radius: 4px;\n\tbox-sizing: border-box;\n}\n\n.action-bar {\n\theight: 35px;\n}\n\n.action-btn {\n\twidth: 100%;\n\theight: 100%;\n}\n","import {Component, Element, h, Prop, State, Watch} from \"@stencil/core\";\nimport {Components} from \"../../components\";\nimport {TokenScript} from \"../../../../engine-js/src/TokenScript\";\nimport {Card} from \"../../../../engine-js/src/tokenScript/Card\";\nimport {ViewBinding} from \"../../integration/viewBinding\";\nimport {IToken} from \"../../../../engine-js/src/tokens/IToken\";\nimport {INFTTokenDetail} from \"../../../../engine-js/src/tokens/INFTTokenDetail\";\nimport AppRoot = Components.AppRoot;\n\n\n@Component({\n\ttag: 'debug-viewer-tab',\n\tstyleUrl: 'debug-viewer-tab.css',\n\tshadow: false,\n})\nexport class DebugViewerTab {\n\n\t@Element() host: HTMLElement;\n\n\t@Prop() app: AppRoot;\n\t@Prop() tabId: string;\n\n\t@Prop() tokenScript: TokenScript;\n\n\t@State()\n\tcards: Card[] = [];\n\n\t@State()\n\tcurrentCardIndex: number = 0;\n\n\t@State()\n\tcurrentCard: Card;\n\n\tcurrentTokens: {[key: string]: IToken};\n\n\tviewBinding: ViewBinding;\n\n\t@State()\n\tcurrentTokensFlat: ((IToken|INFTTokenDetail)&{contextId: string})[] = [];\n\n\t@Watch('tokenScript')\n\tasync loadTs(){\n\n\t\tif (!this.viewBinding){\n\t\t\tthis.viewBinding = new ViewBinding(this.host);\n\t\t}\n\n\t\tthis.viewBinding.setTokenScript(this.tokenScript);\n\t\tthis.tokenScript.setViewBinding(this.viewBinding);\n\n\t\t(this.host.querySelector(\".cards-container\") as HTMLDivElement).style.display = \"block\";\n\n\t\tthis.populateCards();\n\n\t\tawait this.populateTokens();\n\n\t\tthis.loadView();\n\t}\n\n\tcomponentDidLoad() {\n\t\tif (this.tokenScript)\n\t\t\tthis.loadTs();\n\t}\n\n\tsetTokenContext(tokenRef: string){\n\n\t\tconst refs = tokenRef.split(\"-\");\n\n\t\tthis.tokenScript.setCurrentTokenContext(refs[0], refs.length > 1 ? parseInt(refs[1]): null);\n\n\t\tconsole.log(\"Token context set\");\n\t}\n\n\tsetCard(index){\n\t\tthis.currentCardIndex = parseInt(index);\n\t\tthis.loadView();\n\t}\n\n\tpopulateCards(){\n\t\tthis.cards = this.tokenScript.getCards();\n\t}\n\n\tasync populateTokens(){\n\n\t\tthis.currentTokens = await this.tokenScript.getTokenMetadata();\n\n\t\tthis.currentTokensFlat = Object.keys(this.currentTokens).reduce((tokenArr, contractName) => {\n\n\t\t\tif (this.currentTokens[contractName].nftDetails){\n\n\t\t\t\t// NFTs\n\t\t\t\tconst tokens = this.currentTokens[contractName].nftDetails.map((nft, index) => {\n\t\t\t\t\treturn {...nft, contextId: contractName + \"-\" + index};\n\t\t\t\t});\n\t\t\t\ttokenArr.push(...tokens);\n\t\t\t} else {\n\t\t\t\t// fungible token with balance\n\t\t\t\tconst flatToken = {...this.currentTokens[contractName], contextId: contractName};\n\t\t\t\ttokenArr.push(flatToken);\n\t\t\t}\n\n\t\t\treturn tokenArr;\n\n\t\t}, []);\n\n\t\tif (this.currentTokensFlat.length > 0){\n\t\t\tawait this.setTokenContext(this.currentTokensFlat[0].contextId);\n\t\t}\n\t}\n\n\tloadView(){\n\n\t\tif (this.cards.length === 0)\n\t\t\treturn;\n\n\t\t(this.host.querySelector(\".view-container\") as HTMLDivElement).style.display = \"block\";\n\n\t\tconst currentCard = this.cards[this.currentCardIndex];\n\n\t\tthis.tokenScript.showTokenCard(currentCard);\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t<div class=\"cards-container\" style={{display: \"none\"}}>\n\t\t\t\t\t<h5>Select Action</h5>\n\t\t\t\t\t<select class=\"card-select\" onChange={(e) => this.setCard((e.target as HTMLSelectElement).value) }>\n\t\t\t\t\t\t{ this.cards ? this.cards.map((card, i) => {\n\t\t\t\t\t\t\treturn (<option value={i} selected={i === this.currentCardIndex}>{card.label}</option>);\n\t\t\t\t\t\t}) : ''}\n\t\t\t\t\t</select>\n\n\t\t\t\t\t<h5>Select Token Context</h5>\n\t\t\t\t\t<select class=\"token-select\" onChange={ (e) => this.setTokenContext((e.target as HTMLSelectElement).value)}>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.currentTokensFlat ? this.currentTokensFlat.map((token, index) => {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<option value={ token.contextId } >\n\t\t\t\t\t\t\t\t\t\t{ token.name + ' (' + (\"tokenId\" in token ? token.collectionDetails.id + ' #' + token.tokenId : token.name) + ')' }\n\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}) : ''\n\t\t\t\t\t\t}\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"view-container\" style={{display: \"none\"}}>\n\t\t\t\t\t<div class=\"view-loader\" style={{display: \"none\"}}>\n\t\t\t\t\t\t<loading-spinner/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<iframe class=\"tokenscript-frame\"\n\t\t\t\t\t\t\tsandbox=\"allow-scripts allow-modals allow-forms\">\n\t\t\t\t\t</iframe>\n\t\t\t\t\t<div class=\"action-bar\" style={{display: \"none\"}}>\n\t\t\t\t\t\t<button class=\"action-btn\"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<security-status tokenScript={this.tokenScript}/>\n\t\t\t\t\t<table class=\"attribute-table\"></table>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n}\n"],"mappings":"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"}