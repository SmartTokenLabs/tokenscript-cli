import{l as n,e as t,W as e}from"./p-ea01a02d.js";import"./p-0a353f40.js";var r=undefined&&undefined.__awaiter||function(n,t,e,r){function i(n){return n instanceof e?n:new e((function(t){t(n)}))}return new(e||(e=Promise))((function(e,o){function c(n){try{u(r.next(n))}catch(n){o(n)}}function s(n){try{u(r["throw"](n))}catch(n){o(n)}}function u(n){n.done?e(n.value):i(n.value).then(c,s)}u((r=r.apply(n,t||[])).next())}))};var i=undefined&&undefined.__generator||function(n,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,c;return c={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(c[Symbol.iterator]=function(){return this}),c;function s(n){return function(t){return u([n,t])}}function u(s){if(r)throw new TypeError("Generator is already executing.");while(c&&(c=0,s[0]&&(e=0)),e)try{if(r=1,i&&(o=s[0]&2?i["return"]:s[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;if(i=0,o)s=[s[0]&2,o.value];switch(s[0]){case 0:case 1:o=s;break;case 4:e.label++;return{value:s[1],done:false};case 5:e.label++;i=s[1];s=[0];continue;case 7:s=e.ops.pop();e.trys.pop();continue;default:if(!(o=e.trys,o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){e.label=s[1];break}if(s[0]===6&&e.label<o[1]){e.label=o[1];o=s;break}if(o&&e.label<o[2]){e.label=o[2];e.ops.push(s);break}if(o[2])e.ops.pop();e.trys.pop();continue}s=t.call(n,e)}catch(n){s=[6,n];i=0}finally{r=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var o=function(){function o(n,t){this.connections={};this.client=n;this.safeConnectOptions=t}o.prototype.saveConnections=function(){var n={};for(var e in this.connections){var r=this.connections[e];n[e]={address:r.address,chainId:r.chainId,providerType:r.providerType,blockchain:r.blockchain,ethers:t}}localStorage.setItem(o.LOCAL_STORAGE_KEY,JSON.stringify(n))};o.prototype.emitSavedConnection=function(n){if(Object.keys(this.connections).length&&n){this.client.eventSender("connected-wallet",{data:this.connections[n.toLocaleLowerCase()]});return this.connections[n.toLocaleLowerCase()]}else{return null}};o.prototype.emitNetworkChange=function(n){if(n){this.client.eventSender("network-change",n);return n}};o.prototype.deleteConnections=function(){this.connections={};localStorage.removeItem(o.LOCAL_STORAGE_KEY);localStorage.removeItem("walletconnect");sessionStorage.removeItem("CURRENT_USER")};o.prototype.loadConnections=function(){return r(this,void 0,void 0,(function(){var n,t,e,r,c,s,u,a,f;return i(this,(function(i){switch(i.label){case 0:n=localStorage.getItem(o.LOCAL_STORAGE_KEY);if(!n)return[2];t=JSON.parse(n);if(!t)return[2];e=t;r=[];for(c in e)r.push(c);s=0;i.label=1;case 1:if(!(s<r.length))return[3,6];c=r[s];if(!(c in e))return[3,5];u=c;a=t[u];i.label=2;case 2:i.trys.push([2,4,,5]);return[4,this.connectWith(a.providerType,true)];case 3:i.sent();return[3,5];case 4:f=i.sent();console.log("Wallet couldn't connect: "+f.message);delete t[u];this.saveConnections();this.emitSavedConnection(u);return[3,5];case 5:s++;return[3,1];case 6:return[2]}}))}))};o.prototype.connectWith=function(t,e){if(e===void 0){e=false}return r(this,void 0,void 0,(function(){var r;return i(this,(function(i){switch(i.label){case 0:if(!t)throw new Error("Please provide a Wallet type to connect with.");if(!this[t])return[3,2];return[4,this[t](e)];case 1:r=i.sent();n(2,"address",r);this.saveConnections();this.emitSavedConnection(r);return[2,r];case 2:throw new Error("Wallet type not found")}}))}))};o.prototype.signMessage=function(n,t){return r(this,void 0,void 0,(function(){var e,r;return i(this,(function(i){switch(i.label){case 0:e=this.getWalletProvider(n);r=e.getSigner(n);return[4,r.signMessage(t)];case 1:return[2,i.sent()]}}))}))};o.prototype.getWalletProvider=function(n){var t;n=n.toLowerCase();if(!((t=this.connections[n])===null||t===void 0?void 0:t.provider))throw new Error("Wallet provider not found for address");return this.connections[n].provider};o.prototype.getConnectedWalletData=function(){return Object.values(this.connections)};o.prototype.registerNewWalletAddress=function(n,e,r,i,o){if(o===void 0){o="evm"}this.connections[n.toLowerCase()]={address:n,chainId:e,providerType:r,provider:i,blockchain:o,ethers:t};return n};o.prototype.registerProvider=function(n,t){return r(this,void 0,void 0,(function(){var e,r,o;var c=this;return i(this,(function(i){switch(i.label){case 0:return[4,n.listAccounts()];case 1:e=i.sent();return[4,n.detectNetwork()];case 2:r=i.sent().chainId;if(e.length===0){throw new Error("No accounts found via wallet-connect.")}o=e[0];this.registerNewWalletAddress(o,r,t,n);n.provider.on("accountsChanged",(function(e){console.log("Account changed: ",e);if(!e||e.length===0){c.client.disconnectWallet();return}if(o===e[0])return;delete c.connections[o.toLowerCase()];o=e[0];c.registerNewWalletAddress(o,r,t,n);c.saveConnections();c.emitSavedConnection(o);c.client.getTokenStore().clearCachedTokens();c.client.enrichTokenLookupDataOnChainTokens()}));n.provider.on("chainChanged",(function(r){console.log("Chain changed: ",r);c.registerNewWalletAddress(e[0],r,t,n);c.saveConnections();c.emitNetworkChange(r)}));n.provider.on("disconnect",(function(n){console.log("Disconnect wallet: ",n);if((n===null||n===void 0?void 0:n.message)&&n.message.indexOf("MetaMask: Disconnected from chain")>-1)return;c.client.disconnectWallet()}));return[2,e[0]]}}))}))};o.prototype.MetaMask=function(t){return r(this,void 0,void 0,(function(){var t;return i(this,(function(r){switch(r.label){case 0:n(2,"connect MetaMask");if(!(typeof window.ethereum!=="undefined"))return[3,2];return[4,window.ethereum.enable()];case 1:r.sent();t=new e(window.ethereum,"any");return[2,this.registerProvider(t,"MetaMask")];case 2:throw new Error("MetaMask is not available. Please check the extension is supported and active.")}}))}))};o.prototype.WalletConnect=function(t){return r(this,void 0,void 0,(function(){var r,o;var c=this;return i(this,(function(i){switch(i.label){case 0:n(2,"connect Wallet Connect");return[4,import("./p-615d3946.js")];case 1:r=i.sent();return[4,r.getWalletConnectProviderInstance(t)];case 2:o=i.sent();return[2,new Promise((function(n,r){if(t){o.connector.on("display_uri",(function(n,t){r(new Error("Connection expired"))}))}o.enable().then((function(){var t=new e(o,"any");n(c.registerProvider(t,"WalletConnect"))})).catch((function(n){return r(n)}))}))]}}))}))};o.prototype.WalletConnectV2=function(t){return r(this,void 0,void 0,(function(){var o,c,s,u;var a=this;return i(this,(function(f){switch(f.label){case 0:n(2,"connect Wallet Connect V2");return[4,import("./p-884301fd.js")];case 1:o=f.sent();return[4,o.getWalletConnectV2ProviderInstance()];case 2:c=f.sent();c.on("display_uri",(function(n){return r(a,void 0,void 0,(function(){var t=this;return i(this,(function(e){switch(e.label){case 0:console.log("EVENT","QR Code Modal open");return[4,import("./p-c5700d84.js").then((function(n){return n.i}))];case 1:s=e.sent().default;s.open(n,(function(){t.client.getUi().showError("User closed modal")}));return[2]}}))}))}));c.on("session_delete",(function(n){console.log("WC V2 EVENT","session_deleted");a.client.disconnectWallet()}));if(!!t)return[3,4];u=void 0;return[4,c.connect({namespaces:{eip155:{methods:["eth_sendTransaction","eth_signTransaction","eth_sign","personal_sign","eth_signTypedData"],chains:o.WC_V2_CHAINS,events:["chainChanged","accountsChanged"],rpcMap:o.CUSTOM_RPCS_FOR_WC_V2}},pairingTopic:u===null||u===void 0?void 0:u.topic})];case 3:f.sent();s.close();f.label=4;case 4:return[2,new Promise((function(n,t){c.enable().then((function(){var t=new e(c,"any");n(a.registerProvider(t,"WalletConnectV2"))})).catch((function(n){t(n)}))}))]}}))}))};o.prototype.Torus=function(n){return r(this,void 0,void 0,(function(){var n,t,r;return i(this,(function(i){switch(i.label){case 0:return[4,import("./p-e379041e.js")];case 1:n=i.sent();return[4,n.getTorusProviderInstance()];case 2:t=i.sent();return[4,t.init()];case 3:i.sent();return[4,t.login()];case 4:i.sent();r=new e(t.provider,"any");return[2,this.registerProvider(r,"Torus")]}}))}))};o.prototype.Phantom=function(){return r(this,void 0,void 0,(function(){var t,e;return i(this,(function(r){switch(r.label){case 0:n(2,"connect Phantom");if(!(typeof window.solana!=="undefined"))return[3,2];return[4,window.solana.connect()];case 1:t=r.sent();e=t.publicKey.toBase58();return[2,this.registerNewWalletAddress(e,"mainnet-beta","phantom",window.solana,"solana")];case 2:throw new Error("MetaMask is not available. Please check the extension is supported and active.")}}))}))};o.prototype.SafeConnect=function(){return r(this,void 0,void 0,(function(){var t,e;return i(this,(function(r){switch(r.label){case 0:n(2,"connect SafeConnect");return[4,this.getSafeConnectProvider()];case 1:t=r.sent();return[4,t.initSafeConnect()];case 2:e=r.sent();this.registerNewWalletAddress(e,1,"SafeConnect",t);return[2,e]}}))}))};o.prototype.flowSubscribe=function(n,t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(r){try{if(t.addr){this.registerNewWalletAddress(t.addr,1,"flow",n);e=this.client.getUi();if(e)e.dismissLoader();this.client.enrichTokenLookupDataOnChainTokens();if(e)e.updateUI("main")}}catch(n){console.error("flow wallet connection error ==>",n);this.client.getUi().showError("Flow wallet connection error.")}return[2]}))}))};o.prototype.Flow=function(){return r(this,void 0,void 0,(function(){var n,t,e;var r=this;return i(this,(function(i){switch(i.label){case 0:i.trys.push([0,2,,3]);return[4,import("./p-7dea8f72.js")];case 1:n=i.sent();t=n.getFlowProvider();t.currentUser.subscribe((function(n){return r.flowSubscribe(t,n)}));t.authenticate();return[3,3];case 2:e=i.sent();console.error("error ==>",e);return[3,3];case 3:return[2,""]}}))}))};o.prototype.safeConnectAvailable=function(){return this.safeConnectOptions!==undefined};o.prototype.getSafeConnectProvider=function(){return r(this,void 0,void 0,(function(){var n;return i(this,(function(t){switch(t.label){case 0:return[4,import("./p-ea01a02d.js").then((function(n){return n.S}))];case 1:n=t.sent().SafeConnectProvider;return[2,new n(this.client.getUi(),this.safeConnectOptions)]}}))}))};o.LOCAL_STORAGE_KEY="tn-wallet-connections";return o}();export default o;export{o as Web3WalletProvider};
//# sourceMappingURL=p-65f204d9.js.map